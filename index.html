<!doctype html>
<html lang="pt-BR">

<head>
    <meta charset="utf-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1" />
    <title>Gerenciador Pedro</title>
    <style>
        :root {
            --bg-primary: #0f172a;
            --bg-secondary: #1e293b;
            --bg-tertiary: #334155;
            --surface: #ffffff;
            --surface-hover: #f8fafc;
            --border: #e2e8f0;
            --text-primary: #0f172a;
            --text-secondary: #64748b;
            --text-muted: #94a3b8;
            --accent: #3b82f6;
            --accent-hover: #2563eb;
            --success: #10b981;
            --warning: #f59e0b;
            --danger: #ef4444;
            --purple: #8b5cf6;
            --shadow: 0 1px 3px rgba(0, 0, 0, 0.1);
            --shadow-lg: 0 10px 15px -3px rgba(0, 0, 0, 0.1);
        }

        body.dark-mode {
            --surface: #1e293b;
            --surface-hover: #334155;
            --border: #334155;
            --text-primary: #f1f5f9;
            --text-secondary: #94a3b8;
        }

        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            color: var(--text-primary);
            padding: 20px;
            transition: all 0.3s;
        }

        body.dark-mode {
            background: linear-gradient(135deg, #1e293b 0%, #0f172a 100%)
        }

        .container {
            max-width: 1400px;
            margin: 0 auto
        }

        .header {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
        }

        .header-top {
            display: flex;
            justify-content: space-between;
            align-items: center;
            flex-wrap: wrap;
            gap: 16px;
            margin-bottom: 20px;
        }

        .header h1 {
            font-size: 28px;
            font-weight: 700;
            background: linear-gradient(135deg, #667eea, #764ba2);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .header-actions {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            align-items: center
        }

        .tabs {
            display: flex;
            gap: 8px;
            border-bottom: 2px solid var(--border)
        }

        .tab {
            padding: 12px 24px;
            border: none;
            background: transparent;
            color: var(--text-secondary);
            font-size: 15px;
            font-weight: 500;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab:hover {
            color: var(--text-primary);
            background: var(--surface-hover)
        }

        .tab.active {
            color: var(--accent);
            border-bottom-color: var(--accent)
        }

        .tab-content {
            display: none
        }

        .tab-content.active {
            display: block
        }

        .btn {
            padding: 10px 16px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
            display: inline-flex;
            align-items: center;
            gap: 6px;
        }

        .btn:hover {
            transform: translateY(-1px);
            box-shadow: var(--shadow)
        }

        .btn-primary {
            background: var(--accent);
            color: white
        }

        .btn-primary:hover {
            background: var(--accent-hover)
        }

        .btn-secondary {
            background: var(--bg-tertiary);
            color: white
        }

        .btn-secondary:hover {
            background: var(--bg-secondary)
        }

        .btn-success {
            background: var(--success);
            color: white
        }

        .btn-success:hover {
            opacity: 0.9
        }

        .btn-danger {
            background: var(--danger);
            color: white
        }

        .btn-danger:hover {
            opacity: 0.9
        }

        .btn-sm {
            padding: 6px 12px;
            font-size: 12px
        }

        .btn-lg {
            padding: 14px 24px;
            font-size: 16px
        }

        .btn-icon {
            width: 32px;
            height: 32px;
            padding: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            border: none;
            background: transparent;
            cursor: pointer;
            border-radius: 6px;
            transition: all 0.2s;
            font-size: 18px;
        }

        .btn-icon:hover {
            background: var(--border)
        }

        /* PROJETOS - mantem */
        .main-grid {
            display: grid;
            grid-template-columns: 350px 1fr;
            gap: 20px;
            margin-top: 20px
        }

        .form-card {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            height: fit-content;
            position: sticky;
            top: 20px
        }

        .form-title {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 20px;
            color: var(--accent)
        }

        .form-group {
            margin-bottom: 16px
        }

        .form-group label {
            display: block;
            font-size: 13px;
            font-weight: 500;
            color: var(--text-secondary);
            margin-bottom: 6px
        }

        .form-control {
            width: 100%;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            transition: all 0.2s;
            background: var(--surface);
            color: var(--text-primary)
        }

        .form-control:focus {
            outline: none;
            border-color: var(--accent);
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1)
        }

        textarea.form-control {
            resize: vertical;
            min-height: 80px
        }

        .form-actions {
            display: flex;
            gap: 8px;
            margin-top: 20px
        }

        .filters {
            background: var(--surface);
            border-radius: 16px;
            padding: 16px;
            margin-bottom: 20px;
            box-shadow: var(--shadow-lg);
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center
        }

        .filter-input {
            flex: 1;
            min-width: 200px;
            padding: 10px 12px;
            border: 2px solid var(--border);
            border-radius: 8px;
            font-size: 14px;
            background: var(--surface);
            color: var(--text-primary)
        }

        .filter-input:focus {
            outline: none;
            border-color: var(--accent)
        }

        .stats {
            color: var(--text-secondary);
            font-size: 14px;
            font-weight: 500
        }

        .kanban {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(260px, 1fr));
            gap: 16px
        }

        .column {
            background: var(--surface);
            border-radius: 12px;
            padding: 16px;
            box-shadow: var(--shadow);
            min-height: 500px
        }

        .column.drag-over {
            background: var(--surface-hover);
            border: 2px dashed var(--accent)
        }

        .column-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
            padding-bottom: 12px;
            border-bottom: 2px solid var(--border)
        }

        .column-title {
            font-size: 14px;
            font-weight: 600
        }

        .column-count {
            background: var(--accent);
            color: white;
            border-radius: 12px;
            padding: 2px 8px;
            font-size: 12px;
            font-weight: 600
        }

        .task-card {
            background: var(--surface);
            border: 2px solid var(--border);
            border-radius: 10px;
            padding: 12px;
            margin-bottom: 12px;
            cursor: grab;
            transition: all 0.2s
        }

        .task-card:hover {
            border-color: var(--accent);
            box-shadow: var(--shadow);
            transform: translateY(-2px)
        }

        .task-card.dragging {
            opacity: 0.5;
            cursor: grabbing
        }

        .task-header {
            display: flex;
            justify-content: space-between;
            align-items: start;
            gap: 8px;
            margin-bottom: 8px
        }

        .task-id {
            font-size: 11px;
            font-weight: 600;
            color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
            padding: 2px 6px;
            border-radius: 4px
        }

        .task-title {
            font-size: 14px;
            font-weight: 600;
            margin: 4px 0;
            word-break: break-word
        }

        .task-meta {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin: 8px 0;
            font-size: 12px
        }

        .tag {
            padding: 3px 8px;
            border-radius: 12px;
            font-size: 11px;
            font-weight: 500
        }

        .tag-type {
            background: #e0e7ff;
            color: #4338ca
        }

        .tag-priority {
            background: #fef3c7;
            color: #92400e
        }

        .tag-priority.Alta {
            background: #fee2e2;
            color: #991b1b
        }

        .tag-priority.Urgente {
            background: #fecaca;
            color: #7f1d1d;
            font-weight: 600
        }

        .task-desc {
            font-size: 13px;
            color: var(--text-secondary);
            margin: 8px 0;
            line-height: 1.4
        }

        .task-footer {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-top: 8px;
            padding-top: 8px;
            border-top: 1px solid var(--border)
        }

        .task-assignee {
            font-size: 12px;
            color: var(--text-secondary)
        }

        .task-actions {
            display: flex;
            gap: 4px
        }

        .drop-zone {
            border: 2px dashed var(--border);
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            color: var(--text-secondary);
            transition: all 0.2s;
            margin-top: 12px
        }

        .drop-zone.drag-active {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.05)
        }

        /* ROTINA - REDESENHADA */
        .rotina-topo {
            margin-top: 20px;
            margin-bottom: 20px
        }

        /* HUD de status */
        .hud-status {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(180px, 1fr));
            gap: 16px;
            margin-bottom: 20px;
        }

        .hud-card {
            background: var(--surface);
            border-radius: 12px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            cursor: pointer;
            transition: all 0.3s;
            border: 3px solid transparent;
        }

        .hud-card:hover {
            transform: translateY(-4px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1);
        }

        .hud-card.ativo {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.05);
        }

        .hud-numero {
            font-size: 48px;
            font-weight: 700;
            line-height: 1;
            margin-bottom: 8px;
        }

        .hud-numero.afazer {
            color: #3b82f6
        }

        .hud-numero.meiofeito {
            color: #f59e0b
        }

        .hud-numero.feito {
            color: #10b981
        }

        .hud-numero.pausadas {
            color: #64748b
        }

        .hud-label {
            font-size: 14px;
            font-weight: 600;
            color: var(--text-secondary);
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        /* Progresso principal */
        .progresso-principal {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 20px;
        }

        .progresso-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 16px;
        }

        .progresso-titulo {
            font-size: 20px;
            font-weight: 700
        }

        .progresso-numero {
            font-size: 42px;
            font-weight: 700;
            background: linear-gradient(135deg, var(--success), var(--accent));
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
        }

        .progresso-barra {
            height: 16px;
            background: var(--border);
            border-radius: 999px;
            overflow: hidden;
            margin: 16px 0;
        }

        .progresso-preenchimento {
            height: 100%;
            background: linear-gradient(90deg, var(--success), var(--accent));
            border-radius: 999px;
            transition: width 0.5s;
            position: relative;
            overflow: hidden;
        }

        .progresso-preenchimento::after {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: linear-gradient(90deg, transparent, rgba(255, 255, 255, 0.3), transparent);
            animation: shine 2s infinite;
        }

        @keyframes shine {
            0% {
                transform: translateX(-100%)
            }

            100% {
                transform: translateX(100%)
            }
        }

        .progresso-texto {
            font-size: 15px;
            color: var(--text-secondary);
            font-weight: 500;
        }

        /* Controles principais */
        .controles-principais {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 20px;
        }

        .controles-acoes {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            align-items: center;
        }

        /* Lista de tarefas */
        .lista-tarefas {
            background: var(--surface);
            border-radius: 16px;
            padding: 24px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 20px;
        }

        .tarefa-item {
            display: grid;
            grid-template-columns: auto 1fr auto;
            gap: 16px;
            align-items: start;
            padding: 20px;
            background: var(--surface-hover);
            border-radius: 12px;
            margin-bottom: 16px;
            transition: all 0.3s;
            border: 3px solid transparent;
            position: relative;
        }

        .tarefa-item:hover {
            border-color: var(--accent);
            transform: translateX(4px);
            box-shadow: var(--shadow-lg);
        }

        .tarefa-item.concluida {
            opacity: 0.7;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
        }

        .tarefa-item.pausada {
            opacity: 0.6;
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
        }

        .checkbox-custom {
            width: 32px;
            height: 32px;
            border: 3px solid var(--border);
            border-radius: 8px;
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            transition: all 0.3s;
            flex-shrink: 0;
            font-size: 18px;
            background: var(--surface);
        }

        .checkbox-custom:hover {
            border-color: var(--accent);
            transform: scale(1.1);
        }

        .checkbox-custom.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
            animation: checkBounce 0.5s;
        }

        @keyframes checkBounce {

            0%,
            100% {
                transform: scale(1)
            }

            50% {
                transform: scale(1.3)
            }
        }

        .tarefa-conteudo {
            min-width: 0
        }

        .tarefa-header-linha {
            display: flex;
            align-items: center;
            gap: 12px;
            flex-wrap: wrap;
            margin-bottom: 8px;
        }

        .tarefa-nome {
            font-size: 17px;
            font-weight: 600;
            color: var(--text-primary);
        }

        .tarefa-item.concluida .tarefa-nome {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .tag-prioridade {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 700;
            text-transform: uppercase;
        }

        .tag-prioridade.Baixa {
            background: #dbeafe;
            color: #1e40af
        }

        .tag-prioridade.M√©dia {
            background: #fef3c7;
            color: #92400e
        }

        .tag-prioridade.Alta {
            background: #fee2e2;
            color: #991b1b
        }

        .tag-prioridade.Urgente {
            background: #fecaca;
            color: #7f1d1d;
            animation: pulse 2s infinite
        }

        .tag-categoria {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 11px;
            font-weight: 600;
        }

        .tarefa-detalhes {
            display: flex;
            gap: 12px;
            flex-wrap: wrap;
            margin-top: 8px;
            font-size: 13px;
            color: var(--text-secondary);
        }

        .tarefa-badge {
            padding: 4px 8px;
            background: var(--border);
            border-radius: 6px;
            font-weight: 500;
        }

        .tarefa-horarios {
            display: flex;
            gap: 6px;
            flex-wrap: wrap;
        }

        .horario-badge {
            padding: 4px 10px;
            background: rgba(59, 130, 246, 0.1);
            color: var(--accent);
            border-radius: 6px;
            font-weight: 600;
            font-size: 13px;
        }

        .quantidade-display {
            display: flex;
            align-items: center;
            gap: 8px;
            padding: 6px 12px;
            background: var(--border);
            border-radius: 8px;
            font-size: 14px;
            font-weight: 700;
            margin-top: 8px;
        }

        .quantidade-btn {
            background: var(--accent);
            color: white;
            border: none;
            cursor: pointer;
            font-size: 18px;
            padding: 2px 8px;
            border-radius: 4px;
            font-weight: 700;
        }

        .quantidade-btn:hover {
            transform: scale(1.2)
        }

        .humor-tarefa {
            margin-top: 12px;
            padding-top: 12px;
            border-top: 2px solid var(--border);
        }

        .humor-tarefa-label {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 6px;
            font-weight: 500;
        }

        .humor-opcoes {
            display: flex;
            gap: 6px;
        }

        .humor-btn-mini {
            font-size: 24px;
            background: none;
            border: 2px solid var(--border);
            border-radius: 8px;
            padding: 4px 8px;
            cursor: pointer;
            transition: all 0.2s;
        }

        .humor-btn-mini:hover {
            transform: scale(1.15)
        }

        .humor-btn-mini.selected {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
            transform: scale(1.2);
        }

        .tarefa-acoes {
            display: flex;
            flex-direction: column;
            gap: 6px;
        }

        .subtarefas {
            margin-top: 12px;
            padding-left: 16px;
            border-left: 3px solid var(--border);
        }

        .subtarefa-item {
            display: flex;
            gap: 10px;
            padding: 8px 0;
            font-size: 14px;
        }

        .subtarefa-check {
            width: 20px;
            height: 20px;
            border: 2px solid var(--border);
            border-radius: 4px;
            cursor: pointer;
            flex-shrink: 0;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 12px;
        }

        .subtarefa-check.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
        }

        /* Se√ß√µes colaps√°veis */
        .secao-colapsavel {
            background: var(--surface);
            border-radius: 16px;
            padding: 20px;
            box-shadow: var(--shadow-lg);
            margin-bottom: 20px;
        }

        .secao-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            cursor: pointer;
            padding: 12px;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .secao-header:hover {
            background: var(--surface-hover)
        }

        .secao-titulo {
            font-size: 18px;
            font-weight: 700;
            display: flex;
            align-items: center;
            gap: 8px;
        }

        .secao-conteudo {
            display: none;
            margin-top: 20px;
            animation: slideDown 0.3s;
        }

        .secao-conteudo.expandido {
            display: block
        }

        @keyframes slideDown {
            from {
                opacity: 0;
                transform: translateY(-10px)
            }

            to {
                opacity: 1;
                transform: translateY(0)
            }
        }

        /* Conquistas */
        .conquistas-grid {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(90px, 1fr));
            gap: 12px;
        }

        .conquista {
            text-align: center;
            padding: 12px;
            border-radius: 12px;
            background: var(--surface-hover);
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .conquista.desbloqueada {
            background: linear-gradient(135deg, #fbbf24, #f59e0b);
            transform: scale(1.05);
            border-color: #f59e0b;
        }

        .conquista-icon {
            font-size: 36px;
            margin-bottom: 6px
        }

        .conquista-nome {
            font-size: 11px;
            color: var(--text-secondary);
            font-weight: 600
        }

        .conquista.desbloqueada .conquista-nome {
            color: #fff
        }

        /* Gr√°fico */
        .grafico {
            display: flex;
            align-items: end;
            gap: 12px;
            height: 150px
        }

        .grafico-barra {
            flex: 1;
            background: var(--accent);
            border-radius: 8px 8px 0 0;
            position: relative;
            transition: all 0.3s;
            cursor: pointer;
        }

        .grafico-barra:hover {
            opacity: 0.8;
            transform: translateY(-4px)
        }

        .grafico-label {
            font-size: 12px;
            color: var(--text-secondary);
            text-align: center;
            margin-top: 8px;
            font-weight: 500;
        }

        /* Calend√°rio */
        .calendario-grid {
            display: grid;
            grid-template-columns: repeat(7, 1fr);
            gap: 12px;
        }

        .dia-calendario {
            background: var(--surface-hover);
            border-radius: 12px;
            padding: 16px;
            text-align: center;
            cursor: pointer;
            transition: all 0.3s;
            border: 2px solid transparent;
        }

        .dia-calendario:hover {
            border-color: var(--accent);
            transform: translateY(-4px);
        }

        .dia-calendario.hoje {
            border-color: var(--accent);
            background: rgba(59, 130, 246, 0.1);
        }

        .dia-num {
            font-size: 24px;
            font-weight: 700;
            margin-bottom: 4px
        }

        .dia-nome {
            font-size: 12px;
            color: var(--text-secondary);
            margin-bottom: 8px
        }

        .dia-progresso {
            width: 100%;
            height: 6px;
            background: var(--border);
            border-radius: 3px;
            overflow: hidden;
        }

        .dia-progresso-fill {
            height: 100%;
            background: var(--success);
            border-radius: 3px;
            transition: width 0.3s;
        }

        /* Minha Rotina - Vista Simplificada */
        .rotina-item-simples {
            display: grid;
            grid-template-columns: 80px 1fr auto;
            gap: 20px;
            align-items: center;
            padding: 20px;
            background: var(--surface);
            border-radius: 12px;
            margin-bottom: 16px;
            transition: all 0.3s;
            border-left: 4px solid transparent;
        }

        .rotina-item-simples:hover {
            transform: translateX(4px);
            box-shadow: var(--shadow-lg);
        }

        .rotina-item-simples.concluida {
            opacity: 0.6;
            background: linear-gradient(135deg, #f0fdf4, #dcfce7);
            border-left-color: var(--success);
        }

        .rotina-item-simples.pausada {
            opacity: 0.5;
            background: linear-gradient(135deg, #f1f5f9, #e2e8f0);
            border-left-color: var(--text-secondary);
        }

        .rotina-hora {
            font-size: 24px;
            font-weight: 700;
            color: var(--accent);
            text-align: center;
            font-family: 'Courier New', monospace;
        }

        .rotina-conteudo-simples {
            flex: 1;
        }

        .rotina-titulo-simples {
            font-size: 18px;
            font-weight: 600;
            margin-bottom: 6px;
            color: var(--text-primary);
        }

        .rotina-item-simples.concluida .rotina-titulo-simples {
            text-decoration: line-through;
            color: var(--text-secondary);
        }

        .rotina-descricao-simples {
            font-size: 14px;
            color: var(--text-secondary);
            line-height: 1.5;
        }

        .rotina-badges {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 8px;
        }

        .rotina-badge-simples {
            padding: 4px 10px;
            border-radius: 6px;
            font-size: 12px;
            font-weight: 600;
            display: inline-flex;
            align-items: center;
            gap: 4px;
        }

        .rotina-acoes-simples {
            display: flex;
            flex-direction: column;
            gap: 8px;
        }

        .check-btn-simples {
            width: 48px;
            height: 48px;
            border-radius: 50%;
            border: 3px solid var(--border);
            background: var(--surface);
            cursor: pointer;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 24px;
            transition: all 0.3s;
        }

        .check-btn-simples:hover {
            transform: scale(1.1);
            border-color: var(--accent);
        }

        .check-btn-simples.checked {
            background: var(--success);
            border-color: var(--success);
            color: white;
            animation: checkBounce 0.5s;
        }

        /* Streak */
        .streak-display {
            display: flex;
            align-items: center;
            justify-content: center;
            gap: 20px;
        }

        .streak-fire {
            font-size: 64px;
            animation: pulse 2s infinite;
        }

        @keyframes pulse {

            0%,
            100% {
                transform: scale(1)
            }

            50% {
                transform: scale(1.15)
            }
        }

        .streak-info {
            text-align: center
        }

        .streak-num {
            font-size: 56px;
            font-weight: 700;
            color: var(--warning);
            line-height: 1;
        }

        .streak-label {
            font-size: 14px;
            color: var(--text-secondary);
            margin-top: 4px;
            font-weight: 600;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.6);
            backdrop-filter: blur(4px);
            z-index: 1000;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .modal.ativo {
            display: flex
        }

        .modal-conteudo {
            background: var(--surface);
            border-radius: 16px;
            padding: 28px;
            max-width: 600px;
            width: 100%;
            max-height: 90vh;
            overflow-y: auto;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 24px;
        }

        .modal-titulo {
            font-size: 22px;
            font-weight: 700
        }

        /* Toast */
        .toast {
            position: fixed;
            bottom: 20px;
            right: 20px;
            background: var(--bg-primary);
            color: white;
            padding: 16px 24px;
            border-radius: 12px;
            box-shadow: var(--shadow-lg);
            z-index: 2000;
            animation: slideInRight 0.3s;
            font-weight: 600;
            font-size: 15px;
        }

        .toast.success {
            background: var(--success)
        }

        .toast.error {
            background: var(--danger)
        }

        @keyframes slideInRight {
            from {
                transform: translateX(100px);
                opacity: 0
            }

            to {
                transform: translateX(0);
                opacity: 1
            }
        }

        /* Confete */
        .confete {
            position: fixed;
            pointer-events: none;
            z-index: 10000
        }

        @keyframes confeteFall {
            to {
                transform: translateY(100vh) rotate(360deg);
                opacity: 0
            }
        }

        @media(max-width:968px) {
            .main-grid {
                grid-template-columns: 1fr
            }

            .hud-status {
                grid-template-columns: repeat(2, 1fr)
            }

            .tarefa-item {
                grid-template-columns: auto 1fr;
                gap: 12px
            }

            .tarefa-acoes {
                flex-direction: row
            }

            .rotina-item-simples {
                grid-template-columns: 60px 1fr auto;
                gap: 12px;
                padding: 16px;
            }

            .rotina-hora {
                font-size: 18px;
            }

            .rotina-titulo-simples {
                font-size: 16px;
            }

            .rotina-descricao-simples {
                font-size: 13px;
            }

            .check-btn-simples {
                width: 40px;
                height: 40px;
                font-size: 20px;
            }

            .rotina-badges {
                flex-direction: column;
                align-items: flex-start;
            }
        }
    </style>
</head>

<body>
    <div class="container">
        <header class="header">
            <div class="header-top">
                <h1>üéØ Gerenciador Pedro</h1>
                <div class="header-actions">
                    <button class="btn-icon" onclick="toggleDarkMode()" title="Modo escuro">üåô</button>
                    <button class="btn btn-success" onclick="salvarArquivo()">üíæ Salvar</button>
                    <button class="btn btn-secondary" onclick="$('inputArquivo').click()">üìÇ Importar</button>
                    <input type="file" id="inputArquivo" accept=".json" style="display:none" onchange="importarArquivo(this.files[0])">
                </div>
            </div>
            <div class="tabs">
                <button class="tab active" onclick="trocarAba('projetos')">üìã Projetos</button>
                <button class="tab" onclick="trocarAba('rotina')">‚úÖ Rotina Di√°ria</button>
                <button class="tab" onclick="trocarAba('minhaRotina')">üìÖ Minha Rotina</button>
                <button class="tab" onclick="abrirTerapia()">üå± Espa√ßo Terap√™utico</button>
            </div>
        </header>

        <!-- ABA PROJETOS (mant√©m) -->
        <div id="projetos" class="tab-content active">
            <div class="main-grid">
                <aside class="form-card">
                    <div class="form-title" id="formModo">‚ûï Nova Tarefa</div>
                    <form id="taskForm" onsubmit="salvarTarefa(event)">
                        <input type="hidden" id="editId">
                        <div class="form-group">
                            <label>T√≠tulo *</label>
                            <input class="form-control" id="titulo" required placeholder="Ex: Implementar login">
                        </div>
                        <div class="form-group">
                            <label>Descri√ß√£o</label>
                            <textarea class="form-control" id="descricao" placeholder="Detalhes..."></textarea>
                        </div>
                        <div class="form-group">
                            <label>Respons√°vel</label>
                            <input class="form-control" id="responsavel" placeholder="Nome">
                        </div>
                        <div class="form-group">
                            <label>Tipo</label>
                            <select class="form-control" id="tipo">
                                <option>Tarefa</option>
                                <option>Bug</option>
                                <option>Melhoria</option>
                                <option>Documenta√ß√£o</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Prioridade</label>
                            <select class="form-control" id="prioridade">
                                <option>Baixa</option>
                                <option selected>M√©dia</option>
                                <option>Alta</option>
                                <option>Urgente</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Status</label>
                            <select class="form-control" id="status">
                                <option>A Fazer</option>
                                <option>Fazendo</option>
                                <option>Revis√£o</option>
                                <option>Bloqueado</option>
                                <option>Conclu√≠da</option>
                            </select>
                        </div>
                        <div class="form-group">
                            <label>Data Prevista</label>
                            <input type="date" class="form-control" id="dataPrevista">
                        </div>
                        <div class="form-actions">
                            <button type="submit" class="btn btn-primary" style="flex:1" id="btnSalvar">Adicionar</button>
                            <button type="button" class="btn btn-secondary" onclick="cancelarEdicao()">Cancelar</button>
                        </div>
                    </form>
                    <div class="drop-zone" id="dropZone">üóÇÔ∏è Arraste arquivo JSON</div>
                </aside>
                <main>
                    <div class="filters">
                        <input type="text" class="filter-input" id="busca" placeholder="üîç Buscar...">
                        <select class="form-control" id="filtroStatus" style="width:auto" onchange="renderizarProjetos()">
                            <option value="">Todos</option>
                            <option>A Fazer</option>
                            <option>Fazendo</option>
                            <option>Revis√£o</option>
                            <option>Bloqueado</option>
                            <option>Conclu√≠da</option>
                        </select>
                        <select class="form-control" id="filtroPrioridade" style="width:auto" onchange="renderizarProjetos()">
                            <option value="">Todas</option>
                            <option>Baixa</option>
                            <option>M√©dia</option>
                            <option>Alta</option>
                            <option>Urgente</option>
                        </select>
                        <button class="btn btn-sm btn-secondary" onclick="limparFiltros()">Limpar</button>
                        <span class="stats" id="stats"></span>
                    </div>
                    <div class="kanban" id="kanban"></div>
                </main>
            </div>
        </div>

        <!-- ABA ROTINA REDESENHADA -->
        <div id="rotina" class="tab-content">
            <!-- HUD STATUS -->
            <div class="hud-status">
                <div class="hud-card" onclick="filtrarPorStatus('afazer')" id="hudAfazer">
                    <div class="hud-numero afazer" id="numAfazer">0</div>
                    <div class="hud-label">A Fazer</div>
                </div>
                <div class="hud-card" onclick="filtrarPorStatus('meiofeito')" id="hudMeiofeito">
                    <div class="hud-numero meiofeito" id="numMeiofeito">0</div>
                    <div class="hud-label">Meio-Feito</div>
                </div>
                <div class="hud-card" onclick="filtrarPorStatus('feito')" id="hudFeito">
                    <div class="hud-numero feito" id="numFeito">0</div>
                    <div class="hud-label">Feito</div>
                </div>
                <div class="hud-card" onclick="filtrarPorStatus('pausadas')" id="hudPausadas">
                    <div class="hud-numero pausadas" id="numPausadas">0</div>
                    <div class="hud-label">Pausadas</div>
                </div>
            </div>

            <!-- PROGRESSO PRINCIPAL -->
            <div class="progresso-principal">
                <div class="progresso-header">
                    <div class="progresso-titulo">Progresso de Hoje</div>
                    <div class="progresso-numero" id="progressoPorcentagem">0%</div>
                </div>
                <div class="progresso-barra">
                    <div class="progresso-preenchimento" id="progressoBarra" style="width:0%"></div>
                </div>
                <div class="progresso-texto" id="progressoTexto">0 de 0 conclu√≠das</div>
            </div>

            <!-- CONTROLES PRINCIPAIS -->
            <div class="controles-principais">
                <div class="controles-acoes">
                    <button class="btn btn-primary btn-lg" onclick="abrirModalNovaTarefa()">‚ûï Nova Tarefa</button>
                    <button class="btn btn-secondary" onclick="abrirModalCategorias()">üè∑Ô∏è Gerenciar Categorias</button>
                    <button class="btn btn-secondary" onclick="limparFiltroStatus()">üîÑ Mostrar Todas</button>
                    <button class="btn btn-secondary" onclick="pedirPermissaoNotificacao()">üîî Notifica√ß√µes</button>
                    <button class="btn btn-success" onclick="abrirModalPushcut()">üì± Pushcut</button>
                </div>
            </div>

            <!-- FILTROS -->
            <div class="filters">
                <input type="text" class="filter-input" id="buscaRotina" placeholder="üîç Buscar tarefas..." oninput="renderizarRotina()">
                <select class="form-control" id="filtroCategoriaRotina" style="width:auto" onchange="renderizarRotina()">
                    <option value="">Todas as categorias</option>
                </select>
                <select class="form-control" id="filtroPrioridadeRotina" style="width:auto" onchange="renderizarRotina()">
                    <option value="">Todas as prioridades</option>
                    <option>Baixa</option>
                    <option>M√©dia</option>
                    <option>Alta</option>
                    <option>Urgente</option>
                </select>
                <select class="form-control" id="filtroRecorrenciaRotina" style="width:auto" onchange="renderizarRotina()">
                    <option value="">Todas</option>
                    <option value="unica">√önica vez</option>
                    <option value="diaria">Di√°ria</option>
                    <option value="semanal">Semanal</option>
                </select>
                <button class="btn btn-sm btn-secondary" onclick="limparFiltrosRotina()">Limpar Filtros</button>
                <span class="stats" id="statsRotina"></span>
            </div>

            <!-- LISTA DE TAREFAS -->
            <div class="lista-tarefas">
                <div id="listaTarefasRotina"></div>
            </div>

            <!-- SE√á√ïES COLAPS√ÅVEIS -->
            <div class="secao-colapsavel">
                <div class="secao-header" onclick="toggleSecao('conquistas')">
                    <div class="secao-titulo">
                        üèÜ Conquistas & Streak
                        <span style="font-size:14px;color:var(--text-secondary);font-weight:normal">(clique para expandir)</span>
                    </div>
                    <div style="font-size:20px" id="iconConquistas">‚ñº</div>
                </div>
                <div class="secao-conteudo" id="secaoConquistas">
                    <div class="streak-display">
                        <div class="streak-fire">üî•</div>
                        <div class="streak-info">
                            <div class="streak-num" id="streakDias">0</div>
                            <div class="streak-label">dias seguidos</div>
                        </div>
                    </div>
                    <div style="height:30px"></div>
                    <div class="conquistas-grid" id="conquistasGrid"></div>
                </div>
            </div>

            <div class="secao-colapsavel">
                <div class="secao-header" onclick="toggleSecao('grafico')">
                    <div class="secao-titulo">
                        üìä √öltimos 7 Dias
                        <span style="font-size:14px;color:var(--text-secondary);font-weight:normal">(clique para expandir)</span>
                    </div>
                    <div style="font-size:20px" id="iconGrafico">‚ñº</div>
                </div>
                <div class="secao-conteudo" id="secaoGrafico">
                    <div class="grafico" id="graficoSemanal"></div>
                </div>
            </div>

            <div class="secao-colapsavel">
                <div class="secao-header" onclick="toggleSecao('calendario')">
                    <div class="secao-titulo">
                        üìÖ Calend√°rio Semanal
                        <span style="font-size:14px;color:var(--text-secondary);font-weight:normal">(clique para expandir)</span>
                    </div>
                    <div style="font-size:20px" id="iconCalendario">‚ñº</div>
                </div>
                <div class="secao-conteudo" id="secaoCalendario">
                    <div class="calendario-grid" id="calendarioView"></div>
                </div>
            </div>

            <!-- SE√á√ÉO DE AVALIA√á√ÉO DI√ÅRIA / AUTOFEEDBACK -->
            <div class="secao-colapsavel">
                <div class="secao-header" onclick="toggleSecao('avaliacao')">
                    <div class="secao-titulo">
                        üí≠ Autofeedback do Dia
                        <span style="font-size:14px;color:var(--text-secondary);font-weight:normal">(clique para expandir)</span>
                    </div>
                    <div style="font-size:20px" id="iconAvaliacao">‚ñº</div>
                </div>
                <div class="secao-conteudo" id="secaoAvaliacao">
                    <div style="margin-bottom:20px">
                        <div style="font-size:16px;font-weight:600;margin-bottom:12px">Como voc√™ est√° se sentindo hoje?</div>
                        <div class="humor-opcoes" style="justify-content:center;margin-bottom:16px">
                            <button class="humor-btn-mini" onclick="abrirModalAvaliacaoDiaria('feliz')" title="Feliz">üòä</button>
                            <button class="humor-btn-mini" onclick="abrirModalAvaliacaoDiaria('neutro')" title="Neutro">üòê</button>
                            <button class="humor-btn-mini" onclick="abrirModalAvaliacaoDiaria('triste')" title="Triste">üòî</button>
                            <button class="humor-btn-mini" onclick="abrirModalAvaliacaoDiaria('cansado')" title="Cansado">üò¥</button>
                            <button class="humor-btn-mini" onclick="abrirModalAvaliacaoDiaria('bravo')" title="Bravo/Frustrado">üò§</button>
                        </div>
                    </div>
                    <div id="resumoAvaliacaoDia"></div>
                    <div style="margin-top:24px">
                        <div style="font-size:16px;font-weight:600;margin-bottom:12px">üìä Resumo do Dia</div>
                        <div id="resumoDiarioCompleto"></div>
                    </div>
                </div>
            </div>
        </div>

        <!-- ABA MINHA ROTINA - Vista Simplificada -->
        <div id="minhaRotina" class="tab-content">
            <div style="max-width:800px;margin:0 auto">
                <div class="progresso-principal" style="margin-bottom:30px">
                    <div class="progresso-header">
                        <div class="progresso-titulo">üìÖ Minha Rotina de Hoje</div>
                        <button class="btn btn-primary" onclick="trocarAba('rotina')">‚úèÔ∏è Gerenciar Tarefas</button>
                    </div>
                    <div style="color:var(--text-secondary);font-size:15px;margin-top:12px" id="infoRotinaSimples"></div>
                </div>

                <div class="lista-tarefas">
                    <div id="listaRotinaSimplificada"></div>
                </div>
            </div>
        </div>
    </div>

    <!-- Modal Nova Tarefa Rotina -->
    <div class="modal" id="modalNovaTarefa">
        <div class="modal-conteudo">
            <div class="modal-header">
                <div class="modal-titulo" id="tituloModalRotina">‚ûï Nova Tarefa de Rotina</div>
                <button class="btn-icon" onclick="fecharModal('modalNovaTarefa')">‚úï</button>
            </div>
            <form id="formRotina" onsubmit="adicionarTarefaRotina(event)">
                <input type="hidden" id="editIdRotina">
                <div class="form-group">
                    <label>Nome da tarefa *</label>
                    <input class="form-control" id="nomeTarefaRotina" required placeholder="Ex: Tomar caf√©">
                </div>
                <div class="form-group">
                    <label>Categoria</label>
                    <select class="form-control" id="categoriaRotina"></select>
                </div>
                <div class="form-group">
                    <label>Prioridade</label>
                    <select class="form-control" id="prioridadeRotina">
                        <option>Baixa</option>
                        <option selected>M√©dia</option>
                        <option>Alta</option>
                        <option>Urgente</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Hor√°rios (separados por v√≠rgula) - Ex: 07:00, 19:00</label>
                    <input class="form-control" id="horariosRotina" placeholder="07:00, 19:00">
                </div>
                <div class="form-group">
                    <label>Tempo estimado (minutos)</label>
                    <input type="number" class="form-control" id="tempoEstimado" placeholder="Ex: 15">
                </div>
                <div class="form-group">
                    <label>Recorr√™ncia</label>
                    <select class="form-control" id="recorrenciaRotina">
                        <option value="unica">√önica vez</option>
                        <option value="diaria">Di√°ria</option>
                        <option value="semanal">Semanal</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Quantidade por dia</label>
                    <input type="number" class="form-control" id="quantidadeDia" value="1" min="1">
                </div>
                <div class="form-group">
                    <label>Subtarefas (uma por linha)</label>
                    <textarea class="form-control" id="subtarefas" rows="3" placeholder="Passo 1\nPasso 2"></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-lg" style="flex:1" id="btnSalvarRotina">Adicionar</button>
                    <button type="button" class="btn btn-secondary" onclick="cancelarEdicaoRotina()">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Categorias -->
    <div class="modal" id="modalCategorias">
        <div class="modal-conteudo">
            <div class="modal-header">
                <div class="modal-titulo">üè∑Ô∏è Gerenciar Categorias</div>
                <button class="btn-icon" onclick="fecharModal('modalCategorias')">‚úï</button>
            </div>
            <div style="margin-bottom:20px">
                <div style="display:flex;gap:8px;margin-bottom:12px">
                    <input class="form-control" id="novaCategoriaNome" placeholder="Nome da categoria">
                    <input type="color" id="novaCategoriaIcon" value="#3b82f6" style="width:60px;height:44px;border:2px solid var(--border);border-radius:8px;cursor:pointer">
                    <button class="btn btn-primary" onclick="adicionarCategoria()">‚ûï</button>
                </div>
                <div id="listaCategorias"></div>
            </div>
        </div>
    </div>

    <!-- Modal Avalia√ß√£o Di√°ria -->
    <div class="modal" id="modalAvaliacaoDiaria">
        <div class="modal-conteudo">
            <div class="modal-header">
                <div class="modal-titulo" id="tituloModalAvaliacao">üí≠ Avalia√ß√£o do Dia</div>
                <button class="btn-icon" onclick="fecharModal('modalAvaliacaoDiaria')">‚úï</button>
            </div>
            <form id="formAvaliacaoDiaria" onsubmit="salvarAvaliacaoDiaria(event)">
                <input type="hidden" id="avaliacaoHumors">
                <div class="form-group">
                    <label>Como voc√™ est√° se sentindo hoje? *</label>
                    <div class="humor-opcoes" style="justify-content:center;margin-bottom:12px">
                        <button type="button" class="humor-btn-mini" onclick="selecionarHumorAvaliacao('feliz')" id="btnHumorsfeliz">üòä</button>
                        <button type="button" class="humor-btn-mini" onclick="selecionarHumorAvaliacao('neutro')" id="btnHumorsneutro">üòê</button>
                        <button type="button" class="humor-btn-mini" onclick="selecionarHumorAvaliacao('triste')" id="btnHumorstriste">üòî</button>
                        <button type="button" class="humor-btn-mini" onclick="selecionarHumorAvaliacao('cansado')" id="btnHumorscansado">üò¥</button>
                        <button type="button" class="humor-btn-mini" onclick="selecionarHumorAvaliacao('bravo')" id="btnHumorsbravo">üò§</button>
                    </div>
                </div>
                <div class="form-group">
                    <label>Conte como foi seu dia (√∫til para conversar com seu psic√≥logo):</label>
                    <textarea class="form-control" id="avaliacaoTexto" rows="6" placeholder="Como foi seu dia? O que te fez bem? O que te incomodou? Como voc√™ se sentiu ao realizar as tarefas?"></textarea>
                </div>
                <div class="form-group">
                    <label>Observa√ß√µes adicionais (opcional):</label>
                    <textarea class="form-control" id="avaliacaoObservacoes" rows="3" placeholder="Algo que gostaria de lembrar ou comentar..."></textarea>
                </div>
                <div class="form-actions">
                    <button type="submit" class="btn btn-primary btn-lg" style="flex:1">üíæ Salvar Avalia√ß√£o</button>
                    <button type="button" class="btn btn-secondary" onclick="fecharModal('modalAvaliacaoDiaria')">Cancelar</button>
                </div>
            </form>
        </div>
    </div>

    <!-- Modal Pushcut -->
    <div class="modal" id="modalPushcut">
        <div class="modal-conteudo" style="max-width:800px">
            <div class="modal-header">
                <div class="modal-titulo">üì± Pushcut - Notifica√ß√µes Manuais</div>
                <button class="btn-icon" onclick="fecharModal('modalPushcut')">‚úï</button>
            </div>

            <!-- Configura√ß√£o API Key -->
            <div style="margin-bottom:24px;padding:16px;background:var(--surface-hover);border-radius:12px">
                <div style="font-size:15px;font-weight:600;margin-bottom:12px">‚öôÔ∏è Configura√ß√£o API Pushcut</div>
                <div class="form-group" style="margin-bottom:8px">
                    <label>Pushcut API Key</label>
                    <div style="display:flex;gap:8px;margin-bottom:8px">
                        <input type="password" class="form-control" id="pushcutApiKey" placeholder="Cole sua API Key aqui">
                        <button class="btn btn-primary" onclick="salvarApiKeyPushcut()">üíæ Salvar</button>
                        <button class="btn btn-success" onclick="testarConexaoPushcut()">üîç Testar</button>
                    </div>
                    <small style="color:var(--text-secondary)">
                        ‚ö†Ô∏è <strong>Importante:</strong> Antes de usar, voc√™ precisa:
                        <br>1. Baixar o app Pushcut na App Store
                        <br>2. Criar uma notifica√ß√£o chamada exatamente "<strong>Tarefa</strong>" no Pushcut
                        <br>3. Clicar em "üîç Testar" para verificar se est√° funcionando
                        <br><br>üìå <strong>Modo de envio:</strong> Apenas manual. Clique em "üöÄ Enviar Notifica√ß√µes Agora" quando desejar enviar.
                    </small>
                </div>
            </div>

            <!-- Estat√≠sticas -->
            <div style="margin-bottom:24px;padding:16px;background:rgba(59,130,246,0.1);border-radius:12px;border:2px solid var(--accent)">
                <div style="font-size:15px;font-weight:600;margin-bottom:8px">üìä Tarefas de Hoje</div>
                <div id="estatisticasPushcut" style="font-size:14px;color:var(--text-secondary)">Calculando...</div>
            </div>

            <!-- JSON Gerado -->
            <div style="margin-bottom:24px">
                <div style="display:flex;justify-content:space-between;align-items:center;margin-bottom:12px">
                    <div style="font-size:15px;font-weight:600">üìã JSON das Notifica√ß√µes</div>
                    <button class="btn btn-success btn-sm" onclick="copiarJsonPushcut()">üìã Copiar JSON</button>
                </div>
                <textarea id="jsonPushcut" class="form-control" readonly rows="10" style="font-family:monospace;font-size:12px;background:var(--bg-primary);color:#fff"></textarea>
            </div>

            <!-- Instru√ß√µes -->
            <div style="margin-bottom:16px">
                <div style="font-size:16px;font-weight:700;margin-bottom:16px;color:var(--accent)">üìö Como Usar</div>

                <div style="background:linear-gradient(135deg, rgba(16,185,129,0.15), rgba(59,130,246,0.15));padding:20px;border-radius:12px;margin-bottom:16px;border:2px solid var(--success)">
                    <div style="font-weight:700;margin-bottom:12px;font-size:16px">üöÄ M√©todo Manual (Com API Key)</div>
                    <ol style="line-height:1.8;color:var(--text-primary);padding-left:20px">
                        <li>Cole sua API Key no campo acima e clique em <strong>"üíæ Salvar"</strong></li>
                        <li>Clique em <strong>"üîç Testar"</strong> para verificar a conex√£o</li>
                        <li>No app Pushcut no iPhone, crie uma notifica√ß√£o chamada <strong>"Tarefa"</strong></li>
                        <li>Volte aqui e clique em <strong>"üöÄ Enviar Notifica√ß√µes Agora"</strong> quando desejar enviar</li>
                        <li>As notifica√ß√µes ser√£o configuradas para 5 minutos antes de cada tarefa üéâ</li>
                    </ol>
                    <div style="margin-top:12px;padding:12px;background:rgba(16,185,129,0.2);border-radius:8px;font-size:14px;font-weight:600">
                        üìå <strong>Importante:</strong> As notifica√ß√µes n√£o s√£o enviadas automaticamente. Voc√™ precisa clicar no bot√£o para enviar quando desejar.
                    </div>
                </div>

                <div style="background:var(--surface-hover);padding:20px;border-radius:12px">
                    <div style="font-weight:600;margin-bottom:12px">üìã M√©todo Manual (Sem API Key - Gratuito)</div>
                    <ol style="line-height:1.8;color:var(--text-secondary);padding-left:20px">
                        <li>Clique em <strong>"üìã Copiar JSON"</strong> acima</li>
                        <li>Abra o app <strong>Shortcuts</strong> no seu iPhone</li>
                        <li>Crie uma automa√ß√£o que roda de manh√£ (ex: 06:00)</li>
                        <li>Use o JSON copiado para programar notifica√ß√µes locais</li>
                        <li>Configure cada notifica√ß√£o usando o campo "horarioNotificacao"</li>
                    </ol>
                    <div style="margin-top:12px;padding:12px;background:rgba(100,116,139,0.1);border-radius:8px;font-size:13px">
                        üí° Este m√©todo requer mais configura√ß√£o manual, mas funciona sem custo adicional.
                    </div>
                </div>
            </div>

            <div class="form-actions" style="flex-wrap:wrap">
                <button class="btn btn-primary btn-lg" onclick="gerarNotificacoesPushcut()">üîÑ Atualizar JSON</button>
                <button class="btn btn-success btn-lg" onclick="enviarNotificacoesPushcut()" id="btnEnviarPushcut">üöÄ Enviar Notifica√ß√µes Agora</button>
                <button class="btn btn-secondary" onclick="fecharModal('modalPushcut')">Fechar</button>
            </div>
            <div id="statusEnvio" style="margin-top:16px;padding:12px;border-radius:8px;display:none"></div>
        </div>
    </div>

    <script>
        const KEY_PROJETOS = 'tarefas_projetos_v2';
        const KEY_ROTINA = 'tarefas_rotina_v5';
        const KEY_HISTORICO = 'historico_rotina_v5';
        const KEY_CATEGORIAS = 'categorias_rotina_v4';
        const KEY_AVALIACOES = 'avaliacoes_diarias_v1';
        const KEY_PUSHCUT_API = 'pushcut_api_key_v1';
        const COLUNAS = ['A Fazer', 'Fazendo', 'Revis√£o', 'Bloqueado', 'Conclu√≠da'];

        let tarefas = [];
        let contador = 0;
        let tarefasRotina = [];
        let contadorRotina = 0;
        let historico = [];
        let streak = 0;
        let conquistas = {};
        let categorias = [];
        let draggedTask = null;
        let diaAtual = null; // Ser√° inicializado em carregarDados
        let darkMode = false;
        let filtroStatus = null;
        let avaliacoesDiarias = [];

        const CONQUISTAS_LISTA = [{
                id: 'primeira',
                icon: 'üåü',
                nome: 'Primeira!',
                requisito: () => getTotalConcluidas() >= 1
            },
            {
                id: '5tarefas',
                icon: '‚≠ê',
                nome: '5 tarefas',
                requisito: () => getTotalConcluidas() >= 5
            },
            {
                id: '25tarefas',
                icon: 'üå†',
                nome: '25 tarefas',
                requisito: () => getTotalConcluidas() >= 25
            },
            {
                id: '50tarefas',
                icon: '‚ú®',
                nome: '50 tarefas',
                requisito: () => getTotalConcluidas() >= 50
            },
            {
                id: '100tarefas',
                icon: 'üí´',
                nome: '100 tarefas',
                requisito: () => getTotalConcluidas() >= 100
            },
            {
                id: 'streak3',
                icon: 'üî•',
                nome: '3 dias',
                requisito: () => streak >= 3
            },
            {
                id: 'streak7',
                icon: 'üèÜ',
                nome: '7 dias',
                requisito: () => streak >= 7
            },
            {
                id: 'streak30',
                icon: 'üëë',
                nome: '30 dias',
                requisito: () => streak >= 30
            }
        ];

        // PUSHCUT - NOTIFICA√á√ïES
        function abrirModalPushcut() {
            carregarApiKeyPushcut();
            gerarNotificacoesPushcut();
            $('modalPushcut').classList.add('ativo');
        }

        function gerarNotificacoesPushcut() {
            // Filtrar tarefas que t√™m hor√°rios e n√£o est√£o conclu√≠das nem pausadas
            const tarefasComHorarios = tarefasRotina.filter(t =>
                t.horarios &&
                t.horarios.length > 0 &&
                !t.concluida &&
                !t.pausada
            );

            const notificacoes = [];

            tarefasComHorarios.forEach(tarefa => {
                tarefa.horarios.forEach(horario => {
                    // Calcular hor√°rio 5 minutos antes
                    const horarioNotificacao = calcularHorarioAntes(horario, 5);

                    notificacoes.push({
                        tarefa: tarefa.nome,
                        categoria: tarefa.categoria || 'Sem categoria',
                        prioridade: tarefa.prioridade || 'M√©dia',
                        horarioOriginal: horario,
                        horarioNotificacao: horarioNotificacao,
                        tempoEstimado: tarefa.tempoEstimado || 0,
                        recorrencia: tarefa.recorrencia || 'unica',
                        id: tarefa.id
                    });
                });
            });

            // Ordenar por hor√°rio de notifica√ß√£o
            notificacoes.sort((a, b) => {
                const timeA = a.horarioNotificacao.split(':').map(Number);
                const timeB = b.horarioNotificacao.split(':').map(Number);
                return (timeA[0] * 60 + timeA[1]) - (timeB[0] * 60 + timeB[1]);
            });

            const resultado = {
                data: new Date().toISOString().split('T')[0],
                dataExportacao: new Date().toISOString(),
                totalNotificacoes: notificacoes.length,
                notificacoes: notificacoes
            };

            // Exibir no textarea
            $('jsonPushcut').value = JSON.stringify(resultado, null, 2);

            // Atualizar estat√≠sticas
            const stats = `${notificacoes.length} notifica√ß√£o(√µes) programada(s) para hoje`;
            $('estatisticasPushcut').innerHTML = `
                <div style="margin-bottom:8px">${stats}</div>
                <div style="font-size:13px">
                    ${tarefasComHorarios.length} tarefa(s) com hor√°rio(s) definido(s)<br>
                    Total de hor√°rios: ${tarefasComHorarios.reduce((sum, t) => sum + t.horarios.length, 0)}
                </div>
            `;

            return resultado;
        }

        function calcularHorarioAntes(horario, minutos) {
            // Espera hor√°rio no formato "HH:MM"
            const [horas, mins] = horario.split(':').map(Number);

            let totalMinutos = horas * 60 + mins - minutos;

            // Ajustar se passou da meia-noite
            if (totalMinutos < 0) {
                totalMinutos += 24 * 60;
            }

            const novasHoras = Math.floor(totalMinutos / 60);
            const novosMinutos = totalMinutos % 60;

            return `${String(novasHoras).padStart(2, '0')}:${String(novosMinutos).padStart(2, '0')}`;
        }

        function copiarJsonPushcut() {
            const textarea = $('jsonPushcut');
            textarea.select();
            textarea.setSelectionRange(0, 99999); // Para mobile

            try {
                // M√©todo moderno
                navigator.clipboard.writeText(textarea.value).then(() => {
                    mostrarToast('JSON copiado para √°rea de transfer√™ncia!', 'success');
                }).catch(() => {
                    // Fallback para m√©todo antigo
                    document.execCommand('copy');
                    mostrarToast('JSON copiado!', 'success');
                });
            } catch (err) {
                // Fallback final
                try {
                    document.execCommand('copy');
                    mostrarToast('JSON copiado!', 'success');
                } catch (e) {
                    mostrarToast('Erro ao copiar. Copie manualmente.', 'error');
                }
            }
        }

        function salvarApiKeyPushcut() {
            const apiKey = $('pushcutApiKey').value.trim();

            if (apiKey) {
                localStorage.setItem(KEY_PUSHCUT_API, apiKey);
                mostrarToast('API Key salva com sucesso!', 'success');
            } else {
                localStorage.removeItem(KEY_PUSHCUT_API);
                mostrarToast('API Key removida', 'success');
            }
        }

        function carregarApiKeyPushcut() {
            const apiKey = localStorage.getItem(KEY_PUSHCUT_API);
            if (apiKey && $('pushcutApiKey')) {
                $('pushcutApiKey').value = apiKey;
            }
        }

        async function enviarNotificacoesPushcut() {
            const apiKey = localStorage.getItem(KEY_PUSHCUT_API);

            if (!apiKey || apiKey.trim() === '') {
                mostrarToast('Configure sua API Key do Pushcut primeiro!', 'error');
                return;
            }

            const dados = gerarNotificacoesPushcut();

            if (!dados.notificacoes || dados.notificacoes.length === 0) {
                mostrarToast('Nenhuma tarefa com hor√°rio para enviar!', 'error');
                return;
            }

            const statusDiv = $('statusEnvio');
            statusDiv.style.display = 'block';
            statusDiv.style.background = 'rgba(59,130,246,0.1)';
            statusDiv.style.color = 'var(--text-primary)';
            statusDiv.innerHTML = '‚è≥ Enviando notifica√ß√µes...';

            const btnEnviar = $('btnEnviarPushcut');
            btnEnviar.disabled = true;
            btnEnviar.textContent = '‚è≥ Enviando...';

            let sucessos = 0;
            let erros = 0;

            for (const notif of dados.notificacoes) {
                try {
                    // Pushcut API - criar notifica√ß√£o programada
                    const response = await fetch('https://api.pushcut.io/v1/notifications/Tarefa', {
                        method: 'POST',
                        headers: {
                            'API-Key': apiKey,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title: `‚è∞ ${notif.categoria}`,
                            text: `${notif.tarefa}\nüïê Hor√°rio: ${notif.horarioOriginal}`,
                            isTimeSensitive: notif.prioridade === 'Alta' || notif.prioridade === 'Urgente',
                            input: {
                                horario: notif.horarioOriginal,
                                tarefa: notif.tarefa,
                                categoria: notif.categoria,
                                id: notif.id
                            }
                        })
                    });

                    if (response.ok) {
                        sucessos++;
                        statusDiv.innerHTML = `‚úÖ Enviando: ${sucessos}/${dados.notificacoes.length} conclu√≠das...`;
                    } else {
                        erros++;
                        console.error('Erro ao enviar:', await response.text());
                    }
                } catch (error) {
                    erros++;
                    console.error('Erro:', error);
                }
            }

            btnEnviar.disabled = false;
            btnEnviar.textContent = 'üöÄ Enviar Notifica√ß√µes Agora';

            if (erros === 0) {
                statusDiv.style.background = 'rgba(16,185,129,0.1)';
                statusDiv.innerHTML = `‚úÖ <strong>Sucesso!</strong> ${sucessos} notifica√ß√£o(√µes) enviada(s) para o Pushcut!<br><small style="margin-top:8px;display:block">Configure as notifica√ß√µes programadas no app Pushcut no seu iPhone.</small>`;
                mostrarToast(`${sucessos} notifica√ß√µes enviadas!`, 'success');
                lancarConfete();
            } else {
                statusDiv.style.background = 'rgba(239,68,68,0.1)';
                statusDiv.innerHTML = `‚ö†Ô∏è Conclu√≠do com ${erros} erro(s). ${sucessos} enviadas com sucesso.<br><small style="margin-top:8px;display:block">Verifique se sua API Key est√° correta e se voc√™ criou uma notifica√ß√£o chamada "Tarefa" no Pushcut.</small>`;
                mostrarToast(`${sucessos} enviadas, ${erros} com erro`, 'error');
            }
        }

        async function testarConexaoPushcut() {
            const apiKey = localStorage.getItem(KEY_PUSHCUT_API);

            if (!apiKey) {
                mostrarToast('Configure sua API Key primeiro!', 'error');
                return;
            }

            try {
                const response = await fetch('https://api.pushcut.io/v1/notifications/Tarefa', {
                    method: 'POST',
                    headers: {
                        'API-Key': apiKey,
                        'Content-Type': 'application/json'
                    },
                    body: JSON.stringify({
                        title: '‚úÖ Teste de Conex√£o',
                        text: 'Pushcut conectado com sucesso ao Gerenciador Pro!'
                    })
                });

                if (response.ok) {
                    mostrarToast('‚úÖ Conex√£o testada! Verifique o Pushcut', 'success');
                } else {
                    const erro = await response.text();
                    mostrarToast('‚ùå Erro na API: ' + erro, 'error');
                }
            } catch (error) {
                mostrarToast('‚ùå Erro de conex√£o: ' + error.message, 'error');
            }
        }

        async function enviarTarefaParaPushcut(tarefa) {
            const apiKey = localStorage.getItem(KEY_PUSHCUT_API);

            // Se n√£o tiver API Key, n√£o faz nada (silencioso)
            if (!apiKey || apiKey.trim() === '') {
                return;
            }

            // Se tarefa n√£o tiver hor√°rios, n√£o envia
            if (!tarefa.horarios || tarefa.horarios.length === 0) {
                return;
            }

            // Enviar uma notifica√ß√£o para cada hor√°rio da tarefa
            let totalEnviados = 0;

            for (const horario of tarefa.horarios) {
                const horarioNotificacao = calcularHorarioAntes(horario, 5);

                try {
                    const response = await fetch('https://api.pushcut.io/v1/notifications/Tarefa', {
                        method: 'POST',
                        headers: {
                            'API-Key': apiKey,
                            'Content-Type': 'application/json'
                        },
                        body: JSON.stringify({
                            title: `‚è∞ ${tarefa.categoria || 'Tarefa'}`,
                            text: `${tarefa.nome}\nüïê Hor√°rio: ${horario}`,
                            isTimeSensitive: tarefa.prioridade === 'Alta' || tarefa.prioridade === 'Urgente',
                            input: {
                                horario: horario,
                                horarioNotificacao: horarioNotificacao,
                                tarefa: tarefa.nome,
                                categoria: tarefa.categoria || 'Sem categoria',
                                prioridade: tarefa.prioridade || 'M√©dia',
                                id: tarefa.id
                            }
                        })
                    });

                    if (response.ok) {
                        totalEnviados++;
                    }
                } catch (error) {
                    console.error('Erro ao enviar notifica√ß√£o:', error);
                }
            }

            if (totalEnviados > 0) {
                mostrarToast(`üì± ${totalEnviados} notifica√ß√£o(√µes) enviada(s) para Pushcut!`, 'success');
            }
        }

        function init() {
            carregarDados();
            renderizarProjetos();
            renderizarRotina();
            setupEventos();
            verificarDarkMode();
            iniciarVerificacaoDiaria();
        }

        async function sincronizarTarefasPushcut() {
            const apiKey = localStorage.getItem(KEY_PUSHCUT_API);

            // Se n√£o tiver API Key, n√£o faz nada
            if (!apiKey || apiKey.trim() === '') {
                return;
            }

            // Esperar 2 segundos para n√£o sobrecarregar na inicializa√ß√£o
            await new Promise(resolve => setTimeout(resolve, 2000));

            // Filtrar tarefas com hor√°rios que n√£o est√£o conclu√≠das nem pausadas
            const tarefasParaEnviar = tarefasRotina.filter(t =>
                t.horarios &&
                t.horarios.length > 0 &&
                !t.concluida &&
                !t.pausada
            );

            if (tarefasParaEnviar.length === 0) {
                return;
            }

            let totalEnviados = 0;

            for (const tarefa of tarefasParaEnviar) {
                for (const horario of tarefa.horarios) {
                    const horarioNotificacao = calcularHorarioAntes(horario, 5);

                    try {
                        const response = await fetch('https://api.pushcut.io/v1/notifications/Tarefa', {
                            method: 'POST',
                            headers: {
                                'API-Key': apiKey,
                                'Content-Type': 'application/json'
                            },
                            body: JSON.stringify({
                                title: `‚è∞ ${tarefa.categoria || 'Tarefa'}`,
                                text: `${tarefa.nome}\nüïê Hor√°rio: ${horario}`,
                                isTimeSensitive: tarefa.prioridade === 'Alta' || tarefa.prioridade === 'Urgente',
                                input: {
                                    horario: horario,
                                    horarioNotificacao: horarioNotificacao,
                                    tarefa: tarefa.nome,
                                    categoria: tarefa.categoria || 'Sem categoria',
                                    prioridade: tarefa.prioridade || 'M√©dia',
                                    id: tarefa.id
                                }
                            })
                        });

                        if (response.ok) {
                            totalEnviados++;
                        }

                        // Pequeno delay entre envios para n√£o sobrecarregar
                        await new Promise(resolve => setTimeout(resolve, 300));
                    } catch (error) {
                        console.error('Erro ao sincronizar:', error);
                    }
                }
            }

            if (totalEnviados > 0) {
                mostrarToast(`üîÑ ${totalEnviados} notifica√ß√£o(√µes) sincronizada(s) automaticamente!`, 'success');
            }
        }

        function carregarDados() {
            try {
                const dados = JSON.parse(localStorage.getItem(KEY_PROJETOS));
                if (dados) {
                    tarefas = dados.tarefas || [];
                    contador = dados.contador || 0
                }
            } catch (e) {
                tarefas = [];
                contador = 0
            }

            try {
                const dadosRotina = JSON.parse(localStorage.getItem(KEY_ROTINA));
                if (dadosRotina) {
                    tarefasRotina = dadosRotina.tarefas || [];
                    contadorRotina = dadosRotina.contador || 0;
                    streak = dadosRotina.streak || 0;
                    conquistas = dadosRotina.conquistas || {};
                    diaAtual = dadosRotina.ultimoReset || new Date().toDateString();
                    verificarResetDiario();
                }
            } catch (e) {
                tarefasRotina = [];
                contadorRotina = 0;
                streak = 0;
                conquistas = {};
                diaAtual = new Date().toDateString();
            }

            try {
                historico = JSON.parse(localStorage.getItem(KEY_HISTORICO)) || [];
            } catch (e) {
                historico = []
            }

            try {
                categorias = JSON.parse(localStorage.getItem(KEY_CATEGORIAS)) || [{
                        nome: 'Casa',
                        cor: '#3b82f6',
                        emoji: 'üè†'
                    },
                    {
                        nome: 'Sa√∫de',
                        cor: '#10b981',
                        emoji: 'üí™'
                    },
                    {
                        nome: 'Pets',
                        cor: '#f59e0b',
                        emoji: 'üêæ'
                    },
                    {
                        nome: 'Outros',
                        cor: '#8b5cf6',
                        emoji: '‚ú®'
                    }
                ];
            } catch (e) {
                categorias = [{
                        nome: 'Casa',
                        cor: '#3b82f6',
                        emoji: 'üè†'
                    },
                    {
                        nome: 'Sa√∫de',
                        cor: '#10b981',
                        emoji: 'üí™'
                    },
                    {
                        nome: 'Pets',
                        cor: '#f59e0b',
                        emoji: 'üêæ'
                    },
                    {
                        nome: 'Outros',
                        cor: '#8b5cf6',
                        emoji: '‚ú®'
                    }
                ];
            }

            try {
                avaliacoesDiarias = JSON.parse(localStorage.getItem(KEY_AVALIACOES)) || [];
            } catch (e) {
                avaliacoesDiarias = [];
            }
        }

        function salvarDados() {
            localStorage.setItem(KEY_PROJETOS, JSON.stringify({
                tarefas,
                contador
            }));
            localStorage.setItem(KEY_ROTINA, JSON.stringify({
                tarefas: tarefasRotina,
                contador: contadorRotina,
                streak,
                conquistas,
                ultimoReset: diaAtual
            }));
            localStorage.setItem(KEY_HISTORICO, JSON.stringify(historico));
            localStorage.setItem(KEY_CATEGORIAS, JSON.stringify(categorias));
            localStorage.setItem(KEY_AVALIACOES, JSON.stringify(avaliacoesDiarias));
        }

        // PROJETOS
        function salvarTarefa(e) {
            e.preventDefault();
            const titulo = $('titulo').value.trim();
            if (!titulo) {
                mostrarToast('Preencha o t√≠tulo', 'error');
                return
            }
            const editId = $('editId').value;
            if (editId) {
                const task = tarefas.find(t => t.id === editId);
                if (task) {
                    Object.assign(task, {
                        titulo,
                        descricao: $('descricao').value.trim(),
                        responsavel: $('responsavel').value.trim(),
                        tipo: $('tipo').value,
                        prioridade: $('prioridade').value,
                        status: $('status').value,
                        dataPrevista: $('dataPrevista').value,
                        atualizado: new Date().toISOString()
                    });
                    mostrarToast('Atualizada!', 'success');
                }
            } else {
                contador++;
                tarefas.unshift({
                    id: 'T-' + String(contador).padStart(4, '0'),
                    titulo,
                    descricao: $('descricao').value.trim(),
                    responsavel: $('responsavel').value.trim(),
                    tipo: $('tipo').value,
                    prioridade: $('prioridade').value,
                    status: $('status').value,
                    dataPrevista: $('dataPrevista').value,
                    criado: new Date().toISOString(),
                    atualizado: new Date().toISOString()
                });
                mostrarToast('Criada!', 'success');
            }
            salvarDados();
            renderizarProjetos();
            cancelarEdicao();
        }

        function editarTarefa(id) {
            const task = tarefas.find(t => t.id === id);
            if (!task) return;
            $('formModo').textContent = '‚úèÔ∏è Editar';
            $('btnSalvar').textContent = 'Salvar';
            $('editId').value = task.id;
            $('titulo').value = task.titulo;
            $('descricao').value = task.descricao || '';
            $('responsavel').value = task.responsavel || '';
            $('tipo').value = task.tipo;
            $('prioridade').value = task.prioridade;
            $('status').value = task.status;
            $('dataPrevista').value = task.dataPrevista || '';
            window.scrollTo({
                top: 0,
                behavior: 'smooth'
            });
        }

        function excluirTarefa(id) {
            if (!confirm('Excluir?')) return;
            tarefas = tarefas.filter(t => t.id !== id);
            salvarDados();
            renderizarProjetos();
            mostrarToast('Exclu√≠da', 'success');
        }

        function cancelarEdicao() {
            $('taskForm').reset();
            $('formModo').textContent = '‚ûï Nova Tarefa';
            $('btnSalvar').textContent = 'Adicionar';
            $('editId').value = '';
            $('prioridade').value = 'M√©dia';
        }

        function mudarStatus(id, novoStatus) {
            const task = tarefas.find(t => t.id === id);
            if (task) {
                task.status = novoStatus;
                task.atualizado = new Date().toISOString();
                salvarDados();
                renderizarProjetos();
            }
        }

        function renderizarProjetos() {
            const busca = $('busca').value.toLowerCase();
            const filtroSt = $('filtroStatus').value;
            const filtroPr = $('filtroPrioridade').value;
            const tarefasFiltradas = tarefas.filter(t => {
                const matchBusca = !busca || `${t.titulo} ${t.responsavel} ${t.descricao}`.toLowerCase().includes(busca);
                const matchStatus = !filtroSt || t.status === filtroSt;
                const matchPriori = !filtroPr || t.prioridade === filtroPr;
                return matchBusca && matchStatus && matchPriori;
            });
            const kanban = $('kanban');
            kanban.innerHTML = '';
            COLUNAS.forEach(coluna => {
                const tarefasColuna = tarefasFiltradas.filter(t => t.status === coluna);
                const colDiv = document.createElement('div');
                colDiv.className = 'column';
                colDiv.dataset.status = coluna;
                colDiv.innerHTML = `<div class="column-header"><span class="column-title">${coluna}</span><span class="column-count">${tarefasColuna.length}</span></div>`;
                tarefasColuna.forEach(task => {
                    const card = criarCard(task);
                    colDiv.appendChild(card);
                });
                kanban.appendChild(colDiv);
            });
            $('stats').textContent = `${tarefasFiltradas.length} de ${tarefas.length}`;
        }

        function criarCard(task) {
            const card = document.createElement('div');
            card.className = 'task-card';
            card.draggable = true;
            card.dataset.id = task.id;
            const desc = task.descricao ? (task.descricao.slice(0, 120) + (task.descricao.length > 120 ? '...' : '')) : '';
            card.innerHTML = `
    <div class="task-header">
      <span class="task-id">${task.id}</span>
      <span class="tag tag-priority ${task.prioridade}">${task.prioridade}</span>
    </div>
    <div class="task-title">${esc(task.titulo)}</div>
    <div class="task-meta">
      <span class="tag tag-type">${task.tipo}</span>
      ${task.dataPrevista?`<span style="font-size:11px">üìÖ ${formatarData(task.dataPrevista)}</span>`:''}
    </div>
    ${desc?`<div class="task-desc">${esc(desc)}</div>`:''}
    <div class="task-footer">
      <div class="task-assignee">${task.responsavel?'üë§ '+esc(task.responsavel):'‚Äî'}</div>
      <div class="task-actions">
        <button class="btn btn-sm btn-primary" onclick="editarTarefa('${task.id}')">‚úèÔ∏è</button>
        <button class="btn btn-sm btn-danger" onclick="excluirTarefa('${task.id}')">üóëÔ∏è</button>
      </div>
    </div>
  `;
            return card;
        }

        function limparFiltros() {
            $('busca').value = '';
            $('filtroStatus').value = '';
            $('filtroPrioridade').value = '';
            renderizarProjetos();
        }

        // ROTINA
        function adicionarTarefaRotina(e) {
            e.preventDefault();
            const nome = $('nomeTarefaRotina').value.trim();
            if (!nome) return;

            const horariosStr = $('horariosRotina').value.trim();
            const horarios = horariosStr ? horariosStr.split(',').map(h => h.trim()).filter(h => h) : [];

            const subs = $('subtarefas').value.trim().split('\n').filter(s => s.trim()).map(s => ({
                texto: s.trim(),
                concluida: false
            }));

            const editId = $('editIdRotina').value;
            if (editId) {
                const tarefa = tarefasRotina.find(t => t.id === editId);
                if (tarefa) {
                    Object.assign(tarefa, {
                        nome,
                        categoria: $('categoriaRotina').value,
                        prioridade: $('prioridadeRotina').value,
                        horarios,
                        tempoEstimado: parseInt($('tempoEstimado').value) || 0,
                        recorrencia: $('recorrenciaRotina').value,
                        quantidadeTotal: parseInt($('quantidadeDia').value) || 1,
                        subtarefas: subs
                    });
                    salvarDados();
                    renderizarRotina();
                    cancelarEdicaoRotina();
                    mostrarToast('Tarefa atualizada!', 'success');
                    return;
                }
            }

            contadorRotina++;
            const novaTarefa = {
                id: 'R-' + String(contadorRotina).padStart(4, '0'),
                nome,
                categoria: $('categoriaRotina').value,
                prioridade: $('prioridadeRotina').value,
                horarios,
                tempoEstimado: parseInt($('tempoEstimado').value) || 0,
                recorrencia: $('recorrenciaRotina').value,
                quantidadeTotal: parseInt($('quantidadeDia').value) || 1,
                quantidadeAtual: 0,
                subtarefas: subs,
                concluida: false,
                pausada: false,
                humor: null,
                criado: new Date().toISOString()
            };

            tarefasRotina.push(novaTarefa);
            salvarDados();
            renderizarRotina();
            cancelarEdicaoRotina();
            mostrarToast('Tarefa adicionada!', 'success');
        }

        function editarTarefaRotina(id) {
            const tarefa = tarefasRotina.find(t => t.id === id);
            if (!tarefa) return;

            $('tituloModalRotina').textContent = '‚úèÔ∏è Editar Tarefa de Rotina';
            $('btnSalvarRotina').textContent = 'Salvar';
            $('editIdRotina').value = tarefa.id;
            $('nomeTarefaRotina').value = tarefa.nome;
            $('categoriaRotina').value = tarefa.categoria || '';
            $('prioridadeRotina').value = tarefa.prioridade || 'M√©dia';
            $('horariosRotina').value = tarefa.horarios ? tarefa.horarios.join(', ') : '';
            $('tempoEstimado').value = tarefa.tempoEstimado || '';
            $('recorrenciaRotina').value = tarefa.recorrencia || 'unica';
            $('quantidadeDia').value = tarefa.quantidadeTotal || 1;
            $('subtarefas').value = tarefa.subtarefas ? tarefa.subtarefas.map(s => s.texto).join('\n') : '';

            $('modalNovaTarefa').classList.add('ativo');
        }

        function cancelarEdicaoRotina() {
            $('formRotina').reset();
            $('tituloModalRotina').textContent = '‚ûï Nova Tarefa de Rotina';
            $('btnSalvarRotina').textContent = 'Adicionar';
            $('editIdRotina').value = '';
            $('quantidadeDia').value = '1';
            $('prioridadeRotina').value = 'M√©dia';
            fecharModal('modalNovaTarefa');
        }

        function toggleTarefaRotina(id) {
            const tarefa = tarefasRotina.find(t => t.id === id);
            if (!tarefa) return;

            if (tarefa.quantidadeTotal > 1) {
                if (tarefa.quantidadeAtual < tarefa.quantidadeTotal) {
                    tarefa.quantidadeAtual++;
                    if (tarefa.quantidadeAtual >= tarefa.quantidadeTotal) {
                        tarefa.concluida = true;
                        lancarConfete();
                        verificarConquistas();
                    }
                    mostrarToast(`${tarefa.quantidadeAtual}/${tarefa.quantidadeTotal}`, 'success');
                } else {
                    tarefa.quantidadeAtual = 0;
                    tarefa.concluida = false;
                    tarefa.humor = null;
                }
            } else {
                tarefa.concluida = !tarefa.concluida;
                if (!tarefa.concluida) {
                    tarefa.humor = null;
                }
                if (tarefa.concluida) {
                    lancarConfete();
                    verificarConquistas();
                }
            }

            salvarDados();
            atualizarHistorico();
            renderizarRotina();
        }

        function incrementarQuantidade(id) {
            const tarefa = tarefasRotina.find(t => t.id === id);
            if (!tarefa || tarefa.quantidadeAtual >= tarefa.quantidadeTotal) return;
            tarefa.quantidadeAtual++;
            if (tarefa.quantidadeAtual >= tarefa.quantidadeTotal) {
                tarefa.concluida = true;
                lancarConfete();
                verificarConquistas();
            }
            salvarDados();
            atualizarHistorico();
            renderizarRotina();
        }

        function decrementarQuantidade(id) {
            const tarefa = tarefasRotina.find(t => t.id === id);
            if (!tarefa || tarefa.quantidadeAtual <= 0) return;
            tarefa.quantidadeAtual--;
            tarefa.concluida = false;
            salvarDados();
            renderizarRotina();
        }

        function definirHumorTarefa(id, humor) {
            const tarefa = tarefasRotina.find(t => t.id === id);
            if (!tarefa) return;

            const motivo = prompt(`Por que voc√™ se sentiu ${humor === 'feliz' ? 'üòä feliz' : humor === 'neutro' ? 'üòê neutro' : humor === 'triste' ? 'üòî triste' : humor === 'cansado' ? 'üò¥ cansado' : 'üò§ bravo'} ao fazer "${tarefa.nome}"? (opcional)`);

            if (motivo === null) return; // Usu√°rio cancelou

            tarefa.humor = humor;
            tarefa.humorMotivo = motivo || '';
            tarefa.humorData = new Date().toISOString();

            salvarDados();
            renderizarRotina();
            mostrarToast('Humor registrado!', 'success');
        }

        function toggleSubtarefa(tarefaId, subIdx) {
            const tarefa = tarefasRotina.find(t => t.id === tarefaId);
            if (!tarefa || !tarefa.subtarefas[subIdx]) return;
            tarefa.subtarefas[subIdx].concluida = !tarefa.subtarefas[subIdx].concluida;
            salvarDados();
            renderizarRotina();
        }

        function excluirTarefaRotina(id) {
            if (!confirm('Excluir?')) return;
            tarefasRotina = tarefasRotina.filter(t => t.id !== id);
            salvarDados();
            renderizarRotina();
            mostrarToast('Exclu√≠da', 'success');
        }

        function pausarTarefa(id) {
            const tarefa = tarefasRotina.find(t => t.id === id);
            if (!tarefa) return;

            if (!tarefa.pausada) {
                const motivo = prompt('Por que est√° pausando?');
                if (!motivo) return;
                tarefa.motivoPausa = motivo;
            }

            tarefa.pausada = !tarefa.pausada;
            salvarDados();
            renderizarRotina();
            mostrarToast(tarefa.pausada ? '‚è∏Ô∏è Pausada' : '‚ñ∂Ô∏è Retomada', 'success');
        }

        function verificarResetDiario() {
            const hoje = new Date().toDateString();
            if (diaAtual && diaAtual !== hoje) {
                // S√≥ processa hist√≥rico se j√° tinha um dia anterior salvo
                const ontem = diaAtual;
                const totalOntem = tarefasRotina.filter(t => t.recorrencia === 'diaria').length;
                const concluidasOntem = tarefasRotina.filter(t => t.recorrencia === 'diaria' && t.concluida).length;

                if (totalOntem > 0) {
                    historico.unshift({
                        data: ontem,
                        total: totalOntem,
                        concluidas: concluidasOntem,
                        porcentagem: Math.round((concluidasOntem / totalOntem) * 100)
                    });
                    if (historico.length > 365) historico = historico.slice(0, 365);
                }

                if (concluidasOntem >= totalOntem * 0.8) {
                    streak++;
                } else {
                    streak = 0;
                }

                tarefasRotina.forEach(t => {
                    if (t.recorrencia === 'diaria') {
                        t.concluida = false;
                        t.quantidadeAtual = 0;
                        t.pausada = false;
                        // N√£o apagar humor/motivo - mant√©m hist√≥rico do dia anterior
                        // t.humor = null;
                        // t.humorMotivo = null;
                    }
                });
            }

            // Sempre atualiza diaAtual para o dia de hoje
            diaAtual = hoje;
            salvarDados();
        }

        function atualizarHistorico() {
            const idx = historico.findIndex(h => h.data === diaAtual);
            const total = tarefasRotina.filter(t => t.recorrencia === 'diaria').length;
            const concluidas = tarefasRotina.filter(t => t.recorrencia === 'diaria' && t.concluida).length;

            const dados = {
                data: diaAtual,
                total,
                concluidas,
                porcentagem: total > 0 ? Math.round((concluidas / total) * 100) : 0
            };

            if (idx >= 0) {
                historico[idx] = dados;
            } else {
                historico.unshift(dados);
            }

            salvarDados();
        }

        function renderizarRotina() {
            atualizarHUD();
            atualizarProgresso();
            renderizarListaTarefas();
            renderizarConquistas();
            renderizarGrafico();
            renderizarCalendario();
            atualizarSelectCategorias();
            renderizarResumoAvaliacao();
            renderizarRotinaSimplificada();
        }

        function renderizarRotinaSimplificada() {
            const lista = $('listaRotinaSimplificada');
            const info = $('infoRotinaSimples');

            if (!lista || !info) return;

            // Preparar tarefas com hor√°rios expandidos
            const tarefasExpandidas = [];

            tarefasRotina.forEach(tarefa => {
                if (tarefa.horarios && tarefa.horarios.length > 0) {
                    // Para cada hor√°rio, criar uma entrada separada
                    tarefa.horarios.forEach(horario => {
                        tarefasExpandidas.push({
                            ...tarefa,
                            horarioAtual: horario
                        });
                    });
                } else {
                    // Tarefas sem hor√°rio definido
                    tarefasExpandidas.push({
                        ...tarefa,
                        horarioAtual: null
                    });
                }
            });

            // Ordenar por hor√°rio
            tarefasExpandidas.sort((a, b) => {
                if (!a.horarioAtual) return 1;
                if (!b.horarioAtual) return -1;

                const timeA = a.horarioAtual.split(':').map(Number);
                const timeB = b.horarioAtual.split(':').map(Number);
                return (timeA[0] * 60 + timeA[1]) - (timeB[0] * 60 + timeB[1]);
            });

            // Atualizar info
            const totalTarefas = tarefasRotina.length;
            const totalConcluidas = tarefasRotina.filter(t => t.concluida).length;
            const totalComHorario = tarefasExpandidas.filter(t => t.horarioAtual).length;

            info.innerHTML = `
                ${totalTarefas} tarefa${totalTarefas !== 1 ? 's' : ''} no total ‚Ä¢ 
                ${totalConcluidas} conclu√≠da${totalConcluidas !== 1 ? 's' : ''} ‚Ä¢ 
                ${totalComHorario} com hor√°rio definido
            `;

            // Renderizar lista
            lista.innerHTML = '';

            if (tarefasExpandidas.length === 0) {
                lista.innerHTML = `
                    <div style="text-align:center;padding:60px 20px;color:var(--text-secondary)">
                        <div style="font-size:48px;margin-bottom:16px">üìÖ</div>
                        <div style="font-size:18px;margin-bottom:12px">Nenhuma tarefa cadastrada</div>
                        <button class="btn btn-primary btn-lg" onclick="trocarAba('rotina')">‚ûï Adicionar Tarefas</button>
                    </div>
                `;
                return;
            }

            // Separar tarefas com e sem hor√°rio
            const comHorario = tarefasExpandidas.filter(t => t.horarioAtual);
            const semHorario = tarefasExpandidas.filter(t => !t.horarioAtual);

            // Renderizar tarefas com hor√°rio
            if (comHorario.length > 0) {
                comHorario.forEach(tarefa => {
                    lista.appendChild(criarItemRotinaSimples(tarefa));
                });
            }

            // Renderizar tarefas sem hor√°rio (se houver)
            if (semHorario.length > 0) {
                const divider = document.createElement('div');
                divider.style.cssText = 'margin:30px 0;padding:12px;background:var(--surface-hover);border-radius:8px;text-align:center;color:var(--text-secondary);font-weight:600;font-size:14px';
                divider.textContent = 'üìã Tarefas sem hor√°rio definido';
                lista.appendChild(divider);

                semHorario.forEach(tarefa => {
                    lista.appendChild(criarItemRotinaSimples(tarefa));
                });
            }
        }

        function criarItemRotinaSimples(tarefa) {
            const cat = categorias.find(c => c.nome === tarefa.categoria) || {
                emoji: '‚ú®',
                cor: '#8b5cf6',
                nome: 'Outros'
            };

            const item = document.createElement('div');
            item.className = 'rotina-item-simples' +
                (tarefa.concluida ? ' concluida' : '') +
                (tarefa.pausada ? ' pausada' : '');

            // Definir cor da borda baseada na prioridade
            let corBorda = 'var(--accent)';
            if (tarefa.prioridade === 'Urgente') corBorda = '#ef4444';
            else if (tarefa.prioridade === 'Alta') corBorda = '#f59e0b';
            else if (tarefa.prioridade === 'Baixa') corBorda = '#64748b';

            if (!tarefa.concluida && !tarefa.pausada) {
                item.style.borderLeftColor = corBorda;
            }

            // Descri√ß√£o (baseada em tempo estimado ou subtarefas)
            let descricao = '';
            if (tarefa.tempoEstimado && tarefa.tempoEstimado > 0) {
                descricao = `‚è±Ô∏è ${tarefa.tempoEstimado} minutos de atividade`;
            }
            if (tarefa.subtarefas && tarefa.subtarefas.length > 0) {
                const subsConcluidas = tarefa.subtarefas.filter(s => s.concluida).length;
                descricao += (descricao ? ' ‚Ä¢ ' : '') + `${subsConcluidas}/${tarefa.subtarefas.length} passos conclu√≠dos`;
            }

            const html = `
                <div class="rotina-hora">
                    ${tarefa.horarioAtual || '--:--'}
                </div>
                <div class="rotina-conteudo-simples">
                    <div class="rotina-titulo-simples">
                        ${esc(tarefa.nome)} ${tarefa.pausada ? '‚è∏Ô∏è' : ''}
                    </div>
                    ${descricao ? `<div class="rotina-descricao-simples">${descricao}</div>` : ''}
                    <div class="rotina-badges">
                        <span class="rotina-badge-simples tag-prioridade ${tarefa.prioridade}">
                            ${tarefa.prioridade}
                        </span>
                        <span class="rotina-badge-simples" style="background:${cat.cor}20;color:${cat.cor}">
                            ${cat.emoji} ${cat.nome}
                        </span>
                        ${tarefa.recorrencia && tarefa.recorrencia !== 'unica' ? 
                            `<span class="rotina-badge-simples" style="background:rgba(59,130,246,0.1);color:var(--accent)">
                                üîÑ ${tarefa.recorrencia}
                            </span>` : ''}
                        ${tarefa.quantidadeTotal > 1 ? 
                            `<span class="rotina-badge-simples" style="background:rgba(139,92,246,0.1);color:var(--purple)">
                                ${tarefa.quantidadeAtual}/${tarefa.quantidadeTotal}
                            </span>` : ''}
                    </div>
                </div>
                <div class="rotina-acoes-simples">
                    <div class="check-btn-simples ${tarefa.concluida ? 'checked' : ''}" 
                         onclick="toggleTarefaRotina('${tarefa.id}')" 
                         title="${tarefa.concluida ? 'Marcar como n√£o conclu√≠da' : 'Marcar como conclu√≠da'}">
                        ${tarefa.concluida ? '‚úì' : ''}
                    </div>
                </div>
            `;

            item.innerHTML = html;
            return item;
        }

        function atualizarHUD() {
            const afazer = tarefasRotina.filter(t => !t.concluida && !t.pausada && t.quantidadeAtual === 0).length;
            const meiofeito = tarefasRotina.filter(t => !t.concluida && t.quantidadeAtual > 0 && t.quantidadeAtual < t.quantidadeTotal).length;
            const feito = tarefasRotina.filter(t => t.concluida).length;
            const pausadas = tarefasRotina.filter(t => t.pausada).length;

            $('numAfazer').textContent = afazer;
            $('numMeiofeito').textContent = meiofeito;
            $('numFeito').textContent = feito;
            $('numPausadas').textContent = pausadas;
        }

        function atualizarProgresso() {
            const total = tarefasRotina.length;
            const concluidas = tarefasRotina.filter(t => t.concluida).length;
            const porcentagem = total > 0 ? Math.round((concluidas / total) * 100) : 0;

            $('progressoPorcentagem').textContent = porcentagem + '%';
            $('progressoBarra').style.width = porcentagem + '%';
            $('progressoTexto').textContent = `${concluidas} de ${total} conclu√≠das`;
            $('streakDias').textContent = streak;
        }

        function renderizarListaTarefas() {
            const lista = $('listaTarefasRotina');
            lista.innerHTML = '';

            let tarefasFiltradas = tarefasRotina;

            const busca = ($('buscaRotina') ? $('buscaRotina').value : '').toLowerCase();
            const filtroCat = $('filtroCategoriaRotina') ? $('filtroCategoriaRotina').value : '';
            const filtroPr = $('filtroPrioridadeRotina') ? $('filtroPrioridadeRotina').value : '';
            const filtroRec = $('filtroRecorrenciaRotina') ? $('filtroRecorrenciaRotina').value : '';

            // Filtro por status (HUD)
            if (filtroStatus === 'afazer') {
                tarefasFiltradas = tarefasRotina.filter(t => !t.concluida && !t.pausada && t.quantidadeAtual === 0);
            } else if (filtroStatus === 'meiofeito') {
                tarefasFiltradas = tarefasRotina.filter(t => !t.concluida && t.quantidadeAtual > 0 && t.quantidadeAtual < t.quantidadeTotal);
            } else if (filtroStatus === 'feito') {
                tarefasFiltradas = tarefasRotina.filter(t => t.concluida);
            } else if (filtroStatus === 'pausadas') {
                tarefasFiltradas = tarefasRotina.filter(t => t.pausada);
            }

            // Aplicar filtros adicionais
            tarefasFiltradas = tarefasFiltradas.filter(t => {
                const matchBusca = !busca ||
                    t.nome.toLowerCase().includes(busca) ||
                    (t.categoria && t.categoria.toLowerCase().includes(busca)) ||
                    (t.prioridade && t.prioridade.toLowerCase().includes(busca)) ||
                    (t.horarios && t.horarios.some(h => h.toLowerCase().includes(busca))) ||
                    (t.subtarefas && t.subtarefas.some(s => s.texto.toLowerCase().includes(busca)));
                const matchCategoria = !filtroCat || t.categoria === filtroCat;
                const matchPrioridade = !filtroPr || t.prioridade === filtroPr;
                const matchRecorrencia = !filtroRec || t.recorrencia === filtroRec;

                return matchBusca && matchCategoria && matchPrioridade && matchRecorrencia;
            });

            // Atualizar estat√≠sticas
            if ($('statsRotina')) {
                $('statsRotina').textContent = `${tarefasFiltradas.length} de ${tarefasRotina.length}`;
            }

            if (tarefasFiltradas.length === 0) {
                lista.innerHTML = '<div style="text-align:center;padding:40px;color:var(--text-secondary);font-size:16px">Nenhuma tarefa encontrada</div>';
                return;
            }

            tarefasFiltradas.sort((a, b) => {
                const prioOrdem = {
                    'Urgente': 4,
                    'Alta': 3,
                    'M√©dia': 2,
                    'Baixa': 1
                };
                return (prioOrdem[b.prioridade] || 0) - (prioOrdem[a.prioridade] || 0);
            }).forEach(t => {
                lista.appendChild(criarItemTarefa(t));
            });
        }

        function criarItemTarefa(t) {
            const cat = categorias.find(c => c.nome === t.categoria) || {
                emoji: '‚ú®',
                cor: '#8b5cf6'
            };

            const item = document.createElement('div');
            item.className = 'tarefa-item' + (t.concluida ? ' concluida' : '') + (t.pausada ? ' pausada' : '');

            let horariosHTML = '';
            if (t.horarios && t.horarios.length > 0) {
                horariosHTML = '<div class="tarefa-horarios">';
                t.horarios.forEach(h => {
                    horariosHTML += `<span class="horario-badge">üïê ${h}</span>`;
                });
                horariosHTML += '</div>';
            }

            let quantidadeHTML = '';
            if (t.quantidadeTotal > 1) {
                quantidadeHTML = `
      <div class="quantidade-display">
        <button class="quantidade-btn" onclick="event.stopPropagation();decrementarQuantidade('${t.id}')">-</button>
        <span>${t.quantidadeAtual}/${t.quantidadeTotal}</span>
        <button class="quantidade-btn" onclick="event.stopPropagation();incrementarQuantidade('${t.id}')">+</button>
      </div>
    `;
            }

            let subtarefasHTML = '';
            if (t.subtarefas && t.subtarefas.length > 0) {
                subtarefasHTML = '<div class="subtarefas">';
                t.subtarefas.forEach((sub, idx) => {
                    subtarefasHTML += `
        <div class="subtarefa-item">
          <div class="subtarefa-check ${sub.concluida?'checked':''}" onclick="toggleSubtarefa('${t.id}',${idx})">${sub.concluida?'‚úì':''}</div>
          <span style="${sub.concluida?'text-decoration:line-through':''}">${esc(sub.texto)}</span>
        </div>
      `;
                });
                subtarefasHTML += '</div>';
            }

            let humorHTML = '';
            if (t.concluida || t.quantidadeAtual > 0) {
                const humorEmoji = t.humor === 'feliz' ? 'üòä' : t.humor === 'neutro' ? 'üòê' : t.humor === 'triste' ? 'üòî' : t.humor === 'cansado' ? 'üò¥' : t.humor === 'bravo' ? 'üò§' : '';
                const motivoTexto = t.humorMotivo ? ` - ${esc(t.humorMotivo)}` : '';
                humorHTML = `
      <div class="humor-tarefa">
        <div class="humor-tarefa-label">Como foi fazer isso? ${humorEmoji}${motivoTexto}</div>
        <div class="humor-opcoes">
          <button class="humor-btn-mini ${t.humor==='feliz'?'selected':''}" onclick="definirHumorTarefa('${t.id}','feliz')" title="Feliz">üòä</button>
          <button class="humor-btn-mini ${t.humor==='neutro'?'selected':''}" onclick="definirHumorTarefa('${t.id}','neutro')" title="Neutro">üòê</button>
          <button class="humor-btn-mini ${t.humor==='triste'?'selected':''}" onclick="definirHumorTarefa('${t.id}','triste')" title="Triste">üòî</button>
          <button class="humor-btn-mini ${t.humor==='cansado'?'selected':''}" onclick="definirHumorTarefa('${t.id}','cansado')" title="Cansado">üò¥</button>
          <button class="humor-btn-mini ${t.humor==='bravo'?'selected':''}" onclick="definirHumorTarefa('${t.id}','bravo')" title="Bravo/Frustrado">üò§</button>
        </div>
      </div>
    `;
            }

            item.innerHTML = `
    <div class="checkbox-custom ${t.concluida?'checked':''}" onclick="toggleTarefaRotina('${t.id}')">
      ${t.concluida?'‚úì':''}
    </div>
    <div class="tarefa-conteudo">
      <div class="tarefa-header-linha">
        <div class="tarefa-nome">${esc(t.nome)} ${t.pausada?'‚è∏Ô∏è':''}</div>
        <span class="tag-prioridade ${t.prioridade}">${t.prioridade}</span>
        <span class="tag-categoria" style="background:${cat.cor}20;color:${cat.cor}">${cat.emoji} ${t.categoria}</span>
      </div>
      <div class="tarefa-detalhes">
        ${t.tempoEstimado?`<span class="tarefa-badge">‚è±Ô∏è ${t.tempoEstimado}min</span>`:''}
        ${t.recorrencia!=='unica'?`<span class="tarefa-badge">üîÑ ${t.recorrencia}</span>`:''}
      </div>
      ${horariosHTML}
      ${quantidadeHTML}
      ${subtarefasHTML}
      ${humorHTML}
    </div>
    <div class="tarefa-acoes">
      <button class="btn-icon" onclick="editarTarefaRotina('${t.id}')" title="Editar">‚úèÔ∏è</button>
      <button class="btn-icon" onclick="pausarTarefa('${t.id}')" title="Pausar">‚è∏Ô∏è</button>
      <button class="btn-icon" onclick="excluirTarefaRotina('${t.id}')" title="Excluir">üóëÔ∏è</button>
    </div>
  `;

            return item;
        }

        function filtrarPorStatus(status) {
            document.querySelectorAll('.hud-card').forEach(c => c.classList.remove('ativo'));

            if (filtroStatus === status) {
                filtroStatus = null;
            } else {
                filtroStatus = status;
                $('hud' + status.charAt(0).toUpperCase() + status.slice(1)).classList.add('ativo');
            }

            renderizarListaTarefas();
        }

        function limparFiltroStatus() {
            filtroStatus = null;
            document.querySelectorAll('.hud-card').forEach(c => c.classList.remove('ativo'));
            renderizarListaTarefas();
        }

        function limparFiltrosRotina() {
            if ($('buscaRotina')) $('buscaRotina').value = '';
            if ($('filtroCategoriaRotina')) $('filtroCategoriaRotina').value = '';
            if ($('filtroPrioridadeRotina')) $('filtroPrioridadeRotina').value = '';
            if ($('filtroRecorrenciaRotina')) $('filtroRecorrenciaRotina').value = '';
            filtroStatus = null;
            document.querySelectorAll('.hud-card').forEach(c => c.classList.remove('ativo'));
            renderizarRotina();
        }

        function renderizarConquistas() {
            const grid = $('conquistasGrid');
            grid.innerHTML = '';

            CONQUISTAS_LISTA.forEach(c => {
                const desbloqueada = conquistas[c.id] || c.requisito();
                if (desbloqueada && !conquistas[c.id]) {
                    conquistas[c.id] = true;
                    salvarDados();
                    mostrarToast(`üèÜ ${c.nome}!`, 'success');
                }

                const div = document.createElement('div');
                div.className = 'conquista' + (desbloqueada ? ' desbloqueada' : '');
                div.innerHTML = `
      <div class="conquista-icon">${desbloqueada?c.icon:'üîí'}</div>
      <div class="conquista-nome">${c.nome}</div>
    `;
                grid.appendChild(div);
            });
        }

        function renderizarGrafico() {
            const grafico = $('graficoSemanal');
            grafico.innerHTML = '';

            const ultimos7 = historico.slice(0, 7).reverse();
            const maxConcluidas = Math.max(...ultimos7.map(h => h.concluidas), 1);

            ultimos7.forEach(dia => {
                const altura = (dia.concluidas / maxConcluidas) * 100;
                const dataObj = new Date(dia.data);
                const diaSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'][dataObj.getDay()];

                const col = document.createElement('div');
                col.style.display = 'flex';
                col.style.flexDirection = 'column';
                col.style.alignItems = 'center';
                col.style.flex = '1';

                const barra = document.createElement('div');
                barra.className = 'grafico-barra';
                barra.style.height = altura + '%';
                barra.style.background = dia.concluidas === dia.total ? 'var(--success)' : 'var(--accent)';
                barra.title = `${dia.concluidas}/${dia.total} (${dia.porcentagem}%)`;

                col.appendChild(barra);
                col.innerHTML += `<div class="grafico-label">${diaSemana}</div>`;

                grafico.appendChild(col);
            });
        }

        function renderizarCalendario() {
            const cal = $('calendarioView');
            cal.innerHTML = '';

            const hoje = new Date();
            const diasSemana = ['Dom', 'Seg', 'Ter', 'Qua', 'Qui', 'Sex', 'S√°b'];

            for (let i = 0; i < 7; i++) {
                const data = new Date(hoje);
                data.setDate(hoje.getDate() - hoje.getDay() + i);
                const dataStr = data.toDateString();

                const hist = historico.find(h => h.data === dataStr);
                const progresso = hist ? hist.porcentagem : 0;
                const isHoje = dataStr === diaAtual;

                const dia = document.createElement('div');
                dia.className = 'dia-calendario' + (isHoje ? ' hoje' : '');
                dia.innerHTML = `
      <div class="dia-num">${data.getDate()}</div>
      <div class="dia-nome">${diasSemana[i]}</div>
      <div class="dia-progresso">
        <div class="dia-progresso-fill" style="width:${progresso}%"></div>
      </div>
    `;

                cal.appendChild(dia);
            }
        }

        function verificarConquistas() {
            CONQUISTAS_LISTA.forEach(c => {
                if (!conquistas[c.id] && c.requisito()) {
                    conquistas[c.id] = true;
                    mostrarToast(`üèÜ ${c.nome}!`, 'success');
                }
            });
            salvarDados();
        }

        function getTotalConcluidas() {
            return historico.reduce((sum, h) => sum + h.concluidas, 0) + tarefasRotina.filter(t => t.concluida).length;
        }

        // CATEGORIAS
        function abrirModalCategorias() {
            $('modalCategorias').classList.add('ativo');
            renderizarListaCategorias();
        }

        function renderizarListaCategorias() {
            const lista = $('listaCategorias');
            lista.innerHTML = '';

            categorias.forEach((cat, idx) => {
                const div = document.createElement('div');
                div.style.cssText = 'display:flex;gap:8px;align-items:center;padding:12px;background:var(--surface-hover);border-radius:8px;margin-bottom:8px';
                div.innerHTML = `
      <div style="width:32px;height:32px;background:${cat.cor};border-radius:6px;display:flex;align-items:center;justify-content:center;font-size:18px">${cat.emoji}</div>
      <span style="flex:1;font-weight:600">${cat.nome}</span>
      <button class="btn btn-sm btn-danger" onclick="excluirCategoria(${idx})">üóëÔ∏è</button>
    `;
                lista.appendChild(div);
            });
        }

        function adicionarCategoria() {
            const nome = $('novaCategoriaNome').value.trim();
            if (!nome) {
                mostrarToast('Digite um nome', 'error');
                return
            }

            const cor = $('novaCategoriaIcon').value;
            const emoji = prompt('Digite um emoji para a categoria:', 'üìå');
            if (!emoji) return;

            categorias.push({
                nome,
                cor,
                emoji
            });
            salvarDados();
            renderizarListaCategorias();
            atualizarSelectCategorias();
            $('novaCategoriaNome').value = '';
            mostrarToast('Categoria adicionada!', 'success');
        }

        function excluirCategoria(idx) {
            if (!confirm('Excluir categoria?')) return;
            categorias.splice(idx, 1);
            salvarDados();
            renderizarListaCategorias();
            atualizarSelectCategorias();
        }

        function atualizarSelectCategorias() {
            const select = $('categoriaRotina');
            select.innerHTML = '';
            categorias.forEach(cat => {
                const option = document.createElement('option');
                option.value = cat.nome;
                option.textContent = `${cat.emoji} ${cat.nome}`;
                select.appendChild(option);
            });

            // Atualizar tamb√©m o select de filtro
            const selectFiltro = $('filtroCategoriaRotina');
            if (selectFiltro) {
                // Manter a op√ß√£o "Todas as categorias"
                const todasOpt = selectFiltro.querySelector('option[value=""]');
                selectFiltro.innerHTML = '';
                if (todasOpt) {
                    selectFiltro.appendChild(todasOpt);
                } else {
                    const optTodas = document.createElement('option');
                    optTodas.value = '';
                    optTodas.textContent = 'Todas as categorias';
                    selectFiltro.appendChild(optTodas);
                }
                categorias.forEach(cat => {
                    const option = document.createElement('option');
                    option.value = cat.nome;
                    option.textContent = `${cat.emoji} ${cat.nome}`;
                    selectFiltro.appendChild(option);
                });
            }
        }

        // SE√á√ïES COLAPS√ÅVEIS
        function toggleSecao(nome) {
            const secao = $('secao' + nome.charAt(0).toUpperCase() + nome.slice(1));
            const icon = $('icon' + nome.charAt(0).toUpperCase() + nome.slice(1));

            if (!secao || !icon) return;

            secao.classList.toggle('expandido');
            icon.textContent = secao.classList.contains('expandido') ? '‚ñ≤' : '‚ñº';
        }

        // NOTIFICA√á√ïES
        function pedirPermissaoNotificacao() {
            if (!('Notification' in window)) {
                mostrarToast('Navegador n√£o suporta', 'error');
                return;
            }

            Notification.requestPermission().then(permission => {
                if (permission === 'granted') {
                    mostrarToast('Notifica√ß√µes ativadas!', 'success');
                } else {
                    mostrarToast('Permiss√£o negada', 'error');
                }
            });
        }

        // CONFETE
        function lancarConfete() {
            for (let i = 0; i < 50; i++) {
                setTimeout(() => {
                    const confete = document.createElement('div');
                    confete.className = 'confete';
                    confete.textContent = ['üéâ', '‚≠ê', '‚ú®', 'üåü', 'üí´'][Math.floor(Math.random() * 5)];
                    confete.style.left = Math.random() * 100 + 'vw';
                    confete.style.fontSize = Math.random() * 20 + 20 + 'px';
                    confete.style.animation = `confeteFall ${Math.random()*2+2}s linear`;
                    document.body.appendChild(confete);
                    setTimeout(() => confete.remove(), 4000);
                }, i * 50);
            }
        }

        // DARK MODE
        function toggleDarkMode() {
            darkMode = !darkMode;
            document.body.classList.toggle('dark-mode', darkMode);
            localStorage.setItem('darkMode', darkMode);
        }

        function verificarDarkMode() {
            const hora = new Date().getHours();
            const saved = localStorage.getItem('darkMode');

            if (saved !== null) {
                darkMode = saved === 'true';
            } else {
                darkMode = hora < 6 || hora >= 18;
            }

            document.body.classList.toggle('dark-mode', darkMode);
        }

        // AVALIA√á√ÉO DI√ÅRIA / AUTOFEEDBACK
        function abrirModalAvaliacaoDiaria(humor) {
            $('avaliacaoHumors').value = humor;
            document.querySelectorAll('[id^="btnHumors"]').forEach(btn => btn.classList.remove('selected'));
            $('btnHumors' + humor).classList.add('selected');
            $('avaliacaoTexto').value = '';
            $('avaliacaoObservacoes').value = '';

            // Tentar carregar avalia√ß√£o do dia atual se existir
            const avaliacaoHoje = avaliacoesDiarias.find(a => a.data === diaAtual);
            if (avaliacaoHoje) {
                $('avaliacaoHumors').value = avaliacaoHoje.humor || humor;
                $('avaliacaoTexto').value = avaliacaoHoje.texto || '';
                $('avaliacaoObservacoes').value = avaliacaoHoje.observacoes || '';
                document.querySelectorAll('[id^="btnHumors"]').forEach(btn => btn.classList.remove('selected'));
                if (avaliacaoHoje.humor) {
                    $('btnHumors' + avaliacaoHoje.humor).classList.add('selected');
                }
            }

            $('modalAvaliacaoDiaria').classList.add('ativo');
        }

        function selecionarHumorAvaliacao(humor) {
            $('avaliacaoHumors').value = humor;
            document.querySelectorAll('[id^="btnHumors"]').forEach(btn => btn.classList.remove('selected'));
            $('btnHumors' + humor).classList.add('selected');
        }

        function salvarAvaliacaoDiaria(e) {
            e.preventDefault();
            const humor = $('avaliacaoHumors').value;
            const texto = $('avaliacaoTexto').value.trim();
            const observacoes = $('avaliacaoObservacoes').value.trim();

            if (!humor) {
                mostrarToast('Selecione como voc√™ est√° se sentindo', 'error');
                return;
            }

            const idx = avaliacoesDiarias.findIndex(a => a.data === diaAtual);
            const avaliacao = {
                data: diaAtual,
                humor,
                texto,
                observacoes,
                criado: new Date().toISOString()
            };

            if (idx >= 0) {
                avaliacoesDiarias[idx] = avaliacao;
            } else {
                avaliacoesDiarias.unshift(avaliacao);
            }

            // Limitar a 365 dias
            if (avaliacoesDiarias.length > 365) {
                avaliacoesDiarias = avaliacoesDiarias.slice(0, 365);
            }

            salvarDados();
            renderizarResumoAvaliacao();
            fecharModal('modalAvaliacaoDiaria');
            mostrarToast('Avalia√ß√£o salva!', 'success');
        }

        function renderizarResumoAvaliacao() {
            const resumoAvaliacao = $('resumoAvaliacaoDia');
            const resumoCompleto = $('resumoDiarioCompleto');

            const avaliacaoHoje = avaliacoesDiarias.find(a => a.data === diaAtual);

            if (avaliacaoHoje) {
                const humorEmoji = avaliacaoHoje.humor === 'feliz' ? 'üòä' : avaliacaoHoje.humor === 'neutro' ? 'üòê' : avaliacaoHoje.humor === 'triste' ? 'üòî' : avaliacaoHoje.humor === 'cansado' ? 'üò¥' : avaliacaoHoje.humor === 'bravo' ? 'üò§' : 'üòê';
                const humorTexto = avaliacaoHoje.humor === 'feliz' ? 'Feliz' : avaliacaoHoje.humor === 'neutro' ? 'Neutro' : avaliacaoHoje.humor === 'triste' ? 'Triste' : avaliacaoHoje.humor === 'cansado' ? 'Cansado' : avaliacaoHoje.humor === 'bravo' ? 'Bravo/Frustrado' : 'Neutro';

                resumoAvaliacao.innerHTML = `
                    <div style="background:var(--surface-hover);padding:20px;border-radius:12px;margin-bottom:16px">
                        <div style="font-size:20px;margin-bottom:12px">${humorEmoji} <strong>${humorTexto}</strong></div>
                        ${avaliacaoHoje.texto ? `<div style="color:var(--text-secondary);line-height:1.6;margin-bottom:8px">${esc(avaliacaoHoje.texto)}</div>` : ''}
                        ${avaliacaoHoje.observacoes ? `<div style="color:var(--text-muted);font-size:13px;font-style:italic;padding-top:8px;border-top:1px solid var(--border)">${esc(avaliacaoHoje.observacoes)}</div>` : ''}
                        <button class="btn btn-sm btn-primary" onclick="abrirModalAvaliacaoDiaria('${avaliacaoHoje.humor}')" style="margin-top:12px">‚úèÔ∏è Editar Avalia√ß√£o</button>
                    </div>
                `;
            } else {
                resumoAvaliacao.innerHTML = `
                    <div style="text-align:center;padding:20px;color:var(--text-secondary);background:var(--surface-hover);border-radius:12px">
                        <div style="margin-bottom:12px">Nenhuma avalia√ß√£o registrada hoje</div>
                        <button class="btn btn-primary" onclick="abrirModalAvaliacaoDiaria('neutro')">‚ûï Registrar Avalia√ß√£o</button>
                    </div>
                `;
            }

            // Resumo completo do dia (tarefas com humores)
            const tarefasComHumores = tarefasRotina.filter(t => (t.concluida || t.quantidadeAtual > 0) && t.humor);
            if (tarefasComHumores.length > 0) {
                let html = '<div style="background:var(--surface-hover);padding:20px;border-radius:12px">';
                html += '<div style="font-size:16px;font-weight:600;margin-bottom:16px">üìù Humores ao realizar tarefas hoje:</div>';

                tarefasComHumores.forEach(t => {
                    const humorEmoji = t.humor === 'feliz' ? 'üòä' : t.humor === 'neutro' ? 'üòê' : t.humor === 'triste' ? 'üòî' : t.humor === 'cansado' ? 'üò¥' : t.humor === 'bravo' ? 'üò§' : '';
                    const motivoTexto = t.humorMotivo ? ` - ${esc(t.humorMotivo)}` : '';
                    html += `
                        <div style="padding:12px;background:var(--surface);border-radius:8px;margin-bottom:8px;border-left:4px solid var(--accent)">
                            <div style="display:flex;align-items:center;gap:8px;margin-bottom:4px">
                                <span style="font-size:20px">${humorEmoji}</span>
                                <strong>${esc(t.nome)}</strong>
                            </div>
                            ${t.humorMotivo ? `<div style="font-size:13px;color:var(--text-secondary);padding-left:28px">${esc(t.humorMotivo)}</div>` : ''}
                        </div>
                    `;
                });

                html += '</div>';
                resumoCompleto.innerHTML = html;
            } else {
                resumoCompleto.innerHTML = '<div style="text-align:center;padding:20px;color:var(--text-secondary);background:var(--surface-hover);border-radius:12px">Nenhuma tarefa conclu√≠da com humor registrado hoje</div>';
            }
        }

        // Verificar reset di√°rio periodicamente
        function iniciarVerificacaoDiaria() {
            // Verificar a cada minuto se mudou o dia
            setInterval(() => {
                const hoje = new Date().toDateString();
                if (diaAtual && diaAtual !== hoje) {
                    verificarResetDiario();
                    renderizarRotina();
                    mostrarToast('üéâ Novo dia! Tarefas reiniciadas!', 'success');
                }
            }, 60000); // A cada 1 minuto
        }

        // MODAIS
        function abrirModalNovaTarefa() {
            cancelarEdicaoRotina();
            $('modalNovaTarefa').classList.add('ativo');
        }

        function fecharModal(id) {
            $(id).classList.remove('ativo');
        }

        function trocarAba(aba) {
            document.querySelectorAll('.tab').forEach(t => t.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(t => t.classList.remove('active'));
            event.target.classList.add('active');
            $(aba).classList.add('active');

            if (aba === 'rotina') {
                verificarResetDiario();
                renderizarRotina();
            } else if (aba === 'minhaRotina') {
                verificarResetDiario();
                renderizarRotinaSimplificada();
            }
        }

        function abrirTerapia() {
            window.open('Terapia-Pedro/index.html', '_blank');
        }

        // DRAG & DROP
        function setupEventos() {
            $('busca').addEventListener('input', renderizarProjetos);

            // Verificar reset quando a p√°gina volta ao foco
            document.addEventListener('visibilitychange', () => {
                if (!document.hidden) {
                    verificarResetDiario();
                    if (document.querySelector('#rotina.tab-content.active')) {
                        renderizarRotina();
                    }
                }
            });

            document.addEventListener('dragstart', e => {
                if (e.target.classList.contains('task-card')) {
                    draggedTask = e.target;
                    e.target.classList.add('dragging');
                }
            });

            document.addEventListener('dragend', e => {
                if (e.target.classList.contains('task-card')) {
                    e.target.classList.remove('dragging');
                    draggedTask = null;
                }
            });

            document.addEventListener('dragover', e => {
                e.preventDefault();
                const column = e.target.closest('.column');
                if (column && draggedTask) {
                    column.classList.add('drag-over');
                }
            });

            document.addEventListener('dragleave', e => {
                const column = e.target.closest('.column');
                if (column) column.classList.remove('drag-over');
            });

            document.addEventListener('drop', e => {
                e.preventDefault();
                const column = e.target.closest('.column');
                if (column && draggedTask) {
                    column.classList.remove('drag-over');
                    const novoStatus = column.dataset.status;
                    const taskId = draggedTask.dataset.id;
                    mudarStatus(taskId, novoStatus);
                    mostrarToast('Status atualizado!', 'success');
                }
            });

            const dropZone = $('dropZone');
            ['dragenter', 'dragover'].forEach(ev => {
                dropZone.addEventListener(ev, e => {
                    e.preventDefault();
                    dropZone.classList.add('drag-active');
                });
            });
            ['dragleave', 'drop'].forEach(ev => {
                dropZone.addEventListener(ev, e => {
                    e.preventDefault();
                    dropZone.classList.remove('drag-active');
                });
            });
            dropZone.addEventListener('drop', e => {
                const file = e.dataTransfer.files[0];
                if (file) importarArquivo(file);
            });

            document.addEventListener('keydown', e => {
                if (e.ctrlKey || e.metaKey) {
                    if (e.key === 's') {
                        e.preventDefault();
                        salvarArquivo();
                    }
                }
                if (e.key === 'Escape') {
                    document.querySelectorAll('.modal').forEach(m => m.classList.remove('ativo'));
                }
            });
        }

        // FILE SYSTEM
        async function salvarArquivo() {
            try {
                const dados = {
                    projetos: {
                        tarefas,
                        contador
                    },
                    rotina: {
                        tarefas: tarefasRotina,
                        contador: contadorRotina,
                        streak,
                        conquistas
                    },
                    categorias,
                    historico,
                    avaliacoesDiarias,
                    exportado: new Date().toISOString()
                };
                const blob = new Blob([JSON.stringify(dados, null, 2)], {
                    type: 'application/json'
                });

                if ('showSaveFilePicker' in window) {
                    const handle = await window.showSaveFilePicker({
                        suggestedName: `backup-${new Date().toISOString().split('T')[0]}.json`,
                        types: [{
                            description: 'JSON',
                            accept: {
                                'application/json': ['.json']
                            }
                        }]
                    });
                    const writable = await handle.createWritable();
                    await writable.write(blob);
                    await writable.close();
                    mostrarToast('Salvo!', 'success');
                } else {
                    const url = URL.createObjectURL(blob);
                    const a = document.createElement('a');
                    a.href = url;
                    a.download = `backup-${new Date().toISOString().split('T')[0]}.json`;
                    a.click();
                    URL.revokeObjectURL(url);
                    mostrarToast('Download iniciado!', 'success');
                }
            } catch (e) {
                if (e.name !== 'AbortError') {
                    mostrarToast('Erro ao salvar', 'error');
                }
            }
        }

        function importarArquivo(file) {
            if (!file) return;
            const reader = new FileReader();

            reader.onload = e => {
                try {
                    const dados = JSON.parse(e.target.result);

                    if (dados.projetos) {
                        tarefas = dados.projetos.tarefas || [];
                        contador = dados.projetos.contador || 0;
                    }

                    if (dados.rotina) {
                        tarefasRotina = dados.rotina.tarefas || [];
                        contadorRotina = dados.rotina.contador || 0;
                        streak = dados.rotina.streak || 0;
                        conquistas = dados.rotina.conquistas || {};
                    }

                    if (dados.categorias) {
                        categorias = dados.categorias;
                    }

                    if (dados.historico) {
                        historico = dados.historico;
                    }

                    if (dados.avaliacoesDiarias) {
                        avaliacoesDiarias = dados.avaliacoesDiarias;
                    }

                    salvarDados();
                    renderizarProjetos();
                    renderizarRotina();
                    mostrarToast('Importado!', 'success');
                } catch (e) {
                    mostrarToast('Erro ao importar', 'error');
                }
            };

            reader.readAsText(file);
        }

        // UTILS
        function $(id) {
            return document.getElementById(id)
        }

        function esc(s) {
            return String(s).replace(/[&<>"']/g, c => ({
                '&': '&amp;',
                '<': '&lt;',
                '>': '&gt;',
                '"': '&quot;',
                "'": '&#39;'
            } [c]))
        }

        function formatarData(d) {
            if (!d) return '';
            const [a, m, dia] = d.split('-');
            return `${dia}/${m}/${a}`
        }

        function mostrarToast(msg, tipo = 'success') {
            const toast = document.createElement('div');
            toast.className = `toast ${tipo}`;
            toast.textContent = msg;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }

        init();
    </script>
</body>

</html>