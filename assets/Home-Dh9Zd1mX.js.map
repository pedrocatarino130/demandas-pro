{"version":3,"file":"Home-Dh9Zd1mX.js","sources":["../../src/views/Home.js"],"sourcesContent":["/**\n * Home View - Cyberpunk Redesign\n * Estrutura inspirada no prot√≥tipo React em `re-desing/`\n */\n\nimport { store } from '../store.js';\nimport { TaskCard } from '../components/TaskCard.js';\nimport { ComplexSearch } from '../components/ComplexSearch.js';\nimport { createNeonButton } from '../components/NeonButton.js';\nimport { taskEditModal } from '../components/TaskEditModal.js';\nimport { confirmAction } from '../components/ConfirmModal.js';\nimport { getCompletedTasks } from '../utils/taskFilters.js';\n\nclass HomeView {\n  constructor() {\n    this.activeTab = 'urgent';\n    this.searchQuery = '';\n    this.unsubscribe = null;\n  }\n\n  render() {\n    return `\n      <div class=\"home-view home-view-redesign\" id=\"home-view-redesign\">\n        <div class=\"home-top-cards\">\n          <section class=\"home-welcome-card\">\n            <h2 class=\"home-welcome-title\">Bem vindo de volta, Pedro!</h2>\n            <p class=\"home-welcome-message\">\n              Voc√™ tem <strong id=\"home-urgent-count\">0 tarefas urgentes</strong> hoje. Mantenha o foco!\n            </p>\n            <div id=\"home-cta\"></div>\n          </section>\n\n          <section class=\"home-productivity-card\">\n            <div class=\"home-productivity-value\" id=\"home-productivity-value\">0%</div>\n            <div class=\"home-productivity-label\">Produtividade</div>\n            <div class=\"home-productivity-bar\">\n              <div class=\"home-productivity-bar-fill\" id=\"home-productivity-bar-fill\" style=\"width: 0%\"></div>\n            </div>\n          </section>\n        </div>\n\n        <div class=\"home-section-header\">\n          <div class=\"home-dashboard-tabs\" id=\"home-dashboard-tabs\"></div>\n          <div class=\"home-search\" id=\"home-search\"></div>\n        </div>\n\n        <div class=\"home-tasks-grid\" id=\"home-tasks-grid\"></div>\n      </div>\n    `;\n  }\n\n  mount() {\n    this.renderSearch();\n    this.renderCTA();\n    this.renderData();\n\n    this.unsubscribe = store.subscribe(() => this.renderData());\n    return this;\n  }\n\n  destroy() {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n      this.unsubscribe = null;\n    }\n  }\n\n  renderSearch() {\n    const searchContainer = document.getElementById('home-search');\n    if (!searchContainer) return;\n    searchContainer.innerHTML = '';\n\n    const search = new ComplexSearch({\n      value: this.searchQuery,\n      onChange: (val) => {\n        this.searchQuery = val;\n        this.renderData();\n      },\n    });\n\n    searchContainer.appendChild(search.render());\n  }\n\n  renderCTA() {\n    const cta = document.getElementById('home-cta');\n    if (!cta) return;\n    cta.innerHTML = '';\n\n    const button = createNeonButton({\n      text: 'Nova Tarefa',\n      variant: 'primary',\n      onClick: () => this.createTask(),\n      className: 'home-cta-button',\n    });\n\n    cta.appendChild(button);\n  }\n\n  renderData() {\n    const state = store.getState();\n    const tasks = Array.isArray(state.tarefasHome) ? [...state.tarefasHome] : [];\n    const filtered = this.applySearch(tasks);\n    const categories = this.buildCategories(filtered);\n\n    this.renderTabs(categories);\n    this.updateTopCards(categories, filtered);\n    this.renderGrid(this.getActiveTasks(categories));\n  }\n\n  renderTabs(categories) {\n    const tabsContainer = document.getElementById('home-dashboard-tabs');\n    if (!tabsContainer) return;\n\n    const tabs = [\n      { id: 'urgent', label: 'Urgentes', className: 'urgent', count: categories.urgent.length },\n      { id: 'future', label: 'Futuras', className: 'future', count: categories.future.length },\n      { id: 'completed', label: 'Conclu√≠das', className: 'completed', count: categories.completed.length },\n    ];\n\n    tabsContainer.innerHTML = tabs\n      .map(\n        (tab) => `\n          <button \n            class=\"home-dashboard-tab ${tab.className} ${this.activeTab === tab.id ? 'active' : ''}\" \n            data-tab=\"${tab.id}\"\n            aria-pressed=\"${this.activeTab === tab.id}\"\n          >\n            <span class=\"home-dashboard-tab-icon\">‚óè</span>\n            ${tab.label} (${tab.count})\n          </button>\n        `\n      )\n      .join('');\n\n    tabsContainer.querySelectorAll('[data-tab]').forEach((btn) => {\n      btn.addEventListener('click', () => {\n        const tab = btn.getAttribute('data-tab');\n        if (tab) {\n          this.activeTab = tab;\n          this.renderTabs(categories);\n          this.renderGrid(this.getActiveTasks(categories));\n        }\n      });\n    });\n  }\n\n  renderGrid(tasks) {\n    const grid = document.getElementById('home-tasks-grid');\n    if (!grid) return;\n    grid.innerHTML = '';\n\n    if (!tasks || tasks.length === 0) {\n      const empty = document.createElement('div');\n      empty.className = 'home-empty-state';\n      empty.innerHTML = `\n        <div class=\"home-empty-state-icon\">üìÇ</div>\n        <p class=\"home-empty-state-message\">Nenhuma tarefa nesta categoria.</p>\n      `;\n      grid.appendChild(empty);\n      return;\n    }\n\n    tasks.forEach((task) => {\n      const card = new TaskCard(task, {\n        showCheckbox: true,\n        showPriority: true,\n        showActions: true,\n        onToggleStatus: (id, checked) => this.handleToggleStatus(id, checked),\n        onEdit: (t) => this.handleEdit(t),\n        onDelete: (id) => this.handleDelete(id),\n      });\n      grid.appendChild(card.render());\n    });\n  }\n\n  updateTopCards(categories, tasks) {\n    const urgentCountEl = document.getElementById('home-urgent-count');\n    if (urgentCountEl) {\n      urgentCountEl.textContent = `${categories.urgent.length} tarefas urgentes`;\n    }\n\n    const total = tasks.length;\n    const done = categories.completed.length;\n    const percentage = total > 0 ? Math.round((done / total) * 100) : 0;\n\n    const valueEl = document.getElementById('home-productivity-value');\n    if (valueEl) {\n      valueEl.textContent = `${percentage}%`;\n    }\n\n    const bar = document.getElementById('home-productivity-bar-fill');\n    if (bar) {\n      bar.style.width = `${percentage}%`;\n    }\n  }\n\n  applySearch(tasks) {\n    if (!this.searchQuery) return tasks;\n    const query = this.searchQuery.toLowerCase();\n\n    return tasks.filter((task) => {\n      const title = (task.titulo || task.nome || '').toLowerCase();\n      const description = (task.descricao || '').toLowerCase();\n      const responsavel = (task.responsavel || '').toLowerCase();\n      const tags = Array.isArray(task.tags) ? task.tags.join(' ').toLowerCase() : '';\n      return (\n        title.includes(query) ||\n        description.includes(query) ||\n        responsavel.includes(query) ||\n        tags.includes(query)\n      );\n    });\n  }\n\n  buildCategories(tasks) {\n    const delayedIds = new Set();\n    const urgent = tasks.filter(\n      (task) => !task.completed && this.isHighPriority(task) && !delayedIds.has(this.getTaskId(task))\n    );\n    const urgentIds = new Set(urgent.map((t) => this.getTaskId(t)));\n\n    const completed = getCompletedTasks(tasks);\n    const future = tasks.filter(\n      (task) => !task.completed && !delayedIds.has(this.getTaskId(task)) && !urgentIds.has(this.getTaskId(task))\n    );\n\n    return {\n      urgent,\n      future,\n      completed,\n    };\n  }\n\n  getActiveTasks(categories) {\n    switch (this.activeTab) {\n      case 'future':\n        return categories.future;\n      case 'completed':\n        return categories.completed;\n      case 'urgent':\n      default:\n        return categories.urgent;\n    }\n  }\n\n  async handleDelete(taskId) {\n    const confirmed = await confirmAction('Deseja excluir esta tarefa?');\n    if (!confirmed) return;\n    store.removeItem('tarefasHome', (t) => this.compareIds(this.getTaskId(t), taskId));\n  }\n\n  handleEdit(task) {\n    if (!task) return;\n    taskEditModal.open(task, (currentTask, updates) => this.saveTask(currentTask, updates));\n  }\n\n  handleToggleStatus(taskId, checked) {\n    store.updateItem('tarefasHome', (t) => this.compareIds(this.getTaskId(t), taskId), {\n      completed: checked,\n      completedAt: checked ? new Date().toISOString() : null,\n    });\n  }\n\n  createTask() {\n    const state = store.getState();\n    const newId = (state.contadorHome || 0) + 1;\n    const defaultDate = new Date();\n    defaultDate.setHours(defaultDate.getHours() + 1);\n\n    const task = {\n      id: newId,\n      contador: newId,\n      titulo: 'Nova Tarefa',\n      descricao: '',\n      prioridade: 'media',\n      responsavel: '',\n      tags: [],\n      status: 'todo',\n      completed: false,\n      time: defaultDate.toISOString(),\n    };\n\n    taskEditModal.open(task, (currentTask, updates) => this.saveTask(currentTask, updates));\n  }\n\n  saveTask(task, updates) {\n    const taskId = this.getTaskId(task);\n    const updated = { ...task, ...updates };\n    const exists = this.taskExists(taskId);\n\n    if (exists) {\n      store.updateItem('tarefasHome', (t) => this.compareIds(this.getTaskId(t), taskId), updated);\n    } else {\n      store.addItem('tarefasHome', updated);\n      const currentCounter = store.getState().contadorHome || 0;\n      const numericId = Number(taskId);\n      const nextCounter = Number.isFinite(numericId) ? Math.max(currentCounter, numericId) : currentCounter + 1;\n      store.setState({ contadorHome: nextCounter });\n    }\n  }\n\n  taskExists(taskId) {\n    const state = store.getState();\n    const tasks = Array.isArray(state.tarefasHome) ? state.tarefasHome : [];\n    return tasks.some((t) => this.compareIds(this.getTaskId(t), taskId));\n  }\n\n  isHighPriority(task) {\n    const priority = (task.prioridade || '').toString().toLowerCase();\n    return priority === 'alta' || priority === 'urgente' || priority === 'high' || priority === 'urgent';\n  }\n\n  getTaskId(task) {\n    if (!task) return null;\n    return task.id || task.contador || null;\n  }\n\n  compareIds(id1, id2) {\n    if (id1 == null || id2 == null) return false;\n    return String(id1) === String(id2);\n  }\n}\n\nexport default function renderHome() {\n  const view = new HomeView();\n  return {\n    render: () => view.render(),\n    mount: () => view.mount(),\n  };\n}\n"],"names":["HomeView","store","searchContainer","search","ComplexSearch","val","cta","button","createNeonButton","state","tasks","filtered","categories","tabsContainer","tabs","tab","btn","grid","empty","task","card","TaskCard","id","checked","t","urgentCountEl","total","done","percentage","valueEl","bar","query","title","description","responsavel","tags","delayedIds","urgent","urgentIds","completed","getCompletedTasks","future","taskId","confirmAction","taskEditModal","currentTask","updates","newId","defaultDate","updated","currentCounter","numericId","nextCounter","priority","id1","id2","renderHome","view"],"mappings":"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"}