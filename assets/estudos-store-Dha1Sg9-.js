import{f as o}from"./index-7ypPvpma.js";import"./idb-Dob3nYDb.js";class r{constructor(){this.state={areas:[],topicos:[],contadorAreas:0,contadorTopicos:0,versao:3},this.subscribers=[],this.revisaoEspacada=null,this.userId="default",this.initialized=!1,this.listeners=[],this.saveDebounce=null,this.DEBOUNCE_DELAY=300,this.init()}async init(){await o.init();const t=await o.get("estudos-store-state");t&&(this.state={...this.state,...t},this._notify()),await this._migrateFromV2(),this.initialized=!0,console.log("âœ… EstudosStore inicializado (modo local)")}async _loadFromFirestore(){}_saveToFirestore(){this.saveDebounce&&clearTimeout(this.saveDebounce),this.saveDebounce=setTimeout(async()=>{try{await o.set("estudos-store-state",this.state)}catch(t){console.error("Erro ao salvar estudos no Firestore:",t)}},this.DEBOUNCE_DELAY)}_setupListeners(){}async _migrateFromV2(){try{if(await o.get("estudos-firestore-migrated"))return;const e=localStorage.getItem("estudos_v2");if(e&&this.state.areas.length===0&&this.state.topicos.length===0){const a=JSON.parse(e);a.areas&&Array.isArray(a.areas)&&(this.state.areas=a.areas.map(i=>({id:i.id||`area_${Date.now()}_${Math.random()}`,nome:i.nome,descricao:i.descricao||"",cor:i.cor||"#3b82f6",icone:i.icone||"ðŸ“š",status:i.status||"ativo",criadoEm:i.criadoEm||new Date().toISOString()}))),a.topicos&&Array.isArray(a.topicos)&&(this.state.topicos=a.topicos.map(i=>({id:i.id||`topico_${Date.now()}_${Math.random()}`,titulo:i.titulo,descricao:i.descricao||"",areaId:i.areaId,status:i.status||"NÃ£o iniciado",prioridade:i.prioridade||"MÃ©dia",tags:i.tags||[],tempoEstimado:i.tempoEstimado||null,sessoes:i.sessoes||[],proximaRevisao:i.proximaRevisao||null,ultimaRevisao:i.ultimaRevisao||null,historicoRevisoes:i.historicoRevisoes||[],concluidoEm:i.concluidoEm||null,criadoEm:i.criadoEm||new Date().toISOString()}))),this.state.contadorAreas=this.state.areas.length,this.state.contadorTopicos=this.state.topicos.length,await this._saveToFirestore(),this.saveDebounce&&clearTimeout(this.saveDebounce),await o.set("estudos-store-state",this.state),await o.set("estudos-firestore-migrated",!0),this._notify(),console.log("âœ… MigraÃ§Ã£o de dados v2 concluÃ­da")}}catch(t){console.warn("Erro na migraÃ§Ã£o v2",t)}}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter(s=>s!==t)}}_notify(){this.subscribers.forEach(t=>{try{t(this.state)}catch(s){console.error("Erro ao notificar subscriber",s)}})}getAreas(){return[...this.state.areas]}getAreaById(t){return this.state.areas.find(s=>s.id===t)}addArea(t){const s={id:`area_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,nome:t.nome,descricao:t.descricao||"",cor:t.cor||"#3b82f6",icone:t.icone||"ðŸ“š",status:"ativo",criadoEm:new Date().toISOString()};return this.state.areas.push(s),this.state.contadorAreas++,this._saveToFirestore(),this._notify(),s}updateArea(t,s){const e=this.state.areas.findIndex(a=>a.id===t);return e>=0?(this.state.areas[e]={...this.state.areas[e],...s},this._saveToFirestore(),this._notify(),this.state.areas[e]):null}removeArea(t){const s=this.state.areas.findIndex(e=>e.id===t);return s>=0?(this.state.areas.splice(s,1),this.state.contadorAreas--,this.state.topicos.forEach(e=>{e.areaId===t&&(e.areaId=null)}),this._saveToFirestore(),this._notify(),!0):!1}getTopicos(){return[...this.state.topicos]}getTopicoById(t){return this.state.topicos.find(s=>s.id===t)}getTopicosByArea(t){return this.state.topicos.filter(s=>s.areaId===t)}addTopico(t){const s={id:`topico_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,titulo:t.titulo,descricao:t.descricao||"",areaId:t.areaId||null,status:t.status||"NÃ£o iniciado",prioridade:t.prioridade||"MÃ©dia",tags:t.tags||[],tempoEstimado:t.tempoEstimado||null,sessoes:[],proximaRevisao:null,ultimaRevisao:null,historicoRevisoes:[],concluidoEm:null,criadoEm:new Date().toISOString()};return this.state.topicos.push(s),this.state.contadorTopicos++,this._saveToFirestore(),this._notify(),s}updateTopico(t,s){const e=this.state.topicos.findIndex(a=>a.id===t);if(e>=0){const a=this.state.topicos[e],i={...a,...s};return s.status==="ConcluÃ­do"&&a.status!=="ConcluÃ­do"&&this.revisaoEspacada&&this.revisaoEspacada.agendarRevisaoInicial(i),this.state.topicos[e]=i,this._saveToFirestore(),this._notify(),i}return null}removeTopico(t){const s=this.state.topicos.findIndex(e=>e.id===t);return s>=0?(this.state.topicos.splice(s,1),this.state.contadorTopicos--,this._saveToFirestore(),this._notify(),!0):!1}addSessao(t,s){const e=this.getTopicoById(t);if(!e)return null;const a={id:`sessao_${Date.now()}_${Math.random().toString(36).substr(2,9)}`,data:s.data||new Date().toISOString(),duracao:s.duracao||0,notas:s.notas||"",tags:s.tags||[],dificuldade:s.dificuldade||3,recursos:s.recursos||[]};return e.sessoes||(e.sessoes=[]),e.sessoes.push(a),s.concluiu?(e.status="ConcluÃ­do",e.concluidoEm=a.data,this.revisaoEspacada&&this.revisaoEspacada.agendarRevisaoInicial(e)):e.status==="NÃ£o iniciado"&&(e.status="Estudando"),this._saveToFirestore(),this._notify(),a}getAllTags(){const t=new Set;return this.state.topicos.forEach(s=>{s.tags&&Array.isArray(s.tags)&&s.tags.forEach(e=>t.add(e))}),Array.from(t)}setRevisaoEspacada(t){this.revisaoEspacada=t}getState(){return{...this.state}}destroy(){this.listeners.forEach(t=>t()),this.listeners=[]}}typeof module<"u"&&module.exports&&(module.exports=r);export{r as EstudosStore,r as default};
//# sourceMappingURL=estudos-store-Dha1Sg9-.js.map
