{"version":3,"file":"Projetos-BYYhdWss.js","sources":["../../src/views/Projetos.js"],"sourcesContent":["/**\n * View Projetos - Cyberpunk Kanban\n * Redesenho inspirado no protÃ³tipo React (re-desing/)\n */\n\nimport { store } from '../store.js';\nimport { TaskCard } from '../components/TaskCard.js';\nimport { ComplexSearch } from '../components/ComplexSearch.js';\nimport { createNeonButton } from '../components/NeonButton.js';\nimport { taskEditModal } from '../components/TaskEditModal.js';\nimport { confirmAction } from '../components/ConfirmModal.js';\n\nclass ProjetosView {\n  constructor() {\n    this.unsubscribe = null;\n    this.searchQuery = '';\n  }\n\n  render() {\n    return `\n      <div class=\"home-view home-view-redesign projetos-view-redesign\" id=\"projetos-view\">\n        <div class=\"home-section-header\">\n          <h1 class=\"home-section-title\">Projetos</h1>\n          <div class=\"home-search\" id=\"projetos-search\"></div>\n        </div>\n\n        <div class=\"home-top-cards\">\n          <section class=\"home-welcome-card\">\n            <h2 class=\"home-welcome-title\">Board de Projetos</h2>\n            <p class=\"home-welcome-message\">\n              Organize seu fluxo em colunas e mantenha o ritmo.\n            </p>\n            <div id=\"projetos-cta\"></div>\n          </section>\n\n          <section class=\"home-productivity-card\">\n            <div class=\"home-productivity-value\" id=\"projetos-progress-value\">0%</div>\n            <div class=\"home-productivity-label\">Progresso</div>\n            <div class=\"home-productivity-bar\">\n              <div class=\"home-productivity-bar-fill\" id=\"projetos-progress-bar\" style=\"width: 0%\"></div>\n            </div>\n          </section>\n        </div>\n\n        <div class=\"kanban-cyberpunk\" id=\"projetos-kanban\"></div>\n      </div>\n    `;\n  }\n\n  mount() {\n    this.renderSearch();\n    this.renderCTA();\n    this.renderKanban();\n\n    this.unsubscribe = store.subscribe(() => this.renderKanban());\n    return this;\n  }\n\n  destroy() {\n    if (this.unsubscribe) {\n      this.unsubscribe();\n      this.unsubscribe = null;\n    }\n  }\n\n  renderSearch() {\n    const container = document.getElementById('projetos-search');\n    if (!container) return;\n    container.innerHTML = '';\n\n    const search = new ComplexSearch({\n      value: this.searchQuery,\n      onChange: (val) => {\n        this.searchQuery = val;\n        this.renderKanban();\n      },\n    });\n\n    container.appendChild(search.render());\n  }\n\n  renderCTA() {\n    const cta = document.getElementById('projetos-cta');\n    if (!cta) return;\n    cta.innerHTML = '';\n\n    const button = createNeonButton({\n      text: 'Nova Tarefa',\n      variant: 'primary',\n      onClick: () => this.createTask(),\n    });\n\n    cta.appendChild(button);\n  }\n\n  renderKanban() {\n    const container = document.getElementById('projetos-kanban');\n    if (!container) return;\n\n    const state = store.getState();\n    const tasks = this.filterTasks(state.tarefas || []);\n    const columns = this.groupByStatus(tasks);\n\n    this.updateProgress(tasks);\n\n    container.innerHTML = `\n      <div class=\"kanban-cyberpunk-grid\">\n        ${columns\n          .map(\n            (col) => `\n              <div class=\"kanban-cyberpunk-column\">\n                <div class=\"kanban-cyberpunk-column-header\">\n                  <div class=\"kanban-cyberpunk-column-title\">\n                    <span class=\"kanban-cyberpunk-dot\" style=\"background:${col.color}\"></span>\n                    <h3>${col.title}</h3>\n                  </div>\n                  <span class=\"kanban-cyberpunk-count\">${col.tasks.length}</span>\n                </div>\n                <div class=\"kanban-cyberpunk-column-body\" id=\"col-${col.id}\"></div>\n              </div>\n            `\n          )\n          .join('')}\n      </div>\n    `;\n\n    // Render cards per column\n    columns.forEach((col) => {\n      const body = container.querySelector(`#col-${col.id}`);\n      if (!body) return;\n\n      if (col.tasks.length === 0) {\n        const empty = document.createElement('div');\n        empty.className = 'home-empty-state';\n        empty.innerHTML = `\n          <div class=\"home-empty-state-icon\">ðŸ“‚</div>\n          <p class=\"home-empty-state-message\">Nenhuma tarefa aqui.</p>\n        `;\n        body.appendChild(empty);\n        return;\n      }\n\n      col.tasks.forEach((task) => {\n        const card = new TaskCard(task, {\n          showCheckbox: true,\n          showPriority: true,\n          showActions: true,\n          onToggleStatus: (id, checked) => this.handleToggleStatus(id, checked),\n          onEdit: (t) => this.handleEdit(t),\n          onDelete: (id) => this.handleDelete(id),\n          isCompleted: this.isDone(task),\n        });\n        body.appendChild(card.render());\n      });\n    });\n  }\n\n  filterTasks(tasks) {\n    const filtered = tasks.filter((t) => !t.arquivado);\n    if (!this.searchQuery) return filtered;\n    const q = this.searchQuery.toLowerCase();\n    return filtered.filter((task) => {\n      const title = (task.titulo || task.nome || '').toLowerCase();\n      const desc = (task.descricao || '').toLowerCase();\n      const resp = (task.responsavel || '').toLowerCase();\n      const tags = Array.isArray(task.tags) ? task.tags.join(' ').toLowerCase() : '';\n      return title.includes(q) || desc.includes(q) || resp.includes(q) || tags.includes(q);\n    });\n  }\n\n  groupByStatus(tasks) {\n    const columns = [\n      { id: 'todo', title: 'A Fazer', color: '#03a9f4' },\n      { id: 'doing', title: 'Fazendo', color: '#cf30aa' },\n      { id: 'done', title: 'Feito', color: '#00ff88' },\n    ];\n\n    const map = new Map(columns.map((c) => [c.id, []]));\n\n    tasks.forEach((task) => {\n      const status = (task.status || 'todo').toLowerCase();\n      if (map.has(status)) {\n        map.get(status).push(task);\n      } else {\n        map.get('todo').push(task);\n      }\n    });\n\n    return columns.map((col) => ({\n      ...col,\n      tasks: map.get(col.id) || [],\n    }));\n  }\n\n  updateProgress(tasks) {\n    const total = tasks.length;\n    const done = tasks.filter((t) => this.isDone(t)).length;\n    const pct = total > 0 ? Math.round((done / total) * 100) : 0;\n\n    const valueEl = document.getElementById('projetos-progress-value');\n    const barEl = document.getElementById('projetos-progress-bar');\n\n    if (valueEl) valueEl.textContent = `${pct}%`;\n    if (barEl) barEl.style.width = `${pct}%`;\n  }\n\n  isDone(task) {\n    const status = (task.status || '').toLowerCase();\n    return status === 'done' || task.completed === true;\n  }\n\n  async handleDelete(taskId) {\n    const confirmed = await confirmAction('Deseja excluir esta tarefa?');\n    if (!confirmed) return;\n    store.removeItem('tarefas', (t) => this.compareIds(this.getTaskId(t), taskId));\n  }\n\n  handleEdit(task) {\n    if (!task) return;\n    taskEditModal.open(task, (currentTask, updates) => this.saveTask(currentTask, updates));\n  }\n\n  handleToggleStatus(taskId, checked) {\n    store.updateItem('tarefas', (t) => this.compareIds(this.getTaskId(t), taskId), {\n      completed: checked,\n      status: checked ? 'done' : 'todo',\n      completedAt: checked ? new Date().toISOString() : null,\n    });\n  }\n\n  createTask() {\n    const state = store.getState();\n    const newId = (state.contador || 0) + 1;\n    const defaultDate = new Date();\n    defaultDate.setHours(defaultDate.getHours() + 1);\n\n    const task = {\n      id: newId,\n      contador: newId,\n      titulo: 'Nova Tarefa',\n      descricao: '',\n      prioridade: 'media',\n      responsavel: '',\n      tags: [],\n      status: 'todo',\n      completed: false,\n      time: defaultDate.toISOString(),\n    };\n\n    taskEditModal.open(task, (currentTask, updates) => this.saveTask(currentTask, updates));\n  }\n\n  saveTask(task, updates) {\n    const taskId = this.getTaskId(task);\n    const updated = { ...task, ...updates };\n    const exists = this.taskExists(taskId);\n\n    if (exists) {\n      store.updateItem('tarefas', (t) => this.compareIds(this.getTaskId(t), taskId), updated);\n    } else {\n      store.addItem('tarefas', updated);\n      const currentCounter = store.getState().contador || 0;\n      const numericId = Number(taskId);\n      const nextCounter = Number.isFinite(numericId) ? Math.max(currentCounter, numericId) : currentCounter + 1;\n      store.setState({ contador: nextCounter });\n    }\n  }\n\n  taskExists(taskId) {\n    const state = store.getState();\n    const tasks = Array.isArray(state.tarefas) ? state.tarefas : [];\n    return tasks.some((t) => this.compareIds(this.getTaskId(t), taskId));\n  }\n\n  getTaskId(task) {\n    if (!task) return null;\n    return task.id || task.contador || null;\n  }\n\n  compareIds(id1, id2) {\n    if (id1 == null || id2 == null) return false;\n    return String(id1) === String(id2);\n  }\n}\n\nexport default function renderProjetos() {\n  const view = new ProjetosView();\n  return {\n    render: () => view.render(),\n    mount: () => view.mount(),\n    destroy: () => view.destroy(),\n  };\n}\n"],"names":["ProjetosView","store","container","search","ComplexSearch","val","cta","button","createNeonButton","state","tasks","columns","col","body","empty","task","card","TaskCard","id","checked","t","filtered","q","title","desc","resp","tags","map","c","status","total","done","pct","valueEl","barEl","taskId","confirmAction","taskEditModal","currentTask","updates","newId","defaultDate","updated","currentCounter","numericId","nextCounter","id1","id2","renderProjetos","view"],"mappings":"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"}