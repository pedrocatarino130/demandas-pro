import{f as a}from"./firebase-cache-CPME0ep_.js";import"./idb-Dob3nYDb.js";class u{constructor(t={}){this.container=t.container||document.body,this.onSubmit=t.onSubmit||(()=>{}),this.parser=t.parser||new QuickAddParser,this.areas=t.areas||[],this.tags=t.tags||[],this.history=[],this.currentSuggestionIndex=-1,this.suggestions=[],this._createInput(),this._attachEvents(),this._loadHistory().then(s=>{this.history=s}).catch(s=>{console.warn("Erro ao carregar hist√≥rico:",s)})}_createInput(){this.wrapper=document.createElement("div"),this.wrapper.className="quick-add-wrapper",this.wrapper.innerHTML=`
            <div class="quick-add-container">
                <input 
                    type="text" 
                    class="quick-add-input" 
                    id="quickAddInput"
                    placeholder="Digite para criar... Ex: Python @udemy #urgente :2h !alta"
                    autocomplete="off"
                />
                <div class="quick-add-suggestions" id="quickAddSuggestions"></div>
                <div class="quick-add-preview" id="quickAddPreview"></div>
            </div>
        `,this.container.appendChild(this.wrapper),this.input=this.wrapper.querySelector("#quickAddInput"),this.suggestionsEl=this.wrapper.querySelector("#quickAddSuggestions"),this.previewEl=this.wrapper.querySelector("#quickAddPreview")}_attachEvents(){this.input.addEventListener("input",t=>this._handleInput(t)),this.input.addEventListener("keydown",t=>this._handleKeyDown(t)),this.input.addEventListener("focus",()=>this._handleFocus()),this.input.addEventListener("blur",()=>{setTimeout(()=>this._hideSuggestions(),200)}),this.shortcutHandler=t=>{(t.ctrlKey||t.metaKey)&&t.key==="n"&&(t.preventDefault(),this.focus())},document.addEventListener("keydown",this.shortcutHandler),this.clickHandler=t=>{this.wrapper.contains(t.target)||this._hideSuggestions()},document.addEventListener("click",this.clickHandler)}_handleInput(t){const s=t.target.value;if(!s){this._hideSuggestions(),this._hidePreview();return}const i=this.parser.parse(s);this._showPreview(i),this._updateSuggestions(s)}_handleKeyDown(t){if(t.key==="Enter"&&!t.shiftKey){t.preventDefault(),this._submit();return}if(t.key==="Escape"){this.clear(),this._hideSuggestions();return}if(t.key==="ArrowDown"){t.preventDefault(),this._navigateSuggestions(1);return}if(t.key==="ArrowUp"){t.preventDefault(),this._navigateSuggestions(-1);return}if(t.key==="Tab"&&this.currentSuggestionIndex>=0){t.preventDefault(),this._selectSuggestion(this.currentSuggestionIndex);return}}_handleFocus(){const t=this.input.value;t&&this._updateSuggestions(t)}_updateSuggestions(t){const s=this.input.selectionStart,i=t.substring(0,s);if(i.endsWith("@")){this.suggestions=this._getAreaSuggestions(""),this._showSuggestions();return}const n=i.match(/@(\w*)$/);if(n){const r=n[1].toLowerCase();this.suggestions=this._getAreaSuggestions(r),this._showSuggestions();return}if(i.endsWith("#")){this.suggestions=this._getTagSuggestions(""),this._showSuggestions();return}const e=i.match(/#(\w*)$/);if(e){const r=e[1].toLowerCase();this.suggestions=this._getTagSuggestions(r),this._showSuggestions();return}if(t.length>0&&(this.suggestions=this._getHistorySuggestions(t),this.suggestions.length>0)){this._showSuggestions();return}this._hideSuggestions()}_getAreaSuggestions(t){const s=this.areas.filter(i=>i.nome.toLowerCase().startsWith(t)&&i.status==="ativo").slice(0,5).map(i=>({type:"area",value:`@${i.nome}`,display:`üìö ${i.nome}`,data:i}));return t&&!this.areas.some(i=>i.nome.toLowerCase()===t)&&s.push({type:"new-area",value:`@${t}`,display:`‚ûï Criar √°rea "${t}"`,data:{nome:t}}),s}_getTagSuggestions(t){const s=[...new Set(this.tags)].filter(e=>e.toLowerCase().startsWith(t)).slice(0,5).map(e=>({type:"tag",value:`#${e}`,display:`üè∑Ô∏è ${e}`,data:e})),n=["urgente","importante","revis√£o","pr√°tica","teoria"].filter(e=>e.toLowerCase().startsWith(t)&&!this.tags.some(r=>r.toLowerCase()===e.toLowerCase())).slice(0,3).map(e=>({type:"tag",value:`#${e}`,display:`üè∑Ô∏è ${e}`,data:e}));return[...s,...n]}_getHistorySuggestions(t){return this.history.filter(s=>s.toLowerCase().includes(t.toLowerCase())).slice(0,3).map(s=>({type:"history",value:s,display:`üïê ${s}`,data:s}))}_showSuggestions(){if(this.suggestions.length===0){this._hideSuggestions();return}this.suggestionsEl.innerHTML=this.suggestions.map((t,s)=>`
                <div 
                    class="quick-add-suggestion ${s===this.currentSuggestionIndex?"active":""}"
                    data-index="${s}"
                >
                    ${t.display}
                </div>
            `).join(""),this.suggestionsEl.querySelectorAll(".quick-add-suggestion").forEach((t,s)=>{t.addEventListener("click",()=>this._selectSuggestion(s))}),this.suggestionsEl.style.display="block",this.currentSuggestionIndex=-1}_hideSuggestions(){this.suggestionsEl.style.display="none",this.currentSuggestionIndex=-1}_navigateSuggestions(t){if(this.suggestions.length===0)return;this.currentSuggestionIndex+=t,this.currentSuggestionIndex<0?this.currentSuggestionIndex=this.suggestions.length-1:this.currentSuggestionIndex>=this.suggestions.length&&(this.currentSuggestionIndex=0);const s=this.suggestionsEl.querySelectorAll(".quick-add-suggestion");s.forEach((n,e)=>{n.classList.toggle("active",e===this.currentSuggestionIndex)});const i=s[this.currentSuggestionIndex];i&&i.scrollIntoView({block:"nearest"})}_selectSuggestion(t){if(t<0||t>=this.suggestions.length)return;const s=this.suggestions[t],i=this.input.value,n=this.input.selectionStart,e=i.substring(0,n);let r=n;if(e.endsWith("@")||e.match(/@\w*$/)){const o=e.match(/@\w*$/);o&&(r=n-o[0].length)}else if(e.endsWith("#")||e.match(/#\w*$/)){const o=e.match(/#\w*$/);o&&(r=n-o[0].length)}const h=i.substring(0,r)+s.value+" "+i.substring(n);this.input.value=h,this.input.focus(),this.input.setSelectionRange(r+s.value.length+1,r+s.value.length+1),this._hideSuggestions(),this._handleInput({target:this.input})}_showPreview(t){if(!t.isValid){this._hidePreview();return}const s=this.parser.generatePreview(t);this.previewEl.innerHTML=s,this.previewEl.style.display="block"}_hidePreview(){this.previewEl.style.display="none"}_submit(){const t=this.input.value.trim();if(!t)return;const s=this.parser.parse(t);if(!s.isValid){this._showError("T√≠tulo inv√°lido");return}this._saveToHistory(t),this.clear(),this.onSubmit(s)}async _saveToHistory(t){this.history=this.history.filter(s=>s!==t),this.history.unshift(t),this.history=this.history.slice(0,10);try{await a.set("quickAddHistory",this.history)}catch(s){console.warn("N√£o foi poss√≠vel salvar hist√≥rico",s)}}async _loadHistory(){try{let t=await a.get("quickAddHistory");if(!t)try{const s=localStorage.getItem("quickAddHistory");s&&(t=JSON.parse(s),await a.set("quickAddHistory",t))}catch{}return t||[]}catch{try{const s=localStorage.getItem("quickAddHistory");return s?JSON.parse(s):[]}catch{return[]}}}_showError(t){console.warn(t)}clear(){this.input.value="",this._hideSuggestions(),this._hidePreview()}focus(){this.input.focus()}updateData(t,s){this.areas=t||[],this.tags=s||[]}destroy(){this.shortcutHandler&&document.removeEventListener("keydown",this.shortcutHandler),this.clickHandler&&document.removeEventListener("click",this.clickHandler),this.wrapper&&this.wrapper.parentNode&&this.wrapper.parentNode.removeChild(this.wrapper)}}typeof module<"u"&&module.exports&&(module.exports=u);export{u as QuickAddInput,u as default};
//# sourceMappingURL=QuickAddInput-D_IxD7ay.js.map
