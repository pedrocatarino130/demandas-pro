import{f as c}from"./firebase-cache-CPME0ep_.js";class p{constructor(){this.state=this.getDefaultState(),this.subscribers=[],this.saveDebounce=null,this.DEBOUNCE_DELAY=300,this.initialized=!1,this.initializing=!1,this.listeners=[],this.userId="default",this.init()}async init(){await c.init();const t=await this.loadFromCache();t&&(this.state={...this.getDefaultState(),...t},this.notify()),await this.migrateFromV2(),this.initialized=!0,console.log("✅ Store inicializado (modo local)")}getDefaultState(){return{tarefas:[],contador:0,tarefasHome:[],contadorHome:0,tarefasRotina:[],contadorRotina:0,historico:[],categorias:[],areasEstudo:[],topicosEstudo:[],sessoesEstudo:[],contadorEstudos:0,tagsEstudo:[],configEstudos:{revisaoEspacada:{ativo:!0,intervalos:[7,15,30]},notificacoes:!0,viewPadrao:"kanban"},streak:0,conquistas:{},avaliacoesDiarias:[],darkMode:!1,filtroStatus:null,diaAtual:new Date().toISOString().split("T")[0],ultimaAtualizacao:new Date().toISOString()}}async loadFromCache(){try{const t=await c.get("store-state");if(t&&typeof t=="object")return{...this.getDefaultState(),...t}}catch(t){console.warn("Erro ao carregar estado do cache:",t)}return null}async loadFromFirestore(){}saveToFirestore(){this.saveDebounce&&clearTimeout(this.saveDebounce),this.saveDebounce=setTimeout(async()=>{try{const t={...this.state,ultimaAtualizacao:new Date().toISOString()};await c.set("store-state",t)}catch(t){console.error("Erro ao salvar estado:",t)}},this.DEBOUNCE_DELAY)}async _saveCollectionsToFirestore(t){}setupRealtimeListeners(){}async runMigration(){}async migrateFromV2(){try{if(await c.get("firestore-migrated"))return;const e="tarefas_projetos_v2",a="tarefas_rotina_v5",n="historico_rotina_v5",r="categorias_rotina_v4",h="estudos_dados_v2",o="avaliacoes_diarias_v1",l="gerenciador_v3_state";let i=!1;const u=localStorage.getItem(e);if(u)try{this.state.tarefas=JSON.parse(u),i=!0}catch(s){console.warn("Erro ao migrar projetos:",s)}const d=localStorage.getItem(a);if(d)try{this.state.tarefasRotina=JSON.parse(d),i=!0}catch(s){console.warn("Erro ao migrar rotina:",s)}const f=localStorage.getItem(n);if(f)try{this.state.historico=JSON.parse(f),i=!0}catch(s){console.warn("Erro ao migrar histórico:",s)}const m=localStorage.getItem(r);if(m)try{this.state.categorias=JSON.parse(m),i=!0}catch(s){console.warn("Erro ao migrar categorias:",s)}const g=localStorage.getItem(h);if(g)try{const s=JSON.parse(g);this.state.areasEstudo=s.areas||[],this.state.topicosEstudo=s.topicos||[],this.state.sessoesEstudo=s.sessoes||[],this.state.tagsEstudo=s.tags||[],s.config&&(this.state.configEstudos={...this.state.configEstudos,...s.config}),i=!0}catch(s){console.warn("Erro ao migrar estudos:",s)}const S=localStorage.getItem(o);if(S)try{this.state.avaliacoesDiarias=JSON.parse(S),i=!0}catch(s){console.warn("Erro ao migrar avaliações:",s)}const E=localStorage.getItem(l);if(E)try{const s=JSON.parse(E);this.state={...this.state,...s},i=!0}catch(s){console.warn("Erro ao migrar estado v3:",s)}if(i){await this.saveToFirestore(),this.saveDebounce&&clearTimeout(this.saveDebounce);const s={...this.state,ultimaAtualizacao:new Date().toISOString()};await c.set("store-state",s)}await c.set("firestore-migrated",!0),i&&(console.log("✅ Migração v2/v3 concluída"),this.notify())}catch(t){console.error("Erro na migração:",t)}}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter(e=>e!==t)}}notify(){this.subscribers.forEach(t=>{try{t(this.state)}catch(e){console.error("Erro ao notificar subscriber:",e)}})}setState(t){this.state={...this.state,...t},this.saveToFirestore(),this.notify()}getState(){return{...this.state}}getStateSlice(t){return this.state[t]}updateStateSlice(t,e){const a=this.state[t];Array.isArray(a)?this.setState({[t]:[...a,...e]}):typeof a=="object"&&a!==null?this.setState({[t]:{...a,...e}}):this.setState({[t]:e})}addItem(t,e){const a=this.state[t];Array.isArray(a)&&this.setState({[t]:[...a,e]})}removeItem(t,e){const a=this.state[t];Array.isArray(a)&&this.setState({[t]:a.filter(n=>!e(n))})}updateItem(t,e,a){const n=this.state[t];Array.isArray(n)&&this.setState({[t]:n.map(r=>e(r)?{...r,...a}:r)})}async forceSave(){this.saveDebounce&&clearTimeout(this.saveDebounce);try{const t={...this.state,ultimaAtualizacao:new Date().toISOString()};await c.set("store-state",t)}catch(t){console.error("Erro ao forçar salvamento:",t)}}destroy(){this.listeners.forEach(t=>t()),this.listeners=[]}}const w=new p;class y{constructor(){this.toasts=[],this.container=null,this.init()}init(){this.container=document.createElement("div"),this.container.className="toast-container",this.container.id="toast-container",document.body.appendChild(this.container)}show(t,e={}){const{type:a="info",duration:n=5e3,action:r=null,actionLabel:h="Desfazer"}=e,o=document.createElement("div");return o.className=`toast toast-${a}`,o.innerHTML=`
      <span class="toast-message">${this.escapeHtml(t)}</span>
      ${r?`<button class="toast-action" data-action-id="${this.toasts.length}">${this.escapeHtml(h)}</button>`:""}
      <button class="toast-close" aria-label="Fechar">×</button>
    `,this.container.appendChild(o),setTimeout(()=>{o.classList.add("toast-show")},10),r&&o.querySelector(".toast-action").addEventListener("click",()=>{r(),this.hide(o)}),o.querySelector(".toast-close").addEventListener("click",()=>{this.hide(o)}),n>0&&setTimeout(()=>{this.hide(o)},n),this.toasts.push({element:o,action:r}),o}hide(t){t&&(t.classList.remove("toast-show"),t.classList.add("toast-hide"),setTimeout(()=>{t.parentNode&&t.parentNode.removeChild(t),this.toasts=this.toasts.filter(e=>e.element!==t)},300))}success(t,e={}){return this.show(t,{...e,type:"success"})}error(t,e={}){return this.show(t,{...e,type:"error"})}info(t,e={}){return this.show(t,{...e,type:"info"})}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}const D=new y;export{w as s,D as t};
//# sourceMappingURL=Toast-CgWkgWJS.js.map
