import{f as d,a as h,b as g}from"./index-7ypPvpma.js";class b{constructor(){this.state=this.getDefaultState(),this.subscribers=[],this.saveDebounce=null,this.DEBOUNCE_DELAY=300,this.initialized=!1,this.initializing=!1,this.listeners=[],this.userId="default",this.init()}async init(){if(this.initializing)return;this.initializing=!0,await d.init();const t=await this.loadFromCache();if(t&&(this.state={...this.getDefaultState(),...t},this.notify()),await this.migrateFromV2(),h.isAvailable())try{await this.loadFromFirestore(),this.setupRealtimeListeners(),console.log("✅ Store inicializado (modo Firebase + local)")}catch(e){console.error("⚠️ Erro ao inicializar Firebase no Store:",e),console.log("✅ Store inicializado (modo local apenas)")}else console.log("✅ Store inicializado (modo local)");this.initialized=!0,this.initializing=!1}getDefaultState(){return{tarefas:[],contador:0,tarefasHome:[],contadorHome:0,tarefasRotina:[],contadorRotina:0,historico:[],categorias:[],areasEstudo:[],topicosEstudo:[],sessoesEstudo:[],contadorEstudos:0,tagsEstudo:[],configEstudos:{revisaoEspacada:{ativo:!0,intervalos:[7,15,30]},notificacoes:!0,viewPadrao:"kanban"},streak:0,conquistas:{},avaliacoesDiarias:[],darkMode:!1,filtroStatus:null,diaAtual:new Date().toISOString().split("T")[0],ultimaAtualizacao:new Date().toISOString()}}async loadFromCache(){try{const t=await d.get("store-state");if(t&&typeof t=="object")return{...this.getDefaultState(),...t}}catch(t){console.warn("Erro ao carregar estado do cache:",t)}return null}async loadFromFirestore(){if(h.isAvailable())try{const t=[{collection:"tarefas",stateKey:"tarefas"},{collection:"tarefasRotina",stateKey:"tarefasRotina"},{collection:"historico",stateKey:"historico"},{collection:"categorias",stateKey:"categorias"},{collection:"areasEstudo",stateKey:"areasEstudo"},{collection:"topicosEstudo",stateKey:"topicosEstudo"},{collection:"sessoesEstudo",stateKey:"sessoesEstudo"},{collection:"tagsEstudo",stateKey:"tagsEstudo"},{collection:"avaliacoesDiarias",stateKey:"avaliacoesDiarias"}],e={};for(const{collection:s,stateKey:a}of t)try{const o=await h.getCollection(s,[],"_lastModified","desc");o&&o.length>0&&(e[a]=o)}catch(o){console.warn(`Erro ao carregar coleção ${s}:`,o)}try{const s=await h.getDocument("configEstudos","default");s&&(e.configEstudos=s)}catch(s){console.warn("Erro ao carregar configEstudos:",s)}Object.keys(e).length>0&&(this.state={...this.state,...e},await d.set("store-state",this.state),console.log("✅ Dados carregados do Firestore"),this.notify())}catch(t){console.error("Erro ao carregar do Firestore:",t)}}saveToFirestore(){this.saveDebounce&&clearTimeout(this.saveDebounce),this.saveDebounce=setTimeout(async()=>{try{const t={...this.state,ultimaAtualizacao:new Date().toISOString()};await d.set("store-state",t),h.isAvailable()&&await this._saveCollectionsToFirestore(t)}catch(t){console.error("Erro ao salvar estado:",t)}},this.DEBOUNCE_DELAY)}async _saveCollectionsToFirestore(t){if(h.isAvailable())try{const e=[{stateKey:"tarefas",collection:"tarefas"},{stateKey:"tarefasRotina",collection:"tarefasRotina"},{stateKey:"historico",collection:"historico"},{stateKey:"categorias",collection:"categorias"},{stateKey:"areasEstudo",collection:"areasEstudo"},{stateKey:"topicosEstudo",collection:"topicosEstudo"},{stateKey:"sessoesEstudo",collection:"sessoesEstudo"},{stateKey:"tagsEstudo",collection:"tagsEstudo"},{stateKey:"avaliacoesDiarias",collection:"avaliacoesDiarias"}],s=[];for(const{stateKey:a,collection:o}of e){const n=t[a];Array.isArray(n)&&n.forEach(i=>{i&&i.id&&s.push({type:"UPDATE",collection:o,docId:i.id,data:i})})}if(t.configEstudos&&s.push({type:"UPDATE",collection:"configEstudos",docId:"default",data:t.configEstudos}),s.length>0)if(g.getOnlineStatus())try{await h.batchWrite(s)}catch(a){console.warn("Erro ao sincronizar imediatamente, adicionando à fila:",a);for(const o of s)await g.addToQueue(o)}else for(const a of s)await g.addToQueue(a)}catch(e){console.error("Erro ao salvar coleções no Firestore:",e)}}setupRealtimeListeners(){if(h.isAvailable())try{this.destroy(),[{collection:"tarefas",stateKey:"tarefas"},{collection:"tarefasRotina",stateKey:"tarefasRotina"},{collection:"historico",stateKey:"historico"},{collection:"categorias",stateKey:"categorias"},{collection:"areasEstudo",stateKey:"areasEstudo"},{collection:"topicosEstudo",stateKey:"topicosEstudo"},{collection:"sessoesEstudo",stateKey:"sessoesEstudo"},{collection:"tagsEstudo",stateKey:"tagsEstudo"},{collection:"avaliacoesDiarias",stateKey:"avaliacoesDiarias"}].forEach(({collection:s,stateKey:a})=>{const o=h.subscribeToCollection(s,n=>{Array.isArray(n)&&(this.state[a]=n,d.set("store-state",this.state).catch(i=>{console.error("Erro ao salvar no cache após atualização remota:",i)}),this.notify())},[]);this.listeners.push(o)});const e=h.subscribeToDocument("configEstudos","default",s=>{s&&(this.state.configEstudos=s,d.set("store-state",this.state).catch(a=>{console.error("Erro ao salvar config no cache:",a)}),this.notify())});this.listeners.push(e),console.log("✅ Listeners real-time configurados")}catch(t){console.error("Erro ao configurar listeners real-time:",t)}}async runMigration(){}async migrateFromV2(){try{if(await d.get("firestore-migrated"))return;const e="tarefas_projetos_v2",s="tarefas_rotina_v5",a="historico_rotina_v5",o="categorias_rotina_v4",n="estudos_dados_v2",i="avaliacoes_diarias_v1",u="gerenciador_v3_state";let l=!1;const p=localStorage.getItem(e);if(p)try{this.state.tarefas=JSON.parse(p),l=!0}catch(c){console.warn("Erro ao migrar projetos:",c)}const m=localStorage.getItem(s);if(m)try{this.state.tarefasRotina=JSON.parse(m),l=!0}catch(c){console.warn("Erro ao migrar rotina:",c)}const E=localStorage.getItem(a);if(E)try{this.state.historico=JSON.parse(E),l=!0}catch(c){console.warn("Erro ao migrar histórico:",c)}const y=localStorage.getItem(o);if(y)try{this.state.categorias=JSON.parse(y),l=!0}catch(c){console.warn("Erro ao migrar categorias:",c)}const v=localStorage.getItem(n);if(v)try{const c=JSON.parse(v);this.state.areasEstudo=c.areas||[],this.state.topicosEstudo=c.topicos||[],this.state.sessoesEstudo=c.sessoes||[],this.state.tagsEstudo=c.tags||[],c.config&&(this.state.configEstudos={...this.state.configEstudos,...c.config}),l=!0}catch(c){console.warn("Erro ao migrar estudos:",c)}const k=localStorage.getItem(i);if(k)try{this.state.avaliacoesDiarias=JSON.parse(k),l=!0}catch(c){console.warn("Erro ao migrar avaliações:",c)}const w=localStorage.getItem(u);if(w)try{const c=JSON.parse(w);this.state={...this.state,...c},l=!0}catch(c){console.warn("Erro ao migrar estado v3:",c)}if(l){await this.saveToFirestore(),this.saveDebounce&&clearTimeout(this.saveDebounce);const c={...this.state,ultimaAtualizacao:new Date().toISOString()};await d.set("store-state",c)}await d.set("firestore-migrated",!0),l&&(console.log("✅ Migração v2/v3 concluída"),this.notify())}catch(t){console.error("Erro na migração:",t)}}subscribe(t){return this.subscribers.push(t),()=>{this.subscribers=this.subscribers.filter(e=>e!==t)}}notify(){this.subscribers.forEach(t=>{try{t(this.state)}catch(e){console.error("Erro ao notificar subscriber:",e)}})}setState(t){this.state={...this.state,...t},this.saveToFirestore(),this.notify()}getState(){return{...this.state}}getStateSlice(t){return this.state[t]}updateStateSlice(t,e){const s=this.state[t];Array.isArray(s)?this.setState({[t]:[...s,...e]}):typeof s=="object"&&s!==null?this.setState({[t]:{...s,...e}}):this.setState({[t]:e})}addItem(t,e){const s=this.state[t];Array.isArray(s)&&this.setState({[t]:[...s,e]})}removeItem(t,e){const s=this.state[t];Array.isArray(s)&&this.setState({[t]:s.filter(a=>!e(a))})}updateItem(t,e,s){const a=this.state[t];Array.isArray(a)&&this.setState({[t]:a.map(o=>e(o)?{...o,...s}:o)})}async forceSave(){this.saveDebounce&&clearTimeout(this.saveDebounce);try{const t={...this.state,ultimaAtualizacao:new Date().toISOString()};await d.set("store-state",t)}catch(t){console.error("Erro ao forçar salvamento:",t)}}destroy(){this.listeners.forEach(t=>t()),this.listeners=[]}}const A=new b;function T(r,t){const e=new Date(r);return e.setHours(e.getHours()+t),e}function C(r,t="dd/MM/yyyy"){if(!r)return"";const e=typeof r=="string"?f(r):r;if(!e)return"";const s=String(e.getDate()).padStart(2,"0"),a=String(e.getMonth()+1).padStart(2,"0"),o=e.getFullYear();return t.replace("dd",s).replace("MM",a).replace("yyyy",o)}function N(r){if(!r)return 0;const t=typeof r=="string"?f(r):r;if(!t)return 0;const e=new Date;if(t>e)return 0;const s=e-t;return Math.floor(s/(1e3*60*60*24))}function K(){return new Date().toISOString().split("T")[0]}function f(r){if(!r)return null;if(r instanceof Date)return r;if(typeof r=="string"){if(r.match(/^\d{4}-\d{2}-\d{2}$/))return new Date(r+"T00:00:00");try{return new Date(r)}catch{return null}}return null}class S{constructor(t={}){this.checked=t.checked||!1,this.onChange=t.onChange||(()=>{}),this.id=t.id||null,this.className=t.className||""}render(){const t=document.createElement("div");t.className=`neon-checkbox-wrapper ${this.checked?"checked":""} ${this.className}`.trim(),this.id&&(t.id=this.id);const e=document.createElement("div");e.className=`neon-checkbox-container ${this.checked?"checked":""}`;const s=document.createElement("div");s.className="neon-checkbox-background",e.appendChild(s);const a=document.createElement("div");a.className="neon-checkbox-icon",a.innerHTML=`
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor">
        <polyline points="20 6 9 17 4 12"></polyline>
      </svg>
    `,e.appendChild(a);const o=document.createElement("div");o.className="neon-checkbox-dot neon-checkbox-dot-left",t.appendChild(o),t.appendChild(e);const n=document.createElement("div");return n.className="neon-checkbox-dot neon-checkbox-dot-right",t.appendChild(n),t.addEventListener("click",i=>{i.preventDefault(),i.stopPropagation(),this.toggle()}),this._element=t,this._container=e,t}toggle(){this.checked=!this.checked,this.update(),this.onChange(this.checked)}setChecked(t){this.checked=t,this.update()}update(){this._element&&this._container&&(this.checked?(this._element.classList.add("checked"),this._container.classList.add("checked")):(this._element.classList.remove("checked"),this._container.classList.remove("checked")))}getChecked(){return this.checked}}function D(r){return new S(r).render()}class M{constructor(t,e={}){this.task=t,this.options={showCheckbox:!0,showPriority:!0,showActions:!0,isCurrent:!1,isOverdue:!1,isCompleted:!1,isPostponed:!1,onToggleStatus:null,onEdit:null,onDelete:null,...e}}render(){const t=document.createElement("div");t.className="task-card",this.options.isCurrent&&t.classList.add("task-card-current"),this.options.isOverdue&&t.classList.add("task-card-overdue"),(this.options.isCompleted||this.task.completed)&&t.classList.add("task-card-completed","done"),this.options.isPostponed&&t.classList.add("task-card-postponed");const e=this.options.isCompleted||this.task.completed,s=this.renderTopArea(e);t.appendChild(s);const a=this.renderContentArea(e);return t.appendChild(a),t}renderTopArea(t){const e=document.createElement("div");if(e.className=`task-card-top ${t?"done":""}`,this.options.showPriority){const a=this.renderPriorityBadge();e.appendChild(a)}const s=document.createElement("div");return s.className="task-card-icon-wrapper",t?s.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M5 13l4 4L19 7"></path>
                </svg>
            `:s.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M9 5H7a2 2 0 0 0-2 2v12a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V7a2 2 0 0 0-2-2h-2M9 5a2 2 0 0 0 2 2h2a2 2 0 0 0 2-2M9 5a2 2 0 0 1 2-2h2a2 2 0 0 1 2 2m-3 7h3m-3 4h3m-6-4h.01M9 16h.01"></path>
                </svg>
            `,e.appendChild(s),e}renderPriorityBadge(){const t=document.createElement("div");t.className="task-card-priority-badge";const e=(this.task.prioridade||"media").toLowerCase(),a={urgente:"high",alta:"high",media:"medium",média:"medium",baixa:"low"}[e]||"medium",n={urgente:"Alta",alta:"Alta",media:"Média",média:"Média",baixa:"Baixa"}[e]||"Média",i=document.createElement("span");return i.className=`priority-badge ${a}`,i.textContent=n,t.appendChild(i),t}renderContentArea(t){const e=document.createElement("div");e.className="task-card-content";const s=document.createElement("div");s.className="task-card-header";const a=document.createElement("div");a.className="task-card-title-wrapper";const o=document.createElement("h3");o.className="task-card-title",o.textContent=this.escapeHtml(this.task.titulo||this.task.nome||"Sem título");const n=document.createElement("p");if(n.className="task-card-description",n.textContent=this.escapeHtml(this.task.descricao||"Sem descrição"),a.appendChild(o),a.appendChild(n),this.options.showCheckbox){const l=document.createElement("div");l.className="task-card-checkbox-wrapper";const p=D({checked:t,onChange:m=>{this.options.onToggleStatus&&this.options.onToggleStatus(this.task.id||this.task.contador,m)}});l.appendChild(p),s.appendChild(a),s.appendChild(l)}else s.appendChild(a);e.appendChild(s);const i=this.renderTags();e.appendChild(i);const u=this.renderMetaInfo();return e.appendChild(u),e}renderTags(){const t=document.createElement("div");t.className="task-card-tags";const e=this.task.tags||[];if(e.length>0)e.forEach(s=>{const a=document.createElement("span");a.className="task-card-tag",a.textContent=`#${s.trim()}`,t.appendChild(a)});else{const s=document.createElement("span");s.className="task-card-tags-empty",s.textContent="Sem tags",t.appendChild(s)}return t}renderMetaInfo(){const t=document.createElement("div");t.className="task-card-meta";const e=document.createElement("div");e.className="task-card-meta-left";const s=f(this.task.time);if(s){const a=document.createElement("div");a.className="task-card-meta-item",a.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <rect x="3" y="4" width="18" height="18" rx="2" ry="2"></rect>
                    <line x1="16" y1="2" x2="16" y2="6"></line>
                    <line x1="8" y1="2" x2="8" y2="6"></line>
                    <line x1="3" y1="10" x2="21" y2="10"></line>
                </svg>
                <span>${C(s,"dd/MM/yyyy")}</span>
            `,e.appendChild(a)}if(this.task.responsavel){const a=document.createElement("div");a.className="task-card-meta-item",a.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M20 21v-2a4 4 0 0 0-4-4H8a4 4 0 0 0-4 4v2"></path>
                    <circle cx="12" cy="7" r="4"></circle>
                </svg>
                <span class="task-card-meta-assignee">${this.escapeHtml(this.task.responsavel)}</span>
            `,e.appendChild(a)}if(t.appendChild(e),this.options.showActions){const a=document.createElement("div");a.className="task-card-actions";const o=this.task.id||this.task.contador,n=document.createElement("button");n.className="task-card-action-button edit",n.setAttribute("data-action","edit"),n.setAttribute("data-task-id",o),n.setAttribute("title","Editar"),n.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <path d="M11 4H4a2 2 0 0 0-2 2v14a2 2 0 0 0 2 2h14a2 2 0 0 0 2-2v-7"></path>
                    <path d="M18.5 2.5a2.121 2.121 0 0 1 3 3L12 15l-4 1 1-4 9.5-9.5z"></path>
                </svg>
            `,n.addEventListener("click",u=>{u.stopPropagation(),this.options.onEdit&&this.options.onEdit(this.task)}),a.appendChild(n);const i=document.createElement("button");i.className="task-card-action-button delete",i.setAttribute("data-action","delete"),i.setAttribute("data-task-id",o),i.setAttribute("title","Excluir"),i.innerHTML=`
                <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round">
                    <polyline points="3 6 5 6 21 6"></polyline>
                    <path d="M19 6v14a2 2 0 0 1-2 2H7a2 2 0 0 1-2-2V6m3 0V4a2 2 0 0 1 2-2h4a2 2 0 0 1 2 2v2"></path>
                </svg>
            `,i.addEventListener("click",u=>{u.stopPropagation(),this.options.onDelete&&this.options.onDelete(this.task.id||this.task.contador)}),a.appendChild(i),t.appendChild(a)}return t}escapeHtml(t){const e=document.createElement("div");return e.textContent=t,e.innerHTML}}export{M as T,T as a,N as b,K as g,A as s,f as t};
//# sourceMappingURL=TaskCard-CQKHJvpQ.js.map
