import{s as m}from"./store-DPel3hzc.js";import{g as S,a as I,b as A,c as L,t as T,T as y,s as D,d as O,e as F,f as H,h as P,i as G}from"./swipe-gestures-CKoNtDs5.js";import{t as c}from"./index-Ac05Oo_z.js";import{t as B}from"./TaskEditModal-Ctjk6Vfp.js";import{confirmAction as U}from"./ConfirmModal-BsncAfHd.js";import"./idb-Dob3nYDb.js";function x(u,e){let t;return function(...a){const i=()=>{clearTimeout(t),u(...a)};clearTimeout(t),t=setTimeout(i,e)}}function N(u,e){let t;return function(...a){t||(u.apply(this,a),t=!0,setTimeout(()=>t=!1,e))}}function M(u){const e=new Map;return function(...r){const a=JSON.stringify(r);if(e.has(a))return e.get(a);const i=u.apply(this,r);return e.set(a,i),i}}function E(u,e="array"){return e==="array"?Array.isArray(u):e==="object"?u!==null&&typeof u=="object"&&!Array.isArray(u):e==="number"?typeof u=="number"&&!isNaN(u):u!=null}function f(u){if(typeof u!="string")return"";const e=document.createElement("div");return e.textContent=u,e.innerHTML}function k(u,e){if(!Array.isArray(u)||!Array.isArray(e))return{changed:!0,added:[],removed:[],modified:[]};const t=new Set(u.map(s=>String((s==null?void 0:s.id)||(s==null?void 0:s.contador)||""))),r=new Set(e.map(s=>String((s==null?void 0:s.id)||(s==null?void 0:s.contador)||""))),a=e.filter(s=>{const n=String((s==null?void 0:s.id)||(s==null?void 0:s.contador)||"");return!t.has(n)}),i=u.filter(s=>{const n=String((s==null?void 0:s.id)||(s==null?void 0:s.contador)||"");return!r.has(n)}),o=e.filter(s=>{const n=String((s==null?void 0:s.id)||(s==null?void 0:s.contador)||"");if(!t.has(n))return!1;const l=u.find(h=>String((h==null?void 0:h.id)||(h==null?void 0:h.contador)||"")===n);return l&&JSON.stringify(l)!==JSON.stringify(s)});return{changed:a.length>0||i.length>0||o.length>0,added:a,removed:i,modified:o}}const V=6e4,g=5,R=100,z=1,C=2,j=300,q=1e3;class _{constructor(){this.updateInterval=null,this.unsubscribe=null,this.eventListeners=[],this.swipeGestureCleanups=[],this.isLoading=!1,this.lastRenderData=null,this.currentFilter={search:"",priority:"all",module:"all",sortBy:"time"},this.swipeGestureMap=new Map,this.memoizedGetUpcomingTasks=M((e,t)=>G(e,t)),this.memoizedGetOverdueTasks=M(e=>H(e))}render(){try{if(this.isLoading&&!this.lastRenderData)return this.renderLoadingState();const e=m.getState();if(!E(e.tarefasHome,"array"))return console.warn("Dados inv√°lidos do store, usando array vazio"),this.renderErrorState("Erro ao carregar dados");const t=e.tarefasHome||[],r=this.applyFilters(t),a=this.memoizedGetUpcomingTasks(this.filterUpcomingTasks(r),C),i=this.memoizedGetOverdueTasks(this.filterOverdueTasks(r)),o=S(r),s=I(r),n=A(t),l=L(t),h=this.sortTasks(a,this.currentFilter.sortBy),v=new Date,d=h.find(w=>{const b=T(w.time);return b&&b<=v}),p={upcomingTasks:h,overdueTasks:i,completedTasks:o,postponedTasks:s,completedToday:n.length,totalToday:l,streak:e.streak||0,currentTask:d};return this.lastRenderData=p,`
                <div class="home-view" role="main" aria-label="Dashboard principal">
                    ${this.renderFiltersSection()}
                    ${this.renderUpcomingSection(h,d)}
                    ${this.renderOverdueSection(i)}
                    ${this.renderMetricsSection(n.length,l,e.streak||0)}
                    ${this.renderCompletedSection(o)}
                    ${this.renderPostponedSection(s)}
                </div>
            `}catch(e){return this.handleRenderError(e)}}mount(){try{this.isLoading=!0,this.updateInterval=setInterval(()=>{this.throttledUpdate()},V),this.unsubscribe=m.subscribe(()=>{this.debouncedUpdate()}),this.setupEventListeners(),this.isLoading=!1}catch(e){this.handleError("Erro ao montar HomeView",e)}}update(){try{const e=document.getElementById("app");if(!e)return;const t=m.getState();if(!E(t.tarefasHome,"array"))return;const r=t.tarefasHome||[],a=this.applyFilters(r),i=this.memoizedGetUpcomingTasks(this.filterUpcomingTasks(a),C),o=this.memoizedGetOverdueTasks(this.filterOverdueTasks(a)),s=S(a),n=I(a),l=A(r),h=L(r),v=this.sortTasks(i,this.currentFilter.sortBy),d=new Date,p=v.find(b=>{const $=T(b.time);return $&&$<=d}),w={upcomingTasks:v,overdueTasks:o,completedTasks:s,postponedTasks:n,completedToday:l.length,totalToday:h,streak:t.streak||0,currentTask:p};this.lastRenderData?this.updateIncremental(w):(e.innerHTML=this.render(),this.setupEventListeners()),this.lastRenderData=w}catch(e){this.handleError("Erro ao atualizar view",e)}}updateIncremental(e){const t=this.lastRenderData;if(!t){document.getElementById("app").innerHTML=this.render(),this.setupEventListeners();return}k(t.upcomingTasks,e.upcomingTasks).changed&&this.updateTimelineSection(e.upcomingTasks,e.currentTask),k(t.overdueTasks,e.overdueTasks).changed&&this.updateOverdueSection(e.overdueTasks),(t.completedToday!==e.completedToday||t.totalToday!==e.totalToday||t.streak!==e.streak)&&this.updateMetricsSection(e.completedToday,e.totalToday,e.streak),k(t.completedTasks||[],e.completedTasks||[]).changed&&this.updateCompletedSection(e.completedTasks||[]),k(t.postponedTasks||[],e.postponedTasks||[]).changed&&this.updatePostponedSection(e.postponedTasks||[])}updateTimelineSection(e,t){const r=document.getElementById("home-timeline");r&&(e.length>0?r.innerHTML=this.renderTimeline(e,t):r.innerHTML=this.renderEmptyState("Nenhuma tarefa nas pr√≥ximas 2 horas",!0),this.setupSwipeGestures())}updateOverdueSection(e){const t=document.getElementById("home-section-overdue");if(!t){const o=document.getElementById("app");o&&(o.innerHTML=this.render(),this.setupEventListeners());return}if(e.length===0){t.remove();return}const r=e.length>g,a=r?e.slice(0,g):e,i=document.getElementById("home-overdue-list");if(i){const o=a.filter(l=>l!=null).map(l=>{const h=new y(l,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!1,isCurrent:!1,isOverdue:!0,showActions:!0});return`<div class="overdue-item" data-task-id="${this.getTaskId(l)}" role="listitem">${h.render().outerHTML}</div>`}).join("");i.innerHTML=o;const s=t.querySelector(".home-section-badge");s&&(s.textContent=e.length);const n=document.getElementById("btn-show-all-overdue");if(r&&!n){const l=document.createElement("button");l.className="btn btn-secondary mt-md",l.id="btn-show-all-overdue",l.textContent=`Ver todas (${e.length})`,l.setAttribute("aria-label",`Ver todas as ${e.length} tarefas atrasadas`),l.addEventListener("click",()=>this.showAllOverdue()),this.registerEventListener("click",()=>this.showAllOverdue(),l),t.appendChild(l)}else!r&&n&&n.remove()}this.setupSwipeGestures()}updateMetricsSection(e,t,r){const a=document.getElementById("home-section-metrics");if(!a)return;const i=t>0?Math.round(e/t*100):0,o=a.querySelector(".home-metrics-item:first-child .home-metrics-value");o&&(o.textContent=`${e}/${t}`);const s=a.querySelector(".home-metrics-item:last-child .home-metrics-value");s&&(s.textContent=`üî• ${r} dias`);const n=a.querySelector(".home-metrics-progress-bar"),l=a.querySelector(".home-metrics-progress-text");n&&(n.style.width=`${i}%`,n.setAttribute("aria-valuenow",i),n.setAttribute("aria-label",`${i}% das tarefas conclu√≠das`)),l&&(l.textContent=`${i}%`)}updateCompletedSection(e){const t=document.getElementById("home-section-completed");if(!t){const o=document.getElementById("app");o&&(o.innerHTML=this.render(),this.setupEventListeners());return}if(e.length===0){t.remove();return}const r=e.length>g,a=r?e.slice(0,g):e,i=document.getElementById("home-completed-list");if(i){const o=a.filter(l=>l!=null).map(l=>{const h=new y(l,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!1,isCurrent:!1,isOverdue:!1,showActions:!0,isCompleted:!0});return`<div class="completed-item" data-task-id="${this.getTaskId(l)}" role="listitem" tabindex="0" aria-label="Tarefa conclu√≠da: ${f(l.titulo||l.nome||"Sem t√≠tulo")}">${h.render().outerHTML}</div>`}).join("");i.innerHTML=o;const s=t.querySelector(".home-section-badge");s&&(s.textContent=e.length);const n=document.getElementById("btn-show-all-completed");if(r&&!n){const l=document.createElement("button");l.className="btn btn-secondary mt-md",l.id="btn-show-all-completed",l.textContent=`Ver todas (${e.length})`,l.setAttribute("aria-label",`Ver todas as ${e.length} tarefas conclu√≠das`),l.addEventListener("click",()=>this.showAllCompleted()),this.registerEventListener("click",()=>this.showAllCompleted(),l),t.appendChild(l)}else!r&&n&&n.remove()}this.setupSwipeGestures()}updatePostponedSection(e){const t=document.getElementById("home-section-postponed");if(!t){const o=document.getElementById("app");o&&(o.innerHTML=this.render(),this.setupEventListeners());return}if(e.length===0){t.remove();return}const r=e.length>g,a=r?e.slice(0,g):e,i=document.getElementById("home-postponed-list");if(i){const o=a.filter(l=>l!=null).map(l=>{const h=new y(l,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!0,isCurrent:!1,isOverdue:!1,showActions:!0});return`<div class="postponed-item" data-task-id="${this.getTaskId(l)}" role="listitem" tabindex="0" aria-label="Tarefa adiada: ${f(l.titulo||l.nome||"Sem t√≠tulo")}">${h.render().outerHTML}</div>`}).join("");i.innerHTML=o;const s=t.querySelector(".home-section-badge");s&&(s.textContent=e.length);const n=document.getElementById("btn-show-all-postponed");if(r&&!n){const l=document.createElement("button");l.className="btn btn-secondary mt-md",l.id="btn-show-all-postponed",l.textContent=`Ver todas (${e.length})`,l.setAttribute("aria-label",`Ver todas as ${e.length} tarefas adiadas`),l.addEventListener("click",()=>this.showAllPostponed()),this.registerEventListener("click",()=>this.showAllPostponed(),l),t.appendChild(l)}else!r&&n&&n.remove()}this.setupSwipeGestures()}destroy(){try{this.updateInterval&&(clearInterval(this.updateInterval),this.updateInterval=null),this.unsubscribe&&(this.unsubscribe(),this.unsubscribe=null),this.cleanupEventListeners(),this.cleanupSwipeGestures(),this.lastRenderData=null,this.swipeGestureMap.clear()}catch(e){this.handleError("Erro ao destruir HomeView",e)}}renderLoadingState(){return`
            <div class="home-view" role="main" aria-label="Carregando dashboard">
                <div class="home-loading" role="status" aria-live="polite" aria-label="Carregando">
                    <div class="home-skeleton">
                        <div class="home-skeleton-header"></div>
                        <div class="home-skeleton-item"></div>
                        <div class="home-skeleton-item"></div>
                        <div class="home-skeleton-item"></div>
                    </div>
                </div>
            </div>
        `}renderErrorState(e){return`
            <div class="home-view" role="main">
                <div class="home-error-state" role="alert">
                    <p class="home-error-message">${f(e)}</p>
                    <button class="btn btn-primary" id="btn-retry-home" aria-label="Tentar novamente">
                        Tentar novamente
                    </button>
                </div>
            </div>
        `}renderFiltersSection(){return`
            <section class="home-filters" role="search" aria-label="Filtros e busca de tarefas">
                <div class="home-filters-row">
                    <div class="home-search-wrapper">
                        <input 
                            type="search" 
                            id="home-search-input" 
                            class="home-search-input" 
                            placeholder="Buscar tarefas..."
                            aria-label="Buscar tarefas"
                            value="${f(this.currentFilter.search)}"
                        />
                        <span class="home-search-icon" aria-hidden="true">üîç</span>
                    </div>
                    <div class="home-filters-group">
                        <label for="home-filter-priority" class="home-filter-label">Prioridade:</label>
                        <select 
                            id="home-filter-priority" 
                            class="home-filter-select"
                            aria-label="Filtrar por prioridade"
                        >
                            <option value="all" ${this.currentFilter.priority==="all"?"selected":""}>Todas</option>
                            <option value="urgente" ${this.currentFilter.priority==="urgente"?"selected":""}>Urgente</option>
                            <option value="alta" ${this.currentFilter.priority==="alta"?"selected":""}>Alta</option>
                            <option value="media" ${this.currentFilter.priority==="media"?"selected":""}>M√©dia</option>
                            <option value="baixa" ${this.currentFilter.priority==="baixa"?"selected":""}>Baixa</option>
                        </select>
                    </div>
                    <div class="home-filters-group">
                        <label for="home-filter-sort" class="home-filter-label">Ordenar:</label>
                        <select 
                            id="home-filter-sort" 
                            class="home-filter-select"
                            aria-label="Ordenar tarefas"
                        >
                            <option value="time" ${this.currentFilter.sortBy==="time"?"selected":""}>Por hor√°rio</option>
                            <option value="priority" ${this.currentFilter.sortBy==="priority"?"selected":""}>Por prioridade</option>
                            <option value="module" ${this.currentFilter.sortBy==="module"?"selected":""}>Por m√≥dulo</option>
                            <option value="createdAt" ${this.currentFilter.sortBy==="createdAt"?"selected":""}>Por data de cria√ß√£o</option>
                        </select>
                    </div>
                </div>
            </section>
        `}renderUpcomingSection(e,t){return`
            <section class="home-section home-section-now" aria-labelledby="upcoming-tasks-title">
                <div class="home-section-header">
                    <h2 id="upcoming-tasks-title" class="home-section-title">‚è∞ Pr√≥ximas 2 horas</h2>
                    <div style="display: flex; align-items: center; gap: var(--spacing-md);">
                        <span class="home-section-badge" aria-label="${e.length} tarefas nas pr√≥ximas 2 horas">${e.length}</span>
                        <button 
                            class="btn btn-primary btn-icon" 
                            id="btn-add-task-home" 
                            title="Adicionar tarefa"
                            aria-label="Adicionar nova tarefa"
                        >
                            <span aria-hidden="true">‚ûï</span>
                            <span class="btn-text">Nova Tarefa</span>
                        </button>
                    </div>
                </div>
                <div class="home-timeline" id="home-timeline" role="list" aria-label="Lista de tarefas pr√≥ximas">
                    ${e.length>0?this.renderTimeline(e,t):this.renderEmptyState("Nenhuma tarefa nas pr√≥ximas 2 horas",!0)}
                </div>
            </section>
        `}renderTimeline(e,t){return Array.isArray(e)?`<div class="timeline-list">${e.filter(a=>a!=null).map(a=>{const i=new y(a,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!0,isCurrent:t&&this.getTaskId(t)===this.getTaskId(a),isOverdue:!1,showActions:!0});return`<div class="timeline-item" data-task-id="${this.getTaskId(a)}" role="listitem" tabindex="0" aria-label="Tarefa: ${f(a.titulo||a.nome||"Sem t√≠tulo")}">${i.render().outerHTML}</div>`}).join("")}</div>`:this.renderEmptyState("Erro ao carregar tarefas")}renderOverdueSection(e){if(!Array.isArray(e)||e.length===0)return"";const t=e.length>g,a=(t?e.slice(0,g):e).filter(o=>o!=null).map(o=>{const s=new y(o,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!1,isCurrent:!1,isOverdue:!0,showActions:!0});return`<div class="overdue-item" data-task-id="${this.getTaskId(o)}" role="listitem" tabindex="0" aria-label="Tarefa atrasada: ${f(o.titulo||o.nome||"Sem t√≠tulo")}">${s.render().outerHTML}</div>`}).join(""),i=t?`<button class="btn btn-secondary mt-md" id="btn-show-all-overdue" aria-label="Ver todas as ${e.length} tarefas atrasadas">Ver todas (${e.length})</button>`:"";return`
            <section class="home-section home-section-overdue" id="home-section-overdue" aria-labelledby="overdue-tasks-title">
                <div class="home-section-header">
                    <h2 id="overdue-tasks-title" class="home-section-title">‚ö†Ô∏è Atrasadas</h2>
                    <span class="home-section-badge badge badge-danger" aria-label="${e.length} tarefas atrasadas">${e.length}</span>
                </div>
                <div class="home-overdue-list" id="home-overdue-list" role="list" aria-label="Lista de tarefas atrasadas">
                    ${a}
                </div>
                ${i}
            </section>
        `}renderMetricsSection(e,t,r){const a=t>0?Math.round(e/t*100):0;return`
            <section class="home-section home-section-metrics" id="home-section-metrics" aria-labelledby="metrics-title">
                <h2 id="metrics-title" class="sr-only">M√©tricas do dia</h2>
                <div class="home-metrics" role="region" aria-label="Estat√≠sticas do dia">
                    <div class="home-metrics-item">
                        <div class="home-metrics-label">Conclu√≠das hoje</div>
                        <div class="home-metrics-value" aria-label="${e} de ${t} tarefas conclu√≠das">${e}/${t}</div>
                    </div>
                    <div class="home-metrics-item">
                        <div class="home-metrics-label">Streak</div>
                        <div class="home-metrics-value" aria-label="${r} dias consecutivos">üî• ${r} dias</div>
                    </div>
                    <div class="home-metrics-progress" role="progressbar" aria-valuenow="${a}" aria-valuemin="0" aria-valuemax="100" aria-label="Progresso: ${a}% das tarefas conclu√≠das">
                        <div class="home-metrics-progress-bar" style="width: ${a}%"></div>
                        <span class="home-metrics-progress-text">${a}%</span>
                    </div>
                </div>
            </section>
        `}renderCompletedSection(e){if(!Array.isArray(e)||e.length===0)return"";const t=e.length>g,a=(t?e.slice(0,g):e).filter(o=>o!=null).map(o=>{const s=new y(o,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!1,isCurrent:!1,isOverdue:!1,showActions:!0,isCompleted:!0});return`<div class="completed-item" data-task-id="${this.getTaskId(o)}" role="listitem" tabindex="0" aria-label="Tarefa conclu√≠da: ${f(o.titulo||o.nome||"Sem t√≠tulo")}">${s.render().outerHTML}</div>`}).join(""),i=t?`<button class="btn btn-secondary mt-md" id="btn-show-all-completed" aria-label="Ver todas as ${e.length} tarefas conclu√≠das">Ver todas (${e.length})</button>`:"";return`
            <section class="home-section home-section-completed" id="home-section-completed" aria-labelledby="completed-tasks-title">
                <div class="home-section-header">
                    <h2 id="completed-tasks-title" class="home-section-title">‚úÖ Conclu√≠das</h2>
                    <span class="home-section-badge badge badge-success" aria-label="${e.length} tarefas conclu√≠das">${e.length}</span>
                </div>
                <div class="home-completed-list" id="home-completed-list" role="list" aria-label="Lista de tarefas conclu√≠das">
                    ${a}
                </div>
                ${i}
            </section>
        `}renderPostponedSection(e){if(!Array.isArray(e)||e.length===0)return"";const t=e.length>g,a=(t?e.slice(0,g):e).filter(o=>o!=null).map(o=>{const s=new y(o,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!0,isCurrent:!1,isOverdue:!1,showActions:!0});return`<div class="postponed-item" data-task-id="${this.getTaskId(o)}" role="listitem" tabindex="0" aria-label="Tarefa adiada: ${f(o.titulo||o.nome||"Sem t√≠tulo")}">${s.render().outerHTML}</div>`}).join(""),i=t?`<button class="btn btn-secondary mt-md" id="btn-show-all-postponed" aria-label="Ver todas as ${e.length} tarefas adiadas">Ver todas (${e.length})</button>`:"";return`
            <section class="home-section home-section-postponed" id="home-section-postponed" aria-labelledby="postponed-tasks-title">
                <div class="home-section-header">
                    <h2 id="postponed-tasks-title" class="home-section-title">üìÖ Adiadas</h2>
                    <span class="home-section-badge badge badge-info" aria-label="${e.length} tarefas adiadas">${e.length}</span>
                </div>
                <div class="home-postponed-list" id="home-postponed-list" role="list" aria-label="Lista de tarefas adiadas">
                    ${a}
                </div>
                ${i}
            </section>
        `}renderEmptyState(e,t=!1){const r=t?`
            <button class="btn btn-primary mt-md" id="btn-add-task-empty" aria-label="Adicionar nova tarefa">
                ‚ûï Adicionar Tarefa
            </button>
        `:"";return`
            <div class="home-empty-state" role="status" aria-live="polite">
                <div class="home-empty-state-icon" aria-hidden="true">üìã</div>
                <p class="home-empty-state-text">${f(e)}</p>
                ${r}
            </div>
        `}applyFilters(e){if(!Array.isArray(e))return[];let t=[...e];if(this.currentFilter.search){const r=this.currentFilter.search.toLowerCase();t=t.filter(a=>{const i=(a.titulo||a.nome||"").toLowerCase(),o=(a.descricao||"").toLowerCase(),s=(a.modulo||a.area||"").toLowerCase();return i.includes(r)||o.includes(r)||s.includes(r)})}return this.currentFilter.priority!=="all"&&(t=t.filter(r=>(r.prioridade||"media").toLowerCase()===this.currentFilter.priority.toLowerCase())),t}filterUpcomingTasks(e){return e.filter(t=>{if(t.completed)return!1;const r=T(t.time);if(!r)return!1;const a=new Date,i=new Date(a.getTime()+C*60*60*1e3);return r>=a&&r<=i})}filterOverdueTasks(e){return e.filter(t=>{if(t.completed)return!1;const r=T(t.time||t.deadline);return r?r<new Date:!1})}sortTasks(e,t){if(!Array.isArray(e))return[];const r=[...e];switch(t){case"priority":const a={urgente:4,alta:3,media:2,baixa:1};return r.sort((i,o)=>{const s=a[(i.prioridade||"media").toLowerCase()]||0;return(a[(o.prioridade||"media").toLowerCase()]||0)-s});case"module":return r.sort((i,o)=>{const s=(i.modulo||i.area||"").toLowerCase(),n=(o.modulo||o.area||"").toLowerCase();return s.localeCompare(n)});case"createdAt":return r.sort((i,o)=>{const s=T(i.createdAt)||new Date(0);return(T(o.createdAt)||new Date(0))-s});case"time":default:return r.sort((i,o)=>{const s=T(i.time)||new Date(0),n=T(o.time)||new Date(0);return s-n})}}setupEventListeners(){this.cleanupEventListeners(),this.debouncedUpdate=x(()=>this.update(),j),this.throttledUpdate=N(()=>this.update(),q);const e=d=>{if(d.target.classList.contains("task-checkbox")){const p=d.target.getAttribute("data-task-id");p&&this.handleTaskComplete(p,d.target.checked)}};document.addEventListener("change",e),this.registerEventListener("change",e,document);const t=document.getElementById("home-search-input");if(t){const d=x(p=>{this.currentFilter.search=p.target.value,this.update()},300);t.addEventListener("input",d),this.registerEventListener("input",d,t)}const r=document.getElementById("home-filter-priority");if(r){const d=p=>{this.currentFilter.priority=p.target.value,this.update()};r.addEventListener("change",d),this.registerEventListener("change",d,r)}const a=document.getElementById("home-filter-sort");if(a){const d=p=>{this.currentFilter.sortBy=p.target.value,this.update()};a.addEventListener("change",d),this.registerEventListener("change",d,a)}const i=document.getElementById("btn-show-all-overdue");if(i){const d=()=>this.showAllOverdue();i.addEventListener("click",d),this.registerEventListener("click",d,i)}const o=document.getElementById("btn-show-all-completed");if(o){const d=()=>this.showAllCompleted();o.addEventListener("click",d),this.registerEventListener("click",d,o)}const s=document.getElementById("btn-show-all-postponed");if(s){const d=()=>this.showAllPostponed();s.addEventListener("click",d),this.registerEventListener("click",d,s)}const n=document.getElementById("btn-add-task-home");if(n){const d=()=>this.handleTaskAdd();n.addEventListener("click",d),this.registerEventListener("click",d,n)}const l=document.getElementById("btn-add-task-empty");if(l){const d=()=>this.handleTaskAdd();l.addEventListener("click",d),this.registerEventListener("click",d,l)}const h=document.getElementById("btn-retry-home");if(h){const d=()=>{this.isLoading=!1,this.lastRenderData=null,this.update()};h.addEventListener("click",d),this.registerEventListener("click",d,h)}const v=d=>{const p=d.target.closest("[data-action]");if(!p)return;const w=p.getAttribute("data-action"),b=p.getAttribute("data-task-id");w==="edit"&&b?this.handleTaskEdit(b):w==="delete"&&b&&this.handleTaskDelete(b)};document.addEventListener("click",v),this.registerEventListener("click",v,document),this.setupKeyboardNavigation(),this.setupSwipeGestures()}setupKeyboardNavigation(){const e=t=>{if(t.key==="ArrowDown"||t.key==="ArrowUp"){const r=document.activeElement;if(r&&(r.classList.contains("timeline-item")||r.classList.contains("overdue-item"))){t.preventDefault();const a=Array.from(document.querySelectorAll(".timeline-item, .overdue-item")),i=a.indexOf(r);if(i===-1)return;const o=t.key==="ArrowDown"?Math.min(i+1,a.length-1):Math.max(i-1,0);a[o].focus()}}if(t.key==="Enter"){const r=document.activeElement;if(r&&(r.classList.contains("timeline-item")||r.classList.contains("overdue-item"))){const a=r.querySelector(".task-checkbox");a&&a.click()}}t.key};document.addEventListener("keydown",e),this.registerEventListener("keydown",e,document)}registerEventListener(e,t,r){this.eventListeners.push({type:e,handler:t,target:r})}cleanupEventListeners(){this.eventListeners.forEach(({type:e,handler:t,target:r})=>{r&&typeof r.removeEventListener=="function"&&r.removeEventListener(e,t)}),this.eventListeners=[]}setupSwipeGestures(){const e=new Set;[".timeline-item .task-card",".overdue-item .task-card",".completed-item .task-card",".postponed-item .task-card"].forEach(r=>{document.querySelectorAll(r).forEach(i=>{const o=i.querySelector(".task-checkbox").getAttribute("data-task-id");if(o&&(e.add(o),!this.swipeGestureMap.has(o))){const s=this.setupSwipeGestureForCard(i,o);s&&this.swipeGestureMap.set(o,s)}})}),this.swipeGestureMap.forEach((r,a)=>{if(!e.has(a)){if(typeof r=="function")try{r()}catch(i){console.error("Erro ao limpar swipe gesture:",i)}this.swipeGestureMap.delete(a)}})}setupSwipeGestureForCard(e,t){if(!t||!e)return null;try{return D(e,{onSwipeLeft:F(t,r=>{this.handleTaskComplete(r,!0)}),onSwipeRight:O(t,(r,a)=>{this.handlePostponeTask(r,a)})}),()=>{}}catch(r){return this.handleError("Erro ao configurar swipe gesture",r),null}}cleanupSwipeGestures(){this.swipeGestureMap.forEach((e,t)=>{if(typeof e=="function")try{e()}catch(r){this.handleError("Erro ao limpar swipe gesture",r)}}),this.swipeGestureMap.clear(),this.swipeGestureCleanups.forEach(e=>{if(typeof e=="function")try{e()}catch(t){this.handleError("Erro ao limpar swipe gesture",t)}}),this.swipeGestureCleanups=[]}handleTaskComplete(e,t){try{if(!e)return;const r=m.getState();if(!E(r.tarefasHome,"array")){c.error("Erro: dados inv√°lidos");return}const a=r.tarefasHome||[],i=this.findTaskById(a,e);if(!i){c.error("Tarefa n√£o encontrada");return}const o=i.titulo||i.nome||"Tarefa";m.updateItem("tarefasHome",s=>this.compareTaskIds(this.getTaskId(s),e),{completed:t,completedAt:t?new Date().toISOString():null}),t?(c.success(`"${o}" conclu√≠da!`,{duration:5e3,action:()=>{m.updateItem("tarefasHome",s=>this.compareTaskIds(this.getTaskId(s),e),{completed:!1,completedAt:null}),c.info("A√ß√£o desfeita"),this.update()},actionLabel:"Desfazer"}),this.updateStreak()):c.info(`"${o}" desmarcada`),this.update()}catch(r){this.handleError("Erro ao completar tarefa",r),c.error("Erro ao completar tarefa")}}handleTaskAdd(){try{const t=(m.getState().contadorHome||0)+1,r=new Date,a=new Date(r.getTime()+z*60*60*1e3),i={id:t,contador:t,titulo:"Nova Tarefa",descricao:"",status:"todo",prioridade:"media",tags:[],responsavel:"",time:a.toISOString(),createdAt:new Date().toISOString(),updatedAt:new Date().toISOString()};B.open(i,(o,s)=>{try{const n={...i,...s};m.addItem("tarefasHome",n),m.setState({contadorHome:t}),c.success("Tarefa criada com sucesso"),this.update()}catch(n){this.handleError("Erro ao criar tarefa",n),c.error("Erro ao criar tarefa")}})}catch(e){this.handleError("Erro ao adicionar tarefa",e),c.error("Erro ao adicionar tarefa")}}handleTaskEdit(e){try{if(!e){c.error("ID da tarefa inv√°lido");return}const t=m.getState();if(!E(t.tarefasHome,"array")){c.error("Erro: dados inv√°lidos");return}const r=t.tarefasHome||[],a=this.findTaskById(r,e);if(!a){c.error("Tarefa n√£o encontrada");return}B.open(a,(i,o)=>{try{m.updateItem("tarefasHome",s=>this.compareTaskIds(this.getTaskId(s),e),o),c.success("Tarefa atualizada com sucesso"),this.update()}catch(s){this.handleError("Erro ao atualizar tarefa",s),c.error("Erro ao atualizar tarefa")}})}catch(t){this.handleError("Erro ao editar tarefa",t),c.error("Erro ao editar tarefa")}}async handleTaskDelete(e){try{if(!e){c.error("ID da tarefa inv√°lido");return}const t=m.getState();if(!E(t.tarefasHome,"array")){c.error("Erro: dados inv√°lidos");return}const r=t.tarefasHome||[],a=this.findTaskById(r,e);if(!a){c.error("Tarefa n√£o encontrada");return}const i=a.titulo||a.nome||"Tarefa";await U(`Tem certeza que deseja excluir "${i}"?`)&&(m.removeItem("tarefasHome",s=>this.compareTaskIds(this.getTaskId(s),e)),c.success("Tarefa exclu√≠da com sucesso"),this.update())}catch(t){this.handleError("Erro ao excluir tarefa",t),c.error("Erro ao excluir tarefa")}}handlePostponeTask(e,t){try{if(!e||typeof t!="number"||t<=0)return;const r=m.getState();if(!E(r.tarefasHome,"array"))return;const a=r.tarefasHome||[],i=this.findTaskById(a,e);if(!i||!i.time)return;const o=T(i.time);if(!o)return;o.setDate(o.getDate()+t);const s=o.toISOString();m.updateItem("tarefasHome",l=>this.compareTaskIds(this.getTaskId(l),e),{time:s});const n=t===1?"dia":"dias";c.info(`Tarefa adiada ${t} ${n}`)}catch(r){this.handleError("Erro ao adiar tarefa",r),c.error("Erro ao adiar tarefa")}}showAllOverdue(){try{const e=m.getState();if(!E(e.tarefasHome,"array")){c.error("Erro: dados inv√°lidos");return}const t=e.tarefasHome||[],r=H(t),a=document.getElementById("home-overdue-list");if(!a)return;const i=r.filter(s=>s!=null).map(s=>{const n=new y(s,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!1,isCurrent:!1,isOverdue:!0,showActions:!0});return`<div class="overdue-item" data-task-id="${this.getTaskId(s)}" role="listitem" tabindex="0" aria-label="Tarefa atrasada: ${f(s.titulo||s.nome||"Sem t√≠tulo")}">${n.render().outerHTML}</div>`}).join("");a.innerHTML=i;const o=document.getElementById("btn-show-all-overdue");o&&o.remove(),this.setupSwipeGestures()}catch(e){this.handleError("Erro ao mostrar todas as tarefas atrasadas",e),c.error("Erro ao carregar tarefas atrasadas")}}showAllCompleted(){try{const e=m.getState();if(!E(e.tarefasHome,"array")){c.error("Erro: dados inv√°lidos");return}const t=e.tarefasHome||[],r=this.applyFilters(t),a=S(r),i=document.getElementById("home-completed-list");if(!i)return;const o=a.filter(n=>n!=null).map(n=>{const l=new y(n,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!1,isCurrent:!1,isOverdue:!1,showActions:!0,isCompleted:!0});return`<div class="completed-item" data-task-id="${this.getTaskId(n)}" role="listitem" tabindex="0" aria-label="Tarefa conclu√≠da: ${f(n.titulo||n.nome||"Sem t√≠tulo")}">${l.render().outerHTML}</div>`}).join("");i.innerHTML=o;const s=document.getElementById("btn-show-all-completed");s&&s.remove(),this.setupSwipeGestures()}catch(e){this.handleError("Erro ao mostrar todas as tarefas conclu√≠das",e),c.error("Erro ao carregar tarefas conclu√≠das")}}showAllPostponed(){try{const e=m.getState();if(!E(e.tarefasHome,"array")){c.error("Erro: dados inv√°lidos");return}const t=e.tarefasHome||[],r=this.applyFilters(t),a=I(r),i=document.getElementById("home-postponed-list");if(!i)return;const o=a.filter(n=>n!=null).map(n=>{const l=new y(n,{showCheckbox:!0,showModule:!0,showPriority:!0,showDuration:!0,isCurrent:!1,isOverdue:!1,showActions:!0});return`<div class="postponed-item" data-task-id="${this.getTaskId(n)}" role="listitem" tabindex="0" aria-label="Tarefa adiada: ${f(n.titulo||n.nome||"Sem t√≠tulo")}">${l.render().outerHTML}</div>`}).join("");i.innerHTML=o;const s=document.getElementById("btn-show-all-postponed");s&&s.remove(),this.setupSwipeGestures()}catch(e){this.handleError("Erro ao mostrar todas as tarefas adiadas",e),c.error("Erro ao carregar tarefas adiadas")}}findTaskById(e,t){return!Array.isArray(e)||!t?null:e.find(r=>this.compareTaskIds(this.getTaskId(r),t))||null}getTaskId(e){return e&&(e.id||e.contador)||null}compareTaskIds(e,t){return e==null||t==null?!1:String(e)===String(t)}updateStreak(){try{const e=m.getState(),t=P(),r=e.tarefasHome||[],a=A(r);if(a.length===0)return;const i=e.ultimaStreakDate||null,o=e.streak||0;if(!i)m.setState({streak:1,ultimaStreakDate:t,diaAtual:t});else{if(i===t)return;{const s=new Date(t);s.setDate(s.getDate()-1);const n=s.toISOString().split("T")[0];i===n?m.setState({streak:o+1,ultimaStreakDate:t,diaAtual:t}):m.setState({streak:1,ultimaStreakDate:t,diaAtual:t})}}this.triggerCompletionAnimation(r,a)}catch(e){this.handleError("Erro ao atualizar streak",e)}}triggerCompletionAnimation(e,t){try{const r=L(e);t.length===r&&r>0&&setTimeout(()=>{const a=document.querySelector(".home-metrics-progress-bar");a&&(a.style.animation="progress-complete 0.5s ease")},R)}catch(r){this.handleError("Erro ao disparar anima√ß√£o",r)}}handleRenderError(e){return this.handleError("Erro ao renderizar HomeView",e),this.renderErrorState("Erro ao carregar o dashboard")}handleError(e,t){console.error(e,t),t&&t.stack&&console.error("Stack trace:",t.stack)}}function Z(){const u=new _;return{render:()=>u.render(),mount:()=>(setTimeout(()=>{u.mount()},0),u)}}export{Z as default};
//# sourceMappingURL=Home-n-ezt5CJ.js.map
